<!DOCTYPE html>
<html>
<head>
    <title>CSV API</title>
    <script>
        // อ่านไฟล์ CSV และแปลงเป็น JSON
        async function loadCSV() {
            const response = await fetch('data.csv');
            const csvText = await response.text();
            
            // แปลง CSV เป็น Array ของ Objects
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(header => header.trim());
            
            const jsonData = lines.slice(1).map(line => {
                const values = line.split(',');
                return headers.reduce((obj, header, index) => {
                    obj[header] = values[index]?.trim();
                    return obj;
                }, {});
            });

            // เก็บข้อมูลใน localStorage
            localStorage.setItem('apiData', JSON.stringify(jsonData));
            
            return jsonData;
        }

        // API Endpoints
        async function handleRequest() {
            let data = localStorage.getItem('apiData');
            if (!data) {
                data = await loadCSV();
            } else {
                data = JSON.parse(data);
            }

            // ดึง path จาก URL
            const path = window.location.hash.slice(1) || '/';
            
            // จัดการ routes
            switch (path) {
                case '/':
                    return {
                        status: 200,
                        data: data
                    };
                default:
                    // ถ้ามีการระบุ ID
                    const id = path.split('/')[1];
                    if (id) {
                        const item = data.find(item => item.id === id);
                        if (item) {
                            return {
                                status: 200,
                                data: item
                            };
                        }
                    }
                    return {
                        status: 404,
                        error: 'Not found'
                    };
            }
        }

        // แสดงผลลัพธ์
        async function displayResponse() {
            const result = await handleRequest();
            document.getElementById('response').textContent = 
                JSON.stringify(result, null, 2);
        }

        // Event Listeners
        window.addEventListener('load', displayResponse);
        window.addEventListener('hashchange', displayResponse);
    </script>
</head>
<body>
    <h1>CSV API</h1>
    <p>API Endpoints:</p>
    <ul>
        <li>GET / - แสดงข้อมูลทั้งหมด</li>
        <li>GET /#/:id - แสดงข้อมูลตาม ID</li>
    </ul>
    <pre id="response"></pre>
</body>
</html>