<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Open Space Ratio Web App</title>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    html, body, #mapDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
    #controlPanel {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 15px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      max-width: 350px;
      z-index: 1000;
      max-height: 80vh;
      overflow-y: auto;
    }
    #layerPanel {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 15px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      max-width: 300px;
      z-index: 1000;
    }
    .button {
      margin-top: 10px;
      padding: 8px 12px;
      background-color: #0079c1;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
    }
    .button:hover {
      background-color: #005e95;
    }
    .button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .file-input-container {
      margin-bottom: 10px;
    }
    .field-selector {
      margin-top: 10px;
      width: 100%;
    }
    .result-info {
      margin-top: 15px;
      padding: 10px;
      background-color: #f8f8f8;
      border-radius: 4px;
      font-size: 14px;
    }
    .loading {
      display: none;
      color: #0079c1;
      margin-top: 15px;
      text-align: center;
    }
    .layer-item {
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }
    .layer-toggle {
      margin-right: 8px;
    }
    .layer-label {
      font-size: 14px;
      cursor: pointer;
    }
    .attribute-table {
      margin-top: 15px;
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    .attribute-table th, .attribute-table td {
      border: 1px solid #ddd;
      padding: 6px;
      text-align: left;
    }
    .attribute-table th {
      background-color: #f2f2f2;
    }
    .attribute-panel {
      margin-top: 15px;
      padding: 8px;
      background-color: #f8f8f8;
      border-radius: 4px;
      max-height: 300px;
      overflow-y: auto;
    }
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .panel-title {
      font-weight: bold;
      margin: 0;
    }
    hr {
      margin: 15px 0;
      border: 0;
      border-top: 1px solid #ddd;
    }
    .info-popup {
      max-height: 200px;
      overflow-y: auto;
    }
    .crs-selector {
      margin-top: 10px;
      margin-bottom: 5px;
    }
    .export-options {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }
    .export-button {
      flex: 1;
    }
    .home-button {
  position: absolute;
  top: 15px;
  right: 15px;
  z-index: 1001;
   }
   .home-button a {
  display: block;
  padding: 8px;
  color: #0079c1;
  background-color: white;
  border-radius: 50%;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  text-decoration: none;
  text-align: center;
  }
  .home-button a:hover {
  background-color: #f0f0f0;
  }
  .home-button i {
  font-size: 18px;
}
  </style>
</head>
<body>
  <div id="mapDiv"></div>
  
  <!-- Main Control Panel -->
  <div id="controlPanel">
    <div class="panel-header">
      <h2 class="panel-title">Open Space Ratio Web App</h2>
      <div class="home-button">
        <a href="page11.html" title="Back to Main Page">
          <i class="fas fa-home"></i>
        </a>
      </div>
    </div>
    
    <div class="crs-selector">
      <label for="coordSystem">Coordinate Reference System:</label>
      <select id="coordSystem" class="field-selector">
        <option value="EPSG:4326">EPSG:4326 (WGS84)</option>
        <option value="EPSG:32647">EPSG:32647 (UTM Zone 47N)</option>
        <option value="EPSG:32648">EPSG:32648 (UTM Zone 48N)</option>
      </select>
    </div>
    
    <div class="file-input-container">
      <label for="buildingFile">1. Upload Building GeoJSON:</label>
      <input type="file" id="buildingFile" accept=".geojson,.json">
      <div id="buildingStatus"></div>
    </div>
    
    <div class="file-input-container">
      <label for="parcelFile">2. Upload Land Parcel GeoJSON:</label>
      <input type="file" id="parcelFile" accept=".geojson,.json">
      <div id="parcelStatus"></div>
    </div>
    
    <div id="fieldSelectorContainer" style="display:none;">
      <label for="parcelFieldSelector">Select Parcel Identifier Field:</label>
      <select id="parcelFieldSelector" class="field-selector"></select>
    </div>
    
    <button id="processStep1" class="button" disabled>3.1 Calculate Open Space</button>
    <div id="step1Result" class="result-info" style="display:none;"></div>
    
    <button id="processStep2" class="button" disabled>3.2 Extract Parcel Information</button>
    <div id="step2Result" class="result-info" style="display:none;"></div>
    
    <button id="processStep3" class="button" disabled>3.3 Calculate Total Building Area</button>
    <div id="step3Result" class="result-info" style="display:none;"></div>
    
    <button id="processStep4" class="button" disabled>3.4 Calculate OSR</button>
    <div id="step4Result" class="result-info" style="display:none;"></div>
    
    <div class="export-options">
      <button id="exportButton" class="button export-button" disabled>4.1 Export as GeoJSON</button>
      <button id="exportExcelButton" class="button export-button" disabled>4.2 Export as Excel</button>
    </div>
    
    <div id="loadingIndicator" class="loading">
      <i class="fas fa-cog fa-spin"></i> Processing...
    </div>
    
    <hr>
    
    <!-- Attribute Viewer Section -->
    <div class="panel-header">
      <h3 class="panel-title">Attribute Viewer</h3>
    </div>
    
    <div>
      <label for="layerSelect">Select Layer for Attributes:</label>
      <select id="layerSelect" class="field-selector">
        <option value="">-- Select a layer --</option>
      </select>
    </div>
    
    <div id="attributePanel" class="attribute-panel" style="display:none;">
      <div id="attributeContent"></div>
    </div>
  </div>
  
  <!-- Layer Control Panel -->
  <div id="layerPanel">
    <div class="panel-header">
      <h3 class="panel-title">Map Layers</h3>
    </div>
    <div id="layerList">
      <!-- Layer toggles will be added here dynamically -->
      <div class="layer-item">
        <span class="layer-label">No layers available</span>
      </div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
  <!-- Turf.js for geometry operations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/6.5.0/turf.min.js"></script>
  <!-- Proj4js for coordinate transformations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>
  <!-- Proj4Leaflet for CRS handling in Leaflet -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4leaflet/1.0.2/proj4leaflet.min.js"></script>
  <!-- Esri Leaflet for ESRI basemaps -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/esri-leaflet/3.0.10/esri-leaflet.js"></script>
  <!-- SheetJS (XLSX) for Excel export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <script>
const _0x58e5a6=_0x44fa;(function(_0x52f224,_0x2f6554){const _0x3a583c=_0x44fa,_0x273ccd=_0x52f224();while(!![]){try{const _0x523f3e=-parseInt(_0x3a583c(0x26c))/0x1+-parseInt(_0x3a583c(0x21c))/0x2+parseInt(_0x3a583c(0x295))/0x3+parseInt(_0x3a583c(0x256))/0x4+parseInt(_0x3a583c(0x292))/0x5*(-parseInt(_0x3a583c(0x230))/0x6)+parseInt(_0x3a583c(0x1cf))/0x7*(parseInt(_0x3a583c(0x204))/0x8)+-parseInt(_0x3a583c(0x1dc))/0x9*(-parseInt(_0x3a583c(0x275))/0xa);if(_0x523f3e===_0x2f6554)break;else _0x273ccd['push'](_0x273ccd['shift']());}catch(_0x40e9cb){_0x273ccd['push'](_0x273ccd['shift']());}}}(_0x53bf,0xe2c85));let map,buildingLayer,parcelLayer,resultLayer,buildingGeojson,parcelGeojson,resultGeojson,parcelFields=[],currentCRS=_0x58e5a6(0x211),parcelOriginalShapes=null,basemapLayer,allLayers=[],layerData={};proj4[_0x58e5a6(0x2b1)](_0x58e5a6(0x1f4),_0x58e5a6(0x1c0)),proj4[_0x58e5a6(0x2b1)](_0x58e5a6(0x28b),_0x58e5a6(0x2b6));const crs={'EPSG:4326':L[_0x58e5a6(0x20a)][_0x58e5a6(0x219)],'EPSG:32647':new L['Proj'][(_0x58e5a6(0x20a))]('EPSG:32647',proj4['defs']('EPSG:32647'),{'resolutions':[0x100,0x80,0x40,0x20,0x10,0x8,0x4,0x2,0x1,0.5,0.25],'origin':[0x0,0x0]}),'EPSG:32648':new L[(_0x58e5a6(0x1d5))][(_0x58e5a6(0x20a))](_0x58e5a6(0x28b),proj4[_0x58e5a6(0x2b1)](_0x58e5a6(0x28b)),{'resolutions':[0x100,0x80,0x40,0x20,0x10,0x8,0x4,0x2,0x1,0.5,0.25],'origin':[0x0,0x0]})};function initMap(){const _0x58be11=_0x58e5a6,_0x8dfbed=document[_0x58be11(0x24b)](_0x58be11(0x24d))[_0x58be11(0x2a5)];currentCRS=_0x8dfbed,map&&map[_0x58be11(0x29a)](),map=L[_0x58be11(0x1da)](_0x58be11(0x222),{'crs':crs[_0x8dfbed]})[_0x58be11(0x21b)]([13.7,100.5],0xa),_0x8dfbed===_0x58be11(0x211)?(basemapLayer=L[_0x58be11(0x1cc)]['basemapLayer']('Imagery',{'detectRetina':!![]})[_0x58be11(0x2a4)](map),L['esri'][_0x58be11(0x25e)](_0x58be11(0x2a9))[_0x58be11(0x2a4)](map)):(basemapLayer=L['rectangle']([[-0x5a,-0xb4],[0x5a,0xb4]],{'color':'#f8f8f8','weight':0x1,'fillColor':_0x58be11(0x2af),'fillOpacity':0x1})['addTo'](map),L['control']['attribution']({'prefix':'Base\x20map\x20limited\x20in\x20UTM\x20projection.\x20Switch\x20to\x20EPSG:4326\x20for\x20full\x20basemap.'})[_0x58be11(0x2a4)](map)),console['log'](_0x58be11(0x206)+_0x8dfbed),reloadLayers();}function reloadLayers(){const _0x4b17b9=_0x58e5a6;buildingLayer&&map[_0x4b17b9(0x22c)](buildingLayer)&&map[_0x4b17b9(0x24f)](buildingLayer);parcelLayer&&map[_0x4b17b9(0x22c)](parcelLayer)&&map['removeLayer'](parcelLayer);resultLayer&&map[_0x4b17b9(0x22c)](resultLayer)&&map['removeLayer'](resultLayer);buildingGeojson&&addGeoJSONToMap(buildingGeojson,_0x4b17b9(0x1e5),_0x4b17b9(0x26f));parcelGeojson&&addGeoJSONToMap(parcelGeojson,_0x4b17b9(0x29b),_0x4b17b9(0x2ae));if(resultGeojson){let _0x569949=_0x4b17b9(0x2ab),_0x3ddaec=_0x4b17b9(0x1ca);if(resultGeojson['features'][_0x4b17b9(0x1dd)]>0x0){const _0x3f91d7=resultGeojson[_0x4b17b9(0x249)][0x0]['properties'];if(_0x3f91d7['OSR']!==undefined)_0x569949='finalResult',_0x3ddaec='Final\x20Result\x20(OSR)';else{if(_0x3f91d7[_0x4b17b9(0x1f3)]!==undefined)_0x569949=_0x4b17b9(0x1e7),_0x3ddaec='Parcels\x20with\x20Building\x20Areas';else _0x3f91d7['openSpaceArea']!==undefined&&(_0x569949='openSpace',_0x3ddaec=_0x4b17b9(0x223));}}addGeoJSONToMap(resultGeojson,_0x569949,_0x3ddaec);}}function checkCRS(_0x7835f2){const _0xc4c7b9=_0x58e5a6,_0x15ae8b=document[_0xc4c7b9(0x24b)]('coordSystem')[_0xc4c7b9(0x2a5)];if(!_0x7835f2||!_0x7835f2['features']||_0x7835f2[_0xc4c7b9(0x249)][_0xc4c7b9(0x1dd)]===0x0)return![];const _0x47d912=_0x7835f2[_0xc4c7b9(0x249)][0x0];let _0x4b7434=[];if(_0x47d912[_0xc4c7b9(0x1b6)][_0xc4c7b9(0x237)]===_0xc4c7b9(0x296))_0x4b7434=_0x47d912[_0xc4c7b9(0x1b6)][_0xc4c7b9(0x276)];else{if(_0x47d912[_0xc4c7b9(0x1b6)][_0xc4c7b9(0x237)]===_0xc4c7b9(0x1d6)||_0x47d912[_0xc4c7b9(0x1b6)]['type']===_0xc4c7b9(0x25b))_0x4b7434=_0x47d912[_0xc4c7b9(0x1b6)][_0xc4c7b9(0x276)][0x0];else{if(_0x47d912[_0xc4c7b9(0x1b6)][_0xc4c7b9(0x237)]===_0xc4c7b9(0x240)||_0x47d912[_0xc4c7b9(0x1b6)]['type']===_0xc4c7b9(0x1ac))_0x4b7434=_0x47d912[_0xc4c7b9(0x1b6)]['coordinates'][0x0][0x0];else _0x47d912['geometry'][_0xc4c7b9(0x237)]===_0xc4c7b9(0x247)&&(_0x4b7434=_0x47d912[_0xc4c7b9(0x1b6)][_0xc4c7b9(0x276)][0x0][0x0][0x0]);}}if(_0x4b7434[_0xc4c7b9(0x1dd)]<0x2)return![];const _0x532efb=_0x4b7434[0x0],_0x223f21=_0x4b7434[0x1];return _0x15ae8b===_0xc4c7b9(0x211)?_0x532efb>=-0xb4&&_0x532efb<=0xb4&&_0x223f21>=-0x5a&&_0x223f21<=0x5a:_0x532efb>0x186a0&&_0x223f21>0x186a0;}function addGeoJSONToMap(_0x5a59d3,_0x42b9da,_0x59562a){const _0x24da96=_0x58e5a6,_0x3bfc12=document[_0x24da96(0x24b)](_0x24da96(0x24d))[_0x24da96(0x2a5)];let _0x2eb39d=JSON[_0x24da96(0x212)](JSON[_0x24da96(0x1b2)](_0x5a59d3));const _0x3a2037={'color':_0x42b9da===_0x24da96(0x1e5)?_0x24da96(0x23e):_0x24da96(0x2b0),'weight':0x1,'opacity':0x1,'fillOpacity':0.5};if(_0x42b9da===_0x24da96(0x1e8))_0x3a2037[_0x24da96(0x228)]=_0x24da96(0x282),_0x3a2037[_0x24da96(0x2aa)]=_0x24da96(0x1cd);else{if(_0x42b9da==='parcelsBuildingAreas')_0x3a2037[_0x24da96(0x228)]='#000000';else _0x42b9da===_0x24da96(0x2ab)&&(_0x3a2037[_0x24da96(0x228)]=_0x24da96(0x2b5));}let _0x5daa8a;if(_0x42b9da==='finalResult'){function _0xcfe61(_0x4097a9){const _0x464399=_0x24da96;return _0x4097a9<0x19?_0x464399(0x23e):_0x4097a9<0x32?_0x464399(0x28d):_0x4097a9<0x64?'#ffff00':'#00ff00';}_0x5daa8a=L[_0x24da96(0x271)](_0x2eb39d,{'coordsToLatLng':function(_0x343ea4){const _0x216468=_0x24da96;if(_0x3bfc12!=='EPSG:4326'){const _0x2b988e=proj4(_0x3bfc12,_0x216468(0x211),_0x343ea4);return new L['LatLng'](_0x2b988e[0x1],_0x2b988e[0x0]);}return new L[(_0x216468(0x1db))](_0x343ea4[0x1],_0x343ea4[0x0]);},'style':function(_0x51525b){const _0x458dee=_0x24da96;return{'fillColor':_0xcfe61(_0x51525b['properties'][_0x458dee(0x226)]),'weight':0x1,'opacity':0x1,'color':'#000000','fillOpacity':0.7};},'onEachFeature':function(_0x4f5e4f,_0x1f3167){const _0x3c1609=_0x24da96,_0x55fa70=document[_0x3c1609(0x24b)](_0x3c1609(0x1bf))[_0x3c1609(0x2a5)]||'ID',_0x106370=_0x3c1609(0x25a)+_0x55fa70+_0x3c1609(0x257)+_0x4f5e4f[_0x3c1609(0x2b3)][_0x55fa70]+'<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Parcel\x20Area:</strong>\x20'+_0x4f5e4f[_0x3c1609(0x2b3)][_0x3c1609(0x244)]+_0x3c1609(0x1b0)+_0x4f5e4f[_0x3c1609(0x2b3)][_0x3c1609(0x1ff)]+_0x3c1609(0x25c)+_0x4f5e4f[_0x3c1609(0x2b3)][_0x3c1609(0x1f3)]+_0x3c1609(0x27f)+_0x4f5e4f['properties'][_0x3c1609(0x226)]+_0x3c1609(0x28f)+(_0x4f5e4f[_0x3c1609(0x2b3)][_0x3c1609(0x290)]||0x0)+_0x3c1609(0x1f0)+(_0x4f5e4f[_0x3c1609(0x2b3)]['calculationDetails']?'<strong>Calculation\x20Details:</strong><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<pre\x20style=\x22max-height:\x20100px;\x20overflow-y:\x20auto;\x22>'+_0x4f5e4f[_0x3c1609(0x2b3)][_0x3c1609(0x266)]+_0x3c1609(0x25f):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';_0x1f3167[_0x3c1609(0x1be)](_0x106370);}})[_0x24da96(0x2a4)](map);}else{if(_0x42b9da===_0x24da96(0x1e7)){function _0x3b7e16(_0x4ba377){const _0x461159=_0x24da96;return _0x4ba377<0x3e8?_0x461159(0x29e):_0x4ba377<0x1388?_0x461159(0x1d7):_0x4ba377<0x2710?_0x461159(0x2ac):_0x461159(0x23e);}_0x5daa8a=L[_0x24da96(0x271)](_0x2eb39d,{'coordsToLatLng':function(_0x476eb8){const _0x609418=_0x24da96;if(_0x3bfc12!==_0x609418(0x211)){const _0x566dfd=proj4(_0x3bfc12,_0x609418(0x211),_0x476eb8);return new L[(_0x609418(0x1db))](_0x566dfd[0x1],_0x566dfd[0x0]);}return new L['LatLng'](_0x476eb8[0x1],_0x476eb8[0x0]);},'style':function(_0x1593c5){const _0x19f69e=_0x24da96;return{'fillColor':_0x3b7e16(_0x1593c5[_0x19f69e(0x2b3)]['totalBuildingArea']),'weight':0x1,'opacity':0x1,'color':_0x19f69e(0x2b5),'fillOpacity':0.7};},'onEachFeature':function(_0x572151,_0x27be53){const _0x2cbdd8=_0x24da96,_0x2b517c=document[_0x2cbdd8(0x24b)](_0x2cbdd8(0x1bf))[_0x2cbdd8(0x2a5)]||'ID',_0x448702='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info-popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>'+_0x2b517c+_0x2cbdd8(0x257)+_0x572151['properties'][_0x2b517c]+'<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Building\x20Count:</strong>\x20'+(_0x572151[_0x2cbdd8(0x2b3)][_0x2cbdd8(0x290)]||0x0)+_0x2cbdd8(0x215)+_0x572151[_0x2cbdd8(0x2b3)][_0x2cbdd8(0x1f3)]+_0x2cbdd8(0x20f)+(_0x572151[_0x2cbdd8(0x2b3)][_0x2cbdd8(0x266)]?'<strong>Calculation\x20Details:</strong><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<pre\x20style=\x22max-height:\x20100px;\x20overflow-y:\x20auto;\x22>'+_0x572151[_0x2cbdd8(0x2b3)]['calculationDetails']+_0x2cbdd8(0x25f):'')+_0x2cbdd8(0x218);_0x27be53[_0x2cbdd8(0x1be)](_0x448702);}})['addTo'](map);}else{if(_0x42b9da==='openSpace')_0x5daa8a=L[_0x24da96(0x271)](_0x2eb39d,{'coordsToLatLng':function(_0x17c3f3){const _0xcf01cb=_0x24da96;if(_0x3bfc12!==_0xcf01cb(0x211)){const _0x2dffe1=proj4(_0x3bfc12,_0xcf01cb(0x211),_0x17c3f3);return new L[(_0xcf01cb(0x1db))](_0x2dffe1[0x1],_0x2dffe1[0x0]);}return new L['LatLng'](_0x17c3f3[0x1],_0x17c3f3[0x0]);},'style':function(_0x4e2155){const _0x2576fe=_0x24da96;return{'fillColor':'#00cc00','weight':0x1,'opacity':0x1,'color':_0x2576fe(0x282),'fillOpacity':0.7};},'onEachFeature':function(_0x4e2f55,_0x3f868d){const _0x4e6005=_0x24da96,_0x1521ec=document[_0x4e6005(0x24b)](_0x4e6005(0x1bf))[_0x4e6005(0x2a5)]||'ID',_0x30c5f1=_0x4e6005(0x25a)+_0x1521ec+_0x4e6005(0x257)+_0x4e2f55[_0x4e6005(0x2b3)][_0x1521ec]+'<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Parcel\x20Area:</strong>\x20'+_0x4e2f55[_0x4e6005(0x2b3)][_0x4e6005(0x244)]+'\x20sq.m<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Open\x20Space\x20Area:</strong>\x20'+_0x4e2f55[_0x4e6005(0x2b3)][_0x4e6005(0x1ff)]+'\x20sq.m\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';_0x3f868d[_0x4e6005(0x1be)](_0x30c5f1);}})['addTo'](map);else _0x42b9da===_0x24da96(0x24a)?_0x5daa8a=L[_0x24da96(0x271)](_0x2eb39d,{'coordsToLatLng':function(_0x4eefe2){const _0xb64e45=_0x24da96;if(_0x3bfc12!=='EPSG:4326'){const _0x5eec44=proj4(_0x3bfc12,_0xb64e45(0x211),_0x4eefe2);return new L[(_0xb64e45(0x1db))](_0x5eec44[0x1],_0x5eec44[0x0]);}return new L['LatLng'](_0x4eefe2[0x1],_0x4eefe2[0x0]);},'pointToLayer':function(_0x42ccdd,_0x661fb7){const _0x1b3feb=_0x24da96;return L['circleMarker'](_0x661fb7,{'radius':0x6,'fillColor':_0x1b3feb(0x23e),'color':_0x1b3feb(0x1ce),'weight':0x1,'opacity':0x1,'fillOpacity':0.8});},'onEachFeature':function(_0x210df9,_0x29f078){const _0x382617=_0x24da96;let _0x264438='<div\x20class=\x22info-popup\x22>';for(const _0xbc98da in _0x210df9[_0x382617(0x2b3)]){_0x264438+=_0x382617(0x283)+_0xbc98da+':</strong>\x20'+_0x210df9['properties'][_0xbc98da]+'<br>';}_0x264438+=_0x382617(0x277),_0x29f078['bindPopup'](_0x264438);}})['addTo'](map):_0x5daa8a=L['geoJSON'](_0x2eb39d,{'coordsToLatLng':function(_0x48be18){const _0x2d6bff=_0x24da96;if(_0x3bfc12!=='EPSG:4326'){const _0x2b5202=proj4(_0x3bfc12,_0x2d6bff(0x211),_0x48be18);return new L['LatLng'](_0x2b5202[0x1],_0x2b5202[0x0]);}return new L[(_0x2d6bff(0x1db))](_0x48be18[0x1],_0x48be18[0x0]);},'style':_0x3a2037,'onEachFeature':function(_0x3df5bb,_0x4dec80){const _0x192a80=_0x24da96;let _0x586bcf='<div\x20class=\x22info-popup\x22>';for(const _0x31b86c in _0x3df5bb[_0x192a80(0x2b3)]){_0x586bcf+='<strong>'+_0x31b86c+_0x192a80(0x257)+_0x3df5bb[_0x192a80(0x2b3)][_0x31b86c]+_0x192a80(0x22a);}_0x586bcf+=_0x192a80(0x277),_0x4dec80[_0x192a80(0x1be)](_0x586bcf);}})[_0x24da96(0x2a4)](map);}}if(_0x42b9da===_0x24da96(0x1e5))buildingLayer=_0x5daa8a;else _0x42b9da===_0x24da96(0x29b)?parcelLayer=_0x5daa8a:resultLayer=_0x5daa8a;addLayerToControl(_0x5daa8a,_0x42b9da,_0x59562a,_0x2eb39d);try{map['fitBounds'](_0x5daa8a[_0x24da96(0x238)]());}catch(_0x1a7c1d){console[_0x24da96(0x1f8)](_0x24da96(0x29f),_0x1a7c1d);}return _0x5daa8a;}function addLayerToControl(_0x47d350,_0x290903,_0x57e54e,_0x378304){const _0x47f5b5=_0x58e5a6;if(layerData[_0x290903]){const _0x54bb1f=allLayers['indexOf'](layerData[_0x290903][_0x47f5b5(0x27a)]);_0x54bb1f>-0x1&&allLayers['splice'](_0x54bb1f,0x1);}allLayers['push'](_0x47d350),layerData[_0x290903]={'layer':_0x47d350,'title':_0x57e54e,'geojson':_0x378304};const _0x3ea971=document[_0x47f5b5(0x24b)](_0x47f5b5(0x279));let _0x404d92=![];for(let _0xac5627=0x0;_0xac5627<_0x3ea971['options'][_0x47f5b5(0x1dd)];_0xac5627++){if(_0x3ea971[_0x47f5b5(0x23a)][_0xac5627][_0x47f5b5(0x2a5)]===_0x290903){_0x404d92=!![];break;}}if(!_0x404d92){const _0xf01360=document[_0x47f5b5(0x28a)](_0x47f5b5(0x205));_0xf01360[_0x47f5b5(0x2a5)]=_0x290903,_0xf01360[_0x47f5b5(0x272)]=_0x57e54e,_0x3ea971[_0x47f5b5(0x236)](_0xf01360);}updateLayerControlPanel();}function _0x53bf(){const _0x4de460=['Unsupported\x20geometry\x20type:\x20','bindPopup','parcelFieldSelector','+proj=utm\x20+zone=47\x20+datum=WGS84\x20+units=m\x20+no_defs','\x20building\x20points.\x20Success:\x20',',\x20Failed:\x20','className','onload','processStep4','OBJECTID','\x20sq.m</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p>Average\x20open\x20space\x20per\x20parcel:\x20','</table>','<h4>','Final\x20Result\x20(OSR)','crs','esri','#00cc00','#000','21nseOqn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p>Open\x20space\x20calculated\x20for\x20','Error\x20in\x20step\x203\x20processing:','parcelId','input','Processing\x20building\x20','Proj','LineString','#ffaa00','geojson','Application\x20initialized\x20successfully!','map','LatLng','4145121onPtMa','length','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','totalArea','processStep3','dataset','\x20sq.m</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p>Overall\x20open\x20space\x20percentage:\x20','area','step4Result','building','Error\x20creating\x20point\x20for\x20building\x20','parcelsBuildingAreas','openSpace','block','OSR\x20Analysis','click','Please\x20complete\x20step\x203\x20first.','change','Open\x20Space\x20GeoJSON\x20created:','keys','<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','layer-label','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>OSR\x20calculated\x20per\x20parcel:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>OSR\x20=\x20(Open\x20Space\x20Area\x20/\x20Total\x20Building\x20Area)\x20×\x20100</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<hr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Summary\x20Statistics:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20parcels:\x20','totalBuildingArea','EPSG:32647','Error\x20processing\x20parcel\x20','Maximum\x20OSR\x20(%)','OSR_analysis_result.geojson','warn','utils','%</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p>CRS:\x20','\x20sq.m</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20open\x20space:\x20','min','booleanPointInPolygon','Building\x20Points','openSpaceArea','Please\x20select\x20a\x20parcel\x20field.','Starting\x20step\x202\x20processing...','name','FeatureCollection','1002456bNrWol','option','Map\x20initialized\x20with\x20CRS:\x20','round','Created\x20','Building\x20','CRS','error','Starting\x20step\x201\x20processing\x20-\x20calculating\x20open\x20space...','none','style','\x20sq.m<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','abs','EPSG:4326','parse','Please\x20upload\x20building\x20and\x20parcel\x20files\x20first.',').\x20Do\x20you\x20want\x20to\x20continue\x20anyway?\x20If\x20not,\x20please\x20change\x20the\x20coordinate\x20system\x20and\x20try\x20again.','<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Total\x20Building\x20Area:</strong>\x20','layerList','number','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','EPSG3857','Average\x20OSR\x20(%)','setView','3155698lqwJmZ','<th>FID</th>','Please\x20complete\x20step\x204\x20first.','Parcels\x20with\x20Building\x20Areas','Parcel\x20','buildingFile','mapDiv','Open\x20Space','storeys','OSR_analysis_result_','OSR','Error\x20processing\x20point\x20','color','buildingStoreys','<br>','exportExcelButton','hasLayer','\x20sq.m\x20total','BL_NSTOREY','\x20sq.m,\x20Open\x20Space\x20Area\x20=\x20','42hQAbdA','checkbox','step2Result','\x20sq.m</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Average\x20OSR:</strong>\x20',':\x20Parcel\x20Area\x20=\x20','<td>','appendChild','type','getBounds','Error\x20processing\x20step\x204:\x20','options','forEach','createObjectURL','disabled','#ff0000','<table\x20class=\x22attribute-table\x22>','Polygon','processStep2','\x20sq.m\x0a','Error\x20parsing\x20GeoJSON\x20file.\x20Please\x20check\x20the\x20file\x20format.','parcelArea','readAsText','push','MultiPolygon','checked','features','buildingPoints','getElementById','parcelFile','coordSystem','Error\x20computing\x20open\x20space\x20geometry\x20for\x20parcel\x20','removeLayer','Error\x20checking\x20building\x20intersection:\x20','Please\x20complete\x20step\x202\x20first.','Buildings\x20calculation\x20details:\x0a','target','\x20sq.m\x20×\x20','body','5218552wJdFAn',':</strong>\x20','fieldSelectorContainer','reverse','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info-popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>','MultiPoint','\x20sq.m<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Total\x20Building\x20Area:</strong>\x20','download','basemapLayer','</pre>','\x20parcels</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20parcel\x20area:\x20','Error\x20processing\x20building\x20','Failed\x20to\x20create\x20any\x20building\x20points.\x20Check\x20the\x20building\x20GeoJSON\x20data.','reduce','<tr>','href','calculationDetails','\x20information','booleanIntersects','application/json','Error\x20in\x20step\x204\x20processing:','innerHTML','253408iDcHoh','Feature','attributeContent','Buildings','attributePanel','geoJSON','textContent','step3Result','Error\x20processing\x20step\x203:\x20','10pTZWxM','coordinates','</div>','book_new','layerSelect','layer','display','%</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>CRS:\x20','OSR\x20(%)','buildingStatus','\x20sq.m<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>OSR:</strong>\x20','layer-toggle','buildingFootprintArea','#007700','<strong>','writeFile','targetProjection','step1Result','\x20sq.m,\x20Building\x20Footprint\x20Area\x20=\x20','parcelName','\x20sq.m</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20building\x20footprint:\x20','createElement','EPSG:32648','centroid','#ffa500','string','%<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Building\x20Count:</strong>\x20','buildingCount','Please\x20upload\x20both\x20parcel\x20and\x20building\x20files\x20first.','179395yLckAE','layerId','%</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Maximum\x20OSR:</strong>\x20','2610549lESswC','Point','processStep1','<i\x20class=\x22fas\x20fa-check-circle\x22></i>\x20','</th>','remove','parcel','buildingArea','Error\x20parsing\x20GeoJSON:','#ffff00','Could\x20not\x20zoom\x20to\x20layer\x20bounds:','Buildings\x20converted\x20to\x20points\x20with\x20','BL_AREA','finalResultGeojson','revokeObjectURL','addTo','value','\x20floors\x20=\x20','max','\x20loaded','ImageryLabels','fillColor','finalResult','#ff5500','</td>','Land\x20Parcels','#f8f8f8','#00ff00','defs','</tr>','properties','intersect','#000000','+proj=utm\x20+zone=48\x20+datum=WGS84\x20+units=m\x20+no_defs','toFixed','Minimum\x20OSR\x20(%)','Error\x20in\x20step\x202\x20processing:','Error\x20processing\x20step\x202:\x20','MultiLineString','%</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Minimum\x20OSR:</strong>\x20','log','EPSG:32647\x20or\x20EPSG:32648\x20as\x20per\x20source\x20data','\x20sq.m<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Open\x20Space\x20Area:</strong>\x20','book_append_sheet','stringify','addEventListener','message','loadingIndicator','geometry','\x20sq.m</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20building\x20area:\x20','buildingList','No\x20buildings\x20found\x20in\x20this\x20parcel','WARNING:\x20The\x20coordinates\x20in\x20this\x20file\x20may\x20not\x20match\x20the\x20selected\x20coordinate\x20system\x20(','Failed\x20to\x20calculate\x20open\x20space\x20for\x20any\x20parcels.','title'];_0x53bf=function(){return _0x4de460;};return _0x53bf();}function updateLayerControlPanel(){const _0x86653e=_0x58e5a6,_0x126346=document[_0x86653e(0x24b)](_0x86653e(0x216));_0x126346[_0x86653e(0x26b)]='',Object[_0x86653e(0x1ef)](layerData)[_0x86653e(0x259)]()['forEach'](_0x60baa7=>{const _0x2dc1b0=_0x86653e,_0x46584b=layerData[_0x60baa7],_0x5aef51=document[_0x2dc1b0(0x28a)]('div');_0x5aef51['className']='layer-item';const _0x26976=document[_0x2dc1b0(0x28a)](_0x2dc1b0(0x1d3));_0x26976['type']=_0x2dc1b0(0x231),_0x26976[_0x2dc1b0(0x1c3)]=_0x2dc1b0(0x280),_0x26976[_0x2dc1b0(0x248)]=map[_0x2dc1b0(0x22c)](_0x46584b[_0x2dc1b0(0x27a)]),_0x26976[_0x2dc1b0(0x1e1)][_0x2dc1b0(0x293)]=_0x60baa7,_0x26976[_0x2dc1b0(0x1b3)](_0x2dc1b0(0x1ed),function(){const _0xcc1cc0=_0x2dc1b0;this['checked']?!map[_0xcc1cc0(0x22c)](_0x46584b[_0xcc1cc0(0x27a)])&&map['addLayer'](_0x46584b[_0xcc1cc0(0x27a)]):map[_0xcc1cc0(0x22c)](_0x46584b[_0xcc1cc0(0x27a)])&&map[_0xcc1cc0(0x24f)](_0x46584b[_0xcc1cc0(0x27a)]);});const _0x18b049=document[_0x2dc1b0(0x28a)]('label');_0x18b049[_0x2dc1b0(0x1c3)]=_0x2dc1b0(0x1f1),_0x18b049[_0x2dc1b0(0x272)]=_0x46584b['title'],_0x5aef51[_0x2dc1b0(0x236)](_0x26976),_0x5aef51[_0x2dc1b0(0x236)](_0x18b049),_0x126346['appendChild'](_0x5aef51);});}function displayAttributes(_0x18e0a3){const _0x8bfa12=_0x58e5a6,_0x59af77=document[_0x8bfa12(0x24b)](_0x8bfa12(0x270)),_0x533641=document[_0x8bfa12(0x24b)](_0x8bfa12(0x26e));if(!_0x18e0a3||!layerData[_0x18e0a3]){_0x59af77[_0x8bfa12(0x20e)][_0x8bfa12(0x27b)]=_0x8bfa12(0x20d);return;}const _0x2f1f91=layerData[_0x18e0a3],_0xe3e3a1=_0x2f1f91[_0x8bfa12(0x1d8)];if(!_0xe3e3a1||!_0xe3e3a1[_0x8bfa12(0x249)]||_0xe3e3a1[_0x8bfa12(0x249)]['length']===0x0){_0x533641[_0x8bfa12(0x26b)]='<p>No\x20attribute\x20data\x20available\x20for\x20this\x20layer.</p>',_0x59af77['style'][_0x8bfa12(0x27b)]=_0x8bfa12(0x1e9);return;}let _0x51efbd=_0x8bfa12(0x1c9)+_0x2f1f91[_0x8bfa12(0x1bc)]+'\x20Attributes</h4>';_0x51efbd+=_0x8bfa12(0x23f);const _0x64fdd9={},_0x401030=document['getElementById'](_0x8bfa12(0x1bf))[_0x8bfa12(0x2a5)]||'ID';_0x64fdd9[_0x8bfa12(0x29b)]=[_0x8bfa12(0x1c6),_0x401030],_0x64fdd9['building']=[_0x8bfa12(0x1c6),_0x8bfa12(0x2a1),_0x8bfa12(0x22e)],_0x64fdd9[_0x8bfa12(0x24a)]=[_0x8bfa12(0x1d2),_0x8bfa12(0x288),_0x8bfa12(0x29c),_0x8bfa12(0x229)],_0x64fdd9[_0x8bfa12(0x1e8)]=[_0x401030,_0x8bfa12(0x1ff),'parcelArea'],_0x64fdd9['parcelsBuildingAreas']=[_0x401030,_0x8bfa12(0x1f3),_0x8bfa12(0x1ff)],_0x64fdd9[_0x8bfa12(0x2ab)]=[_0x401030,_0x8bfa12(0x244),_0x8bfa12(0x1ff),_0x8bfa12(0x1f3),'OSR'];let _0x378793=[];_0x64fdd9[_0x18e0a3]?_0x378793=_0x64fdd9[_0x18e0a3]:_0xe3e3a1['features'][_0x8bfa12(0x23b)](_0x49ed9d=>{const _0x4ab6af=_0x8bfa12;_0x49ed9d[_0x4ab6af(0x2b3)]&&Object['keys'](_0x49ed9d[_0x4ab6af(0x2b3)])[_0x4ab6af(0x23b)](_0x2ca2e6=>{const _0xcc4220=_0x4ab6af;!_0x378793['includes'](_0x2ca2e6)&&_0x378793[_0xcc4220(0x246)](_0x2ca2e6);});}),_0x51efbd+=_0x8bfa12(0x264),_0x51efbd+=_0x8bfa12(0x21d),_0x378793[_0x8bfa12(0x23b)](_0x21d261=>{const _0x448467=_0x8bfa12;_0x51efbd+='<th>'+_0x21d261+_0x448467(0x299);}),_0x51efbd+=_0x8bfa12(0x2b2),_0xe3e3a1['features']['forEach']((_0x4dcddb,_0x50677f)=>{const _0x5560c8=_0x8bfa12;_0x51efbd+=_0x5560c8(0x264),_0x51efbd+=_0x5560c8(0x235)+_0x50677f+_0x5560c8(0x2ad),_0x378793[_0x5560c8(0x23b)](_0x5d2c4c=>{const _0x5d5cee=_0x5560c8,_0x154f52=_0x4dcddb['properties']?_0x4dcddb[_0x5d5cee(0x2b3)][_0x5d2c4c]:'';_0x51efbd+='<td>'+(_0x154f52!==undefined&&_0x154f52!==null?_0x154f52:'')+_0x5d5cee(0x2ad);}),_0x51efbd+=_0x5560c8(0x2b2);}),_0x51efbd+=_0x8bfa12(0x1c8),_0x533641['innerHTML']=_0x51efbd,_0x59af77[_0x8bfa12(0x20e)][_0x8bfa12(0x27b)]=_0x8bfa12(0x1e9);}function _0x44fa(_0x562621,_0x2800eb){const _0x53bf82=_0x53bf();return _0x44fa=function(_0x44fafc,_0x59d243){_0x44fafc=_0x44fafc-0x1ac;let _0x34a0a5=_0x53bf82[_0x44fafc];return _0x34a0a5;},_0x44fa(_0x562621,_0x2800eb);}function handleFileUpload(_0x58a457,_0x5379a6){const _0xb30702=_0x58e5a6,_0x1f8d1c=_0x58a457['files'][0x0];if(!_0x1f8d1c)return;const _0x3ae53a=new FileReader();_0x3ae53a['onload']=function(_0x906f7f){const _0x4c4768=_0x44fa,_0x58eca2=_0x906f7f[_0x4c4768(0x253)]['result'];try{const _0xb8c05d=JSON[_0x4c4768(0x212)](_0x58eca2),_0x3e617a=checkCRS(_0xb8c05d);if(!_0x3e617a){const _0x1911ec=confirm(_0x4c4768(0x1ba)+document[_0x4c4768(0x24b)]('coordSystem')[_0x4c4768(0x2a5)]+_0x4c4768(0x214));if(!_0x1911ec)return;}if(_0x5379a6===_0x4c4768(0x1e5)&&buildingLayer)map[_0x4c4768(0x24f)](buildingLayer),delete layerData[_0x4c4768(0x1e5)];else _0x5379a6===_0x4c4768(0x29b)&&parcelLayer&&(map[_0x4c4768(0x24f)](parcelLayer),delete layerData['parcel']);if(_0x5379a6===_0x4c4768(0x1e5))buildingGeojson=_0xb8c05d,document[_0x4c4768(0x24b)](_0x4c4768(0x27e))[_0x4c4768(0x26b)]='<i\x20class=\x22fas\x20fa-check-circle\x22></i>\x20'+_0x1f8d1c['name']+'\x20loaded';else{if(_0x5379a6===_0x4c4768(0x29b)){parcelGeojson=_0xb8c05d,document['getElementById']('parcelStatus')[_0x4c4768(0x26b)]=_0x4c4768(0x298)+_0x1f8d1c[_0x4c4768(0x202)]+_0x4c4768(0x2a8);if(_0xb8c05d[_0x4c4768(0x249)]&&_0xb8c05d['features'][_0x4c4768(0x1dd)]>0x0){const _0x508572=_0xb8c05d[_0x4c4768(0x249)][0x0]['properties'];parcelFields=Object[_0x4c4768(0x1ef)](_0x508572);const _0x49ff90=document[_0x4c4768(0x24b)](_0x4c4768(0x1bf));_0x49ff90['innerHTML']='',parcelFields[_0x4c4768(0x23b)](_0x4d6b2a=>{const _0xeb9c4d=_0x4c4768,_0x44e1da=document[_0xeb9c4d(0x28a)](_0xeb9c4d(0x205));_0x44e1da[_0xeb9c4d(0x2a5)]=_0x4d6b2a,_0x44e1da[_0xeb9c4d(0x272)]=_0x4d6b2a,_0x49ff90[_0xeb9c4d(0x236)](_0x44e1da);}),document[_0x4c4768(0x24b)](_0x4c4768(0x258))[_0x4c4768(0x20e)][_0x4c4768(0x27b)]='block';}}}addGeoJSONToMap(_0xb8c05d,_0x5379a6,_0x5379a6===_0x4c4768(0x1e5)?'Buildings':_0x4c4768(0x2ae)),buildingGeojson&&parcelGeojson&&(document[_0x4c4768(0x24b)](_0x4c4768(0x297))[_0x4c4768(0x23d)]=![]);}catch(_0x1f2b21){console[_0x4c4768(0x20b)](_0x4c4768(0x29d),_0x1f2b21),alert(_0x4c4768(0x243));}},_0x3ae53a[_0xb30702(0x245)](_0x1f8d1c);}function transformCoords(_0x150896,_0x1be414,_0x73f49d){if(_0x1be414===_0x73f49d)return _0x150896;return proj4(_0x1be414,_0x73f49d,_0x150896);}function transformGeoJSON(_0x350f16,_0x17c2b0,_0x2cb95e){const _0x5b08d6=_0x58e5a6;if(_0x17c2b0===_0x2cb95e)return JSON[_0x5b08d6(0x212)](JSON[_0x5b08d6(0x1b2)](_0x350f16));const _0x2cb1f6={'type':_0x350f16[_0x5b08d6(0x237)],'features':[]};return _0x350f16[_0x5b08d6(0x249)][_0x5b08d6(0x23b)](_0x239f0c=>{const _0x1ea5f4=_0x5b08d6,_0x532716={'type':_0x239f0c[_0x1ea5f4(0x237)],'properties':{..._0x239f0c[_0x1ea5f4(0x2b3)]},'geometry':{'type':_0x239f0c[_0x1ea5f4(0x1b6)]['type']}};if(_0x239f0c[_0x1ea5f4(0x1b6)][_0x1ea5f4(0x237)]===_0x1ea5f4(0x296))_0x532716[_0x1ea5f4(0x1b6)][_0x1ea5f4(0x276)]=transformCoords(_0x239f0c[_0x1ea5f4(0x1b6)]['coordinates'],_0x17c2b0,_0x2cb95e);else{if(_0x239f0c['geometry']['type']===_0x1ea5f4(0x1d6)||_0x239f0c[_0x1ea5f4(0x1b6)]['type']===_0x1ea5f4(0x25b))_0x532716[_0x1ea5f4(0x1b6)][_0x1ea5f4(0x276)]=_0x239f0c[_0x1ea5f4(0x1b6)][_0x1ea5f4(0x276)][_0x1ea5f4(0x1da)](_0x525db4=>transformCoords(_0x525db4,_0x17c2b0,_0x2cb95e));else{if(_0x239f0c[_0x1ea5f4(0x1b6)][_0x1ea5f4(0x237)]===_0x1ea5f4(0x240)||_0x239f0c[_0x1ea5f4(0x1b6)]['type']===_0x1ea5f4(0x1ac))_0x532716[_0x1ea5f4(0x1b6)][_0x1ea5f4(0x276)]=_0x239f0c[_0x1ea5f4(0x1b6)][_0x1ea5f4(0x276)]['map'](_0x4e0d5e=>_0x4e0d5e['map'](_0x4e06bf=>transformCoords(_0x4e06bf,_0x17c2b0,_0x2cb95e)));else _0x239f0c[_0x1ea5f4(0x1b6)][_0x1ea5f4(0x237)]===_0x1ea5f4(0x247)&&(_0x532716[_0x1ea5f4(0x1b6)][_0x1ea5f4(0x276)]=_0x239f0c[_0x1ea5f4(0x1b6)][_0x1ea5f4(0x276)]['map'](_0x579e75=>_0x579e75[_0x1ea5f4(0x1da)](_0x31211b=>_0x31211b[_0x1ea5f4(0x1da)](_0x120157=>transformCoords(_0x120157,_0x17c2b0,_0x2cb95e)))));}}_0x2cb1f6['features'][_0x1ea5f4(0x246)](_0x532716);}),_0x2cb1f6;}function processStep1(){const _0x2e1171=_0x58e5a6;if(!parcelGeojson||!buildingGeojson){alert(_0x2e1171(0x291));return;}document[_0x2e1171(0x24b)](_0x2e1171(0x1b5))['style']['display']=_0x2e1171(0x1e9),setTimeout(()=>{const _0x41b9b8=_0x2e1171;try{console[_0x41b9b8(0x1ae)](_0x41b9b8(0x20c));const _0x479839=document[_0x41b9b8(0x24b)](_0x41b9b8(0x24d))['value'],_0x7d9874=[];for(let _0x388bbb=0x0;_0x388bbb<parcelGeojson[_0x41b9b8(0x249)][_0x41b9b8(0x1dd)];_0x388bbb++){try{const _0xea1d18=parcelGeojson[_0x41b9b8(0x249)][_0x388bbb];console[_0x41b9b8(0x1ae)]('Processing\x20parcel\x20'+(_0x388bbb+0x1)+'/'+parcelGeojson[_0x41b9b8(0x249)]['length']);let _0x2e3884;_0x479839===_0x41b9b8(0x211)?_0x2e3884=turf[_0x41b9b8(0x1e3)](_0xea1d18):_0x2e3884=calculateAreaUTM(_0xea1d18[_0x41b9b8(0x1b6)],_0x479839);_0x2e3884=Math[_0x41b9b8(0x210)](_0x2e3884);let _0x5c0a32=JSON[_0x41b9b8(0x212)](JSON[_0x41b9b8(0x1b2)](_0xea1d18[_0x41b9b8(0x1b6)])),_0x3779bf=0x0,_0x2c017b=[];for(const _0x2201f4 of buildingGeojson[_0x41b9b8(0x249)]){try{const _0x273c50=turf[_0x41b9b8(0x268)](_0xea1d18,_0x2201f4);if(_0x273c50){const _0x4ad25b=turf[_0x41b9b8(0x2b4)](_0xea1d18,_0x2201f4);if(_0x4ad25b){let _0x3ee04e;_0x479839==='EPSG:4326'?_0x3ee04e=turf['area'](_0x4ad25b):_0x3ee04e=calculateAreaUTM(_0x4ad25b[_0x41b9b8(0x1b6)],_0x479839),_0x3779bf+=_0x3ee04e,_0x2c017b[_0x41b9b8(0x246)](_0x4ad25b);}}}catch(_0x56e061){console['warn'](_0x41b9b8(0x250)+_0x56e061[_0x41b9b8(0x1b4)]);}}let _0x3787f1=_0x2e3884-_0x3779bf;_0x3787f1=Math['max'](0x0,_0x3787f1),console[_0x41b9b8(0x1ae)](_0x41b9b8(0x220)+_0x388bbb+_0x41b9b8(0x234)+_0x2e3884[_0x41b9b8(0x2b7)](0x2)+_0x41b9b8(0x287)+_0x3779bf[_0x41b9b8(0x2b7)](0x2)+_0x41b9b8(0x22f)+_0x3787f1[_0x41b9b8(0x2b7)](0x2)+'\x20sq.m');let _0x1515f9={'type':_0x41b9b8(0x26d),'properties':{..._0xea1d18[_0x41b9b8(0x2b3)],'parcelArea':Math[_0x41b9b8(0x207)](_0x2e3884*0x64)/0x64,'buildingFootprintArea':Math[_0x41b9b8(0x207)](_0x3779bf*0x64)/0x64,'openSpaceArea':Math[_0x41b9b8(0x207)](_0x3787f1*0x64)/0x64,'openSpacePercentage':Math[_0x41b9b8(0x207)](_0x3787f1/_0x2e3884*0x2710)/0x64},'geometry':_0x5c0a32};if(_0x2c017b['length']>0x0)try{const _0x23a988={'type':'Feature','properties':{},'geometry':_0x5c0a32};let _0x28c103=_0x23a988;for(const _0x23e2be of _0x2c017b){if(!_0x28c103||!_0x28c103[_0x41b9b8(0x1b6)])continue;_0x28c103=turf['difference'](_0x28c103,_0x23e2be);if(!_0x28c103)break;}_0x28c103&&_0x28c103[_0x41b9b8(0x1b6)]&&(_0x1515f9[_0x41b9b8(0x1b6)]=_0x28c103['geometry']);}catch(_0x43fc83){console[_0x41b9b8(0x1f8)](_0x41b9b8(0x24e)+_0x388bbb+':',_0x43fc83);}_0x7d9874[_0x41b9b8(0x246)](_0x1515f9);}catch(_0x527c66){console[_0x41b9b8(0x1f8)](_0x41b9b8(0x1f5)+_0x388bbb+':',_0x527c66);}}if(_0x7d9874['length']===0x0)throw new Error(_0x41b9b8(0x1bb));resultGeojson={'type':_0x41b9b8(0x203),'features':_0x7d9874},console[_0x41b9b8(0x1ae)](_0x41b9b8(0x1ee),resultGeojson),parcelOriginalShapes=JSON['parse'](JSON['stringify'](parcelGeojson));resultLayer&&(map[_0x41b9b8(0x24f)](resultLayer),delete layerData['openSpace']);addGeoJSONToMap(resultGeojson,_0x41b9b8(0x1e8),_0x41b9b8(0x223));let _0x322cab=0x0,_0x3c22ed=0x0,_0x4fb121=0x0;_0x7d9874[_0x41b9b8(0x23b)](_0x1327a9=>{const _0x49d24f=_0x41b9b8;_0x322cab+=_0x1327a9[_0x49d24f(0x2b3)][_0x49d24f(0x1ff)],_0x3c22ed+=_0x1327a9[_0x49d24f(0x2b3)]['parcelArea'],_0x4fb121+=_0x1327a9['properties'][_0x49d24f(0x281)]||0x0;});const _0x699d13=_0x322cab/_0x7d9874[_0x41b9b8(0x1dd)],_0x3eb399=_0x322cab/_0x3c22ed*0x64;document[_0x41b9b8(0x24b)](_0x41b9b8(0x286))[_0x41b9b8(0x26b)]=_0x41b9b8(0x1d0)+_0x7d9874[_0x41b9b8(0x1dd)]+_0x41b9b8(0x260)+Math[_0x41b9b8(0x207)](_0x3c22ed*0x64)/0x64+_0x41b9b8(0x289)+Math[_0x41b9b8(0x207)](_0x4fb121*0x64)/0x64+_0x41b9b8(0x1fb)+Math[_0x41b9b8(0x207)](_0x322cab*0x64)/0x64+_0x41b9b8(0x1c7)+Math[_0x41b9b8(0x207)](_0x699d13*0x64)/0x64+_0x41b9b8(0x1e2)+Math[_0x41b9b8(0x207)](_0x3eb399*0x64)/0x64+_0x41b9b8(0x1fa)+_0x479839+'</p>\x0a\x20\x20\x20\x20\x20\x20',document['getElementById'](_0x41b9b8(0x286))['style'][_0x41b9b8(0x27b)]=_0x41b9b8(0x1e9),document[_0x41b9b8(0x24b)](_0x41b9b8(0x241))[_0x41b9b8(0x23d)]=![],document[_0x41b9b8(0x24b)](_0x41b9b8(0x1b5))['style'][_0x41b9b8(0x27b)]=_0x41b9b8(0x20d);}catch(_0x216181){console[_0x41b9b8(0x20b)]('Error\x20in\x20step\x201\x20processing:',_0x216181),alert('Error\x20processing\x20step\x201:\x20'+_0x216181[_0x41b9b8(0x1b4)]),document[_0x41b9b8(0x24b)](_0x41b9b8(0x1b5))['style']['display']=_0x41b9b8(0x20d);}},0x64);}function calculateAreaUTM(_0x362fac,_0x16b6ed){const _0x18c59d=_0x58e5a6;let _0x200a83=0x0;if(_0x362fac[_0x18c59d(0x237)]===_0x18c59d(0x240))_0x200a83=polygonArea(_0x362fac[_0x18c59d(0x276)][0x0]);else{if(_0x362fac[_0x18c59d(0x237)]===_0x18c59d(0x247))for(const _0x3db656 of _0x362fac['coordinates']){_0x200a83+=polygonArea(_0x3db656[0x0]);for(let _0xf215f4=0x1;_0xf215f4<_0x3db656[_0x18c59d(0x1dd)];_0xf215f4++){_0x200a83-=polygonArea(_0x3db656[_0xf215f4]);}}}return Math[_0x18c59d(0x210)](_0x200a83);}function polygonArea(_0x677142){const _0x5b95d8=_0x58e5a6;let _0x50c261=0x0;const _0x4e862d=_0x677142[_0x5b95d8(0x1dd)];if(_0x4e862d<0x3)return 0x0;for(let _0x16afa7=0x0;_0x16afa7<_0x4e862d-0x1;_0x16afa7++){_0x50c261+=_0x677142[_0x16afa7][0x0]*_0x677142[_0x16afa7+0x1][0x1]-_0x677142[_0x16afa7+0x1][0x0]*_0x677142[_0x16afa7][0x1];}return _0x50c261+=_0x677142[_0x4e862d-0x1][0x0]*_0x677142[0x0][0x1]-_0x677142[0x0][0x0]*_0x677142[_0x4e862d-0x1][0x1],Math['abs'](_0x50c261/0x2);}function processStep2(){const _0x2be549=_0x58e5a6;if(!buildingGeojson||!parcelGeojson){alert(_0x2be549(0x213));return;}const _0x598ec9=document[_0x2be549(0x24b)](_0x2be549(0x1bf))['value'];if(!_0x598ec9){alert(_0x2be549(0x200));return;}document['getElementById'](_0x2be549(0x1b5))[_0x2be549(0x20e)][_0x2be549(0x27b)]=_0x2be549(0x1e9),setTimeout(()=>{const _0x641e24=_0x2be549;try{console[_0x641e24(0x1ae)](_0x641e24(0x201));const _0x38839e=document['getElementById']('coordSystem')[_0x641e24(0x2a5)],_0x4ba1bc=[];let _0x4a80c7=0x0,_0x20c329=0x0;buildingGeojson['features'][_0x641e24(0x23b)]((_0x523c89,_0x579b33)=>{const _0x1c3974=_0x641e24;try{console[_0x1c3974(0x1ae)](_0x1c3974(0x1d4)+(_0x579b33+0x1)+'/'+buildingGeojson['features']['length']);let _0x84e02a;if(_0x523c89[_0x1c3974(0x1b6)][_0x1c3974(0x237)]===_0x1c3974(0x240)){const _0x1f2fe3=turf[_0x1c3974(0x28c)](_0x523c89);_0x84e02a=_0x1f2fe3[_0x1c3974(0x1b6)][_0x1c3974(0x276)];}else{if(_0x523c89[_0x1c3974(0x1b6)]['type']==='MultiPolygon'){const _0x5c7123={'type':_0x1c3974(0x26d),'properties':{},'geometry':{'type':_0x1c3974(0x240),'coordinates':_0x523c89[_0x1c3974(0x1b6)][_0x1c3974(0x276)][0x0]}},_0xdcc20d=turf[_0x1c3974(0x28c)](_0x5c7123);_0x84e02a=_0xdcc20d[_0x1c3974(0x1b6)][_0x1c3974(0x276)];}else throw new Error(_0x1c3974(0x1bd)+_0x523c89['geometry'][_0x1c3974(0x237)]);}const _0x58b66c={'type':_0x1c3974(0x26d),'properties':{..._0x523c89[_0x1c3974(0x2b3)],'parcelId':null,'parcelName':null,'buildingArea':typeof _0x523c89[_0x1c3974(0x2b3)]['BL_AREA']==='number'?_0x523c89[_0x1c3974(0x2b3)][_0x1c3974(0x2a1)]:0x0,'buildingStoreys':typeof _0x523c89[_0x1c3974(0x2b3)][_0x1c3974(0x22e)]===_0x1c3974(0x217)?_0x523c89[_0x1c3974(0x2b3)][_0x1c3974(0x22e)]:0x1},'geometry':{'type':_0x1c3974(0x296),'coordinates':_0x84e02a}};_0x4ba1bc[_0x1c3974(0x246)](_0x58b66c),_0x20c329++;}catch(_0x2e5164){console[_0x1c3974(0x1f8)](_0x1c3974(0x1e6)+_0x579b33+':',_0x2e5164,_0x523c89),_0x4a80c7++;}}),console[_0x641e24(0x1ae)](_0x641e24(0x208)+_0x4ba1bc[_0x641e24(0x1dd)]+_0x641e24(0x1c1)+_0x20c329+_0x641e24(0x1c2)+_0x4a80c7);if(_0x4ba1bc[_0x641e24(0x1dd)]===0x0)throw new Error(_0x641e24(0x262));const _0x1f5dd7={'type':_0x641e24(0x203),'features':_0x4ba1bc};_0x1f5dd7[_0x641e24(0x249)][_0x641e24(0x23b)]((_0x4c0c7e,_0x3671eb)=>{const _0x13eba4=_0x641e24;try{for(const _0x4c463e of parcelGeojson[_0x13eba4(0x249)]){if(turf[_0x13eba4(0x1fd)](_0x4c0c7e[_0x13eba4(0x1b6)][_0x13eba4(0x276)],_0x4c463e[_0x13eba4(0x1b6)])){_0x4c0c7e[_0x13eba4(0x2b3)][_0x13eba4(0x1d2)]=_0x4c463e[_0x13eba4(0x2b3)][_0x598ec9],_0x4c0c7e[_0x13eba4(0x2b3)]['parcelName']=_0x4c463e[_0x13eba4(0x2b3)][_0x598ec9];break;}}}catch(_0x16ac85){console[_0x13eba4(0x1f8)](_0x13eba4(0x227)+_0x3671eb+':',_0x16ac85);}}),layerData[_0x641e24(0x24a)]&&layerData['buildingPoints'][_0x641e24(0x27a)]&&(map[_0x641e24(0x24f)](layerData[_0x641e24(0x24a)][_0x641e24(0x27a)]),delete layerData[_0x641e24(0x24a)]),addGeoJSONToMap(_0x1f5dd7,_0x641e24(0x24a),_0x641e24(0x1fe)),document[_0x641e24(0x24b)](_0x641e24(0x232))[_0x641e24(0x272)]=_0x641e24(0x2a0)+_0x598ec9+_0x641e24(0x267),document['getElementById']('step2Result')[_0x641e24(0x20e)][_0x641e24(0x27b)]=_0x641e24(0x1e9),document[_0x641e24(0x24b)](_0x641e24(0x1e0))[_0x641e24(0x23d)]=![],document[_0x641e24(0x24b)](_0x641e24(0x1b5))[_0x641e24(0x20e)][_0x641e24(0x27b)]=_0x641e24(0x20d);}catch(_0x52ecde){console[_0x641e24(0x20b)](_0x641e24(0x2b9),_0x52ecde),alert(_0x641e24(0x2ba)+_0x52ecde[_0x641e24(0x1b4)]),document[_0x641e24(0x24b)]('loadingIndicator')[_0x641e24(0x20e)][_0x641e24(0x27b)]=_0x641e24(0x20d);}},0x64);}function processStep3(){const _0x5ee84f=_0x58e5a6;if(!buildingGeojson||!parcelGeojson){alert(_0x5ee84f(0x251));return;}const _0x3703fa=parcelOriginalShapes||parcelGeojson;document[_0x5ee84f(0x24b)](_0x5ee84f(0x1b5))[_0x5ee84f(0x20e)]['display']=_0x5ee84f(0x1e9),setTimeout(()=>{const _0x2dcace=_0x5ee84f;try{console[_0x2dcace(0x1ae)]('Starting\x20step\x203\x20processing...');const _0x102b0f=document[_0x2dcace(0x24b)](_0x2dcace(0x1bf))[_0x2dcace(0x2a5)],_0x173597=JSON[_0x2dcace(0x212)](JSON[_0x2dcace(0x1b2)](_0x3703fa)),_0x44a776={};_0x173597['features'][_0x2dcace(0x23b)](_0x39676e=>{const _0x8e80ff=_0x2dcace,_0x2fff63=_0x39676e[_0x8e80ff(0x2b3)][_0x102b0f];_0x44a776[_0x2fff63]=0x0;});const _0x58a820={};_0x173597[_0x2dcace(0x249)][_0x2dcace(0x23b)](_0x3689fe=>{const _0x3e1753=_0x2dcace,_0x216dc4=_0x3689fe[_0x3e1753(0x2b3)][_0x102b0f];_0x58a820[_0x216dc4]={'buildingCount':0x0,'buildingList':[]};}),buildingGeojson[_0x2dcace(0x249)][_0x2dcace(0x23b)]((_0x5d5f54,_0x109cbb)=>{const _0x460211=_0x2dcace;try{let _0x5b4385;if(_0x5d5f54[_0x460211(0x1b6)][_0x460211(0x237)]===_0x460211(0x240)){const _0x497457=turf['centroid'](_0x5d5f54);_0x5b4385=_0x497457[_0x460211(0x1b6)][_0x460211(0x276)];}else{if(_0x5d5f54['geometry'][_0x460211(0x237)]===_0x460211(0x247)){const _0x1450b1={'type':'Feature','properties':{},'geometry':{'type':_0x460211(0x240),'coordinates':_0x5d5f54[_0x460211(0x1b6)]['coordinates'][0x0]}},_0x55ed5a=turf[_0x460211(0x28c)](_0x1450b1);_0x5b4385=_0x55ed5a[_0x460211(0x1b6)][_0x460211(0x276)];}else throw new Error(_0x460211(0x1bd)+_0x5d5f54[_0x460211(0x1b6)][_0x460211(0x237)]);}let _0x4a3ba9=0x0,_0x16a6b3=0x1;if(typeof _0x5d5f54['properties'][_0x460211(0x2a1)]==='number')_0x4a3ba9=_0x5d5f54['properties'][_0x460211(0x2a1)];else typeof _0x5d5f54[_0x460211(0x2b3)][_0x460211(0x2a1)]===_0x460211(0x28e)&&(_0x4a3ba9=parseFloat(_0x5d5f54[_0x460211(0x2b3)][_0x460211(0x2a1)])||0x0);if(typeof _0x5d5f54[_0x460211(0x2b3)][_0x460211(0x22e)]==='number')_0x16a6b3=_0x5d5f54[_0x460211(0x2b3)][_0x460211(0x22e)];else typeof _0x5d5f54[_0x460211(0x2b3)][_0x460211(0x22e)]===_0x460211(0x28e)&&(_0x16a6b3=parseInt(_0x5d5f54[_0x460211(0x2b3)]['BL_NSTOREY'])||0x1);_0x4a3ba9=isNaN(_0x4a3ba9)||_0x4a3ba9<0x0?0x0:_0x4a3ba9,_0x16a6b3=isNaN(_0x16a6b3)||_0x16a6b3<0x1?0x1:_0x16a6b3;const _0x18697e=_0x4a3ba9*_0x16a6b3;console['log'](_0x460211(0x209)+_0x109cbb+':\x20'+_0x4a3ba9+_0x460211(0x254)+_0x16a6b3+'\x20floors\x20=\x20'+_0x18697e+_0x460211(0x22d));for(const _0x1278c2 of parcelGeojson[_0x460211(0x249)]){if(turf[_0x460211(0x1fd)](_0x5b4385,_0x1278c2[_0x460211(0x1b6)])){const _0x24a45d=_0x1278c2[_0x460211(0x2b3)][_0x102b0f];_0x44a776[_0x24a45d]+=_0x18697e,_0x58a820[_0x24a45d]['buildingCount']++,_0x58a820[_0x24a45d][_0x460211(0x1b8)]['push']({'id':_0x109cbb,'area':_0x4a3ba9,'storeys':_0x16a6b3,'totalArea':_0x18697e});break;}}}catch(_0x56aec3){console[_0x460211(0x1f8)](_0x460211(0x261)+_0x109cbb+':',_0x56aec3);}}),_0x173597[_0x2dcace(0x249)]['forEach'](_0x17f739=>{const _0x404774=_0x2dcace,_0x54f335=_0x17f739['properties'][_0x102b0f];_0x17f739[_0x404774(0x2b3)][_0x404774(0x1f3)]=_0x44a776[_0x54f335]||0x0;if(resultGeojson&&resultGeojson[_0x404774(0x249)]){const _0x27874d=resultGeojson[_0x404774(0x249)]['find'](_0x56989b=>_0x56989b[_0x404774(0x2b3)][_0x102b0f]===_0x54f335);_0x27874d&&(_0x17f739['properties'][_0x404774(0x1ff)]=_0x27874d['properties'][_0x404774(0x1ff)],_0x17f739['properties'][_0x404774(0x244)]=_0x27874d[_0x404774(0x2b3)][_0x404774(0x244)]);}_0x17f739[_0x404774(0x2b3)][_0x404774(0x1f3)]=Math['round'](_0x17f739[_0x404774(0x2b3)][_0x404774(0x1f3)]*0x64)/0x64;}),resultGeojson=_0x173597;resultLayer&&(map['removeLayer'](resultLayer),delete layerData['parcelsBuildingAreas']);_0x173597[_0x2dcace(0x249)][_0x2dcace(0x23b)](_0x58d480=>{const _0x596cf0=_0x2dcace,_0x20d931=_0x58d480['properties'][_0x102b0f];if(_0x58a820[_0x20d931]){_0x58d480[_0x596cf0(0x2b3)][_0x596cf0(0x290)]=_0x58a820[_0x20d931]['buildingCount'];let _0x14f580=_0x596cf0(0x252);_0x58a820[_0x20d931]['buildingList'][_0x596cf0(0x23b)](_0x37ced4=>{const _0x120b4d=_0x596cf0;_0x14f580+=_0x120b4d(0x209)+_0x37ced4['id']+':\x20'+_0x37ced4[_0x120b4d(0x1e3)]+_0x120b4d(0x254)+_0x37ced4[_0x120b4d(0x224)]+_0x120b4d(0x2a6)+_0x37ced4['totalArea']+_0x120b4d(0x242);}),_0x58d480[_0x596cf0(0x2b3)]['calculationDetails']=_0x14f580;}else _0x58d480[_0x596cf0(0x2b3)][_0x596cf0(0x290)]=0x0,_0x58d480[_0x596cf0(0x2b3)][_0x596cf0(0x266)]=_0x596cf0(0x1b9);}),addGeoJSONToMap(resultGeojson,_0x2dcace(0x1e7),_0x2dcace(0x21f));let _0x4f5c8c=0x0,_0x26078f=0x0;Object[_0x2dcace(0x1ef)](_0x58a820)[_0x2dcace(0x23b)](_0x4297f1=>{const _0x36e8bf=_0x2dcace;_0x4f5c8c+=_0x58a820[_0x4297f1][_0x36e8bf(0x290)],_0x58a820[_0x4297f1][_0x36e8bf(0x1b8)][_0x36e8bf(0x23b)](_0x464686=>{const _0x1a4d2f=_0x36e8bf;_0x26078f+=_0x464686[_0x1a4d2f(0x1df)];});}),document[_0x2dcace(0x24b)](_0x2dcace(0x273))[_0x2dcace(0x26b)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20building\x20areas\x20calculated\x20per\x20parcel</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20buildings\x20processed:\x20'+_0x4f5c8c+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20building\x20area:\x20'+Math[_0x2dcace(0x207)](_0x26078f*0x64)/0x64+'\x20sq.m</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Formula:\x20Building\x20Area\x20×\x20Number\x20of\x20Floors\x20=\x20Total\x20Building\x20Area</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>CRS:\x20'+document[_0x2dcace(0x24b)](_0x2dcace(0x24d))[_0x2dcace(0x2a5)]+_0x2dcace(0x1de),document[_0x2dcace(0x24b)](_0x2dcace(0x273))['style'][_0x2dcace(0x27b)]=_0x2dcace(0x1e9),document[_0x2dcace(0x24b)](_0x2dcace(0x1c5))[_0x2dcace(0x23d)]=![],document[_0x2dcace(0x24b)](_0x2dcace(0x1b5))[_0x2dcace(0x20e)][_0x2dcace(0x27b)]=_0x2dcace(0x20d);}catch(_0x108172){console[_0x2dcace(0x20b)](_0x2dcace(0x1d1),_0x108172),alert(_0x2dcace(0x274)+_0x108172['message']),document[_0x2dcace(0x24b)](_0x2dcace(0x1b5))[_0x2dcace(0x20e)]['display']=_0x2dcace(0x20d);}},0x64);}function processStep4(){const _0x4f956e=_0x58e5a6;if(!resultGeojson){alert(_0x4f956e(0x1ec));return;}document[_0x4f956e(0x24b)](_0x4f956e(0x1b5))['style']['display']=_0x4f956e(0x1e9),setTimeout(()=>{const _0x31b9eb=_0x4f956e;try{console[_0x31b9eb(0x1ae)]('Starting\x20step\x204\x20processing\x20-\x20calculating\x20OSR...');const _0x37d87e=document['getElementById'](_0x31b9eb(0x1bf))[_0x31b9eb(0x2a5)],_0x39a778=JSON['parse'](JSON[_0x31b9eb(0x1b2)](resultGeojson));_0x39a778[_0x31b9eb(0x249)][_0x31b9eb(0x23b)](_0x415832=>{const _0x137b1e=_0x31b9eb,_0x1bccd7=_0x415832[_0x137b1e(0x2b3)][_0x137b1e(0x1ff)]||0x0,_0x4ff217=_0x415832[_0x137b1e(0x2b3)][_0x137b1e(0x1f3)]||0x0;_0x4ff217>0x0?_0x415832[_0x137b1e(0x2b3)][_0x137b1e(0x226)]=_0x1bccd7/_0x4ff217*0x64:_0x415832['properties'][_0x137b1e(0x226)]=0x0,_0x415832[_0x137b1e(0x2b3)][_0x137b1e(0x226)]=Math[_0x137b1e(0x207)](_0x415832[_0x137b1e(0x2b3)][_0x137b1e(0x226)]*0x64)/0x64;});resultLayer&&(map[_0x31b9eb(0x24f)](resultLayer),delete layerData[_0x31b9eb(0x2ab)]);addGeoJSONToMap(_0x39a778,_0x31b9eb(0x2ab),_0x31b9eb(0x1ca)),window[_0x31b9eb(0x2a2)]=_0x39a778;let _0x5dc9f2=0x0,_0x502610=0x0,_0x2b98bd=0x0,_0x32d4b6=_0x39a778['features']['length'],_0x3e64c8=0x0,_0x1e3928=[];_0x39a778[_0x31b9eb(0x249)][_0x31b9eb(0x23b)](_0x5ab246=>{const _0x3661dc=_0x31b9eb;_0x5ab246['properties'][_0x3661dc(0x244)]>0x0&&(_0x5dc9f2+=_0x5ab246['properties']['parcelArea'],_0x502610+=_0x5ab246['properties'][_0x3661dc(0x1ff)]||0x0,_0x2b98bd+=_0x5ab246[_0x3661dc(0x2b3)][_0x3661dc(0x1f3)]||0x0,_0x5ab246[_0x3661dc(0x2b3)][_0x3661dc(0x226)]!==undefined&&_0x5ab246[_0x3661dc(0x2b3)][_0x3661dc(0x1f3)]>0x0&&_0x1e3928[_0x3661dc(0x246)](_0x5ab246['properties'][_0x3661dc(0x226)]),_0x3e64c8++);});const _0x3a3f8e=_0x1e3928[_0x31b9eb(0x1dd)]>0x0?_0x1e3928[_0x31b9eb(0x263)]((_0x37486a,_0x15a098)=>_0x37486a+_0x15a098,0x0)/_0x1e3928[_0x31b9eb(0x1dd)]:0x0,_0x392c26=_0x1e3928[_0x31b9eb(0x1dd)]>0x0?Math[_0x31b9eb(0x2a7)](..._0x1e3928):0x0,_0x4b609a=_0x1e3928[_0x31b9eb(0x1dd)]>0x0?Math[_0x31b9eb(0x1fc)](..._0x1e3928):0x0;document['getElementById'](_0x31b9eb(0x1e4))[_0x31b9eb(0x26b)]=_0x31b9eb(0x1f2)+_0x32d4b6+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20parcel\x20area:\x20'+Math[_0x31b9eb(0x207)](_0x5dc9f2*0x64)/0x64+'\x20sq.m</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20open\x20space:\x20'+Math[_0x31b9eb(0x207)](_0x502610*0x64)/0x64+_0x31b9eb(0x1b7)+Math[_0x31b9eb(0x207)](_0x2b98bd*0x64)/0x64+_0x31b9eb(0x233)+Math['round'](_0x3a3f8e*0x64)/0x64+_0x31b9eb(0x294)+Math[_0x31b9eb(0x207)](_0x392c26*0x64)/0x64+_0x31b9eb(0x1ad)+Math[_0x31b9eb(0x207)](_0x4b609a*0x64)/0x64+_0x31b9eb(0x27c)+document[_0x31b9eb(0x24b)]('coordSystem')[_0x31b9eb(0x2a5)]+_0x31b9eb(0x1de),document[_0x31b9eb(0x24b)]('step4Result')['style'][_0x31b9eb(0x27b)]=_0x31b9eb(0x1e9),document[_0x31b9eb(0x24b)]('exportButton')['disabled']=![],document[_0x31b9eb(0x24b)](_0x31b9eb(0x22b))[_0x31b9eb(0x23d)]=![],document[_0x31b9eb(0x24b)](_0x31b9eb(0x1b5))['style'][_0x31b9eb(0x27b)]='none';}catch(_0x6d0908){console[_0x31b9eb(0x20b)](_0x31b9eb(0x26a),_0x6d0908),alert(_0x31b9eb(0x239)+_0x6d0908[_0x31b9eb(0x1b4)]),document[_0x31b9eb(0x24b)]('loadingIndicator')['style']['display']='none';}},0x64);}function exportResult(){const _0x2ffc3f=_0x58e5a6;if(!window['finalResultGeojson']){alert(_0x2ffc3f(0x21e));return;}const _0x460dda=JSON['parse'](JSON['stringify'](window[_0x2ffc3f(0x2a2)]));parcelGeojson&&parcelGeojson[_0x2ffc3f(0x1cb)]?_0x460dda[_0x2ffc3f(0x1cb)]=parcelGeojson['crs']:_0x460dda['crs']={'type':_0x2ffc3f(0x202),'properties':{'name':'EPSG:4326'}};_0x460dda['properties']=_0x460dda[_0x2ffc3f(0x2b3)]||{},_0x460dda['properties'][_0x2ffc3f(0x285)]=_0x2ffc3f(0x1af);const _0x74d27b=new Blob([JSON[_0x2ffc3f(0x1b2)](_0x460dda)],{'type':_0x2ffc3f(0x269)}),_0x30de36=URL[_0x2ffc3f(0x23c)](_0x74d27b),_0x5ce439=document[_0x2ffc3f(0x28a)]('a');_0x5ce439[_0x2ffc3f(0x265)]=_0x30de36,_0x5ce439[_0x2ffc3f(0x25d)]=_0x2ffc3f(0x1f7),document[_0x2ffc3f(0x255)]['appendChild'](_0x5ce439),_0x5ce439[_0x2ffc3f(0x1eb)](),document[_0x2ffc3f(0x255)]['removeChild'](_0x5ce439),URL[_0x2ffc3f(0x2a3)](_0x30de36);}function exportExcel(){const _0xc2b7fa=_0x58e5a6;if(!window[_0xc2b7fa(0x2a2)]){alert(_0xc2b7fa(0x21e));return;}const _0x1b8fcd=document[_0xc2b7fa(0x24b)]('coordSystem')[_0xc2b7fa(0x2a5)],_0x133c99=document['getElementById'](_0xc2b7fa(0x1bf))[_0xc2b7fa(0x2a5)]||'ID',_0x39c2c0=XLSX[_0xc2b7fa(0x1f9)][_0xc2b7fa(0x278)](),_0x15f28e=window[_0xc2b7fa(0x2a2)]['features']['map'](_0x1cb150=>{const _0x364ad4=_0xc2b7fa;return{[_0x133c99]:_0x1cb150[_0x364ad4(0x2b3)][_0x133c99],'Parcel\x20Area\x20(sq.m)':_0x1cb150[_0x364ad4(0x2b3)]['parcelArea'],'Open\x20Space\x20Area\x20(sq.m)':_0x1cb150[_0x364ad4(0x2b3)][_0x364ad4(0x1ff)],'Total\x20Building\x20Area\x20(sq.m)':_0x1cb150['properties']['totalBuildingArea'],'OSR\x20(%)':_0x1cb150[_0x364ad4(0x2b3)][_0x364ad4(0x226)],'Building\x20Count':_0x1cb150[_0x364ad4(0x2b3)][_0x364ad4(0x290)]||0x0};});let _0x48d130=_0x15f28e['filter'](_0x4c2254=>_0x4c2254['Total\x20Building\x20Area\x20(sq.m)']>0x0)[_0xc2b7fa(0x1da)](_0x581e03=>_0x581e03[_0xc2b7fa(0x27d)]);const _0x422145=_0x48d130[_0xc2b7fa(0x1dd)]>0x0?_0x48d130[_0xc2b7fa(0x263)]((_0x22ee3d,_0x590bbe)=>_0x22ee3d+_0x590bbe,0x0)/_0x48d130['length']:0x0,_0x55ebae=_0x48d130['length']>0x0?Math[_0xc2b7fa(0x2a7)](..._0x48d130):0x0,_0x322389=_0x48d130[_0xc2b7fa(0x1dd)]>0x0?Math[_0xc2b7fa(0x1fc)](..._0x48d130):0x0;_0x15f28e[_0xc2b7fa(0x246)]({}),_0x15f28e[_0xc2b7fa(0x246)]({[_0x133c99]:'SUMMARY\x20STATISTICS'}),_0x15f28e[_0xc2b7fa(0x246)]({[_0x133c99]:_0xc2b7fa(0x21a),'OSR\x20(%)':Math[_0xc2b7fa(0x207)](_0x422145*0x64)/0x64}),_0x15f28e[_0xc2b7fa(0x246)]({[_0x133c99]:_0xc2b7fa(0x1f6),'OSR\x20(%)':Math[_0xc2b7fa(0x207)](_0x55ebae*0x64)/0x64}),_0x15f28e[_0xc2b7fa(0x246)]({[_0x133c99]:_0xc2b7fa(0x2b8),'OSR\x20(%)':Math[_0xc2b7fa(0x207)](_0x322389*0x64)/0x64});const _0x32362d=XLSX[_0xc2b7fa(0x1f9)]['json_to_sheet'](_0x15f28e);XLSX['utils'][_0xc2b7fa(0x1b1)](_0x39c2c0,_0x32362d,_0xc2b7fa(0x1ea)),XLSX[_0xc2b7fa(0x284)](_0x39c2c0,_0xc2b7fa(0x225)+_0x1b8fcd['replace'](':','_')+'.xlsx');}function init(){const _0x1ef11e=_0x58e5a6;initMap(),document[_0x1ef11e(0x24b)]('coordSystem')[_0x1ef11e(0x1b3)](_0x1ef11e(0x1ed),function(){initMap();}),document[_0x1ef11e(0x24b)](_0x1ef11e(0x221))['addEventListener'](_0x1ef11e(0x1ed),function(){const _0x4cd01f=_0x1ef11e;handleFileUpload(this,_0x4cd01f(0x1e5));}),document[_0x1ef11e(0x24b)](_0x1ef11e(0x24c))[_0x1ef11e(0x1b3)](_0x1ef11e(0x1ed),function(){const _0x3b23bb=_0x1ef11e;handleFileUpload(this,_0x3b23bb(0x29b));}),document[_0x1ef11e(0x24b)]('processStep1')[_0x1ef11e(0x1b3)]('click',processStep1),document['getElementById'](_0x1ef11e(0x241))[_0x1ef11e(0x1b3)](_0x1ef11e(0x1eb),processStep2),document['getElementById'](_0x1ef11e(0x1e0))[_0x1ef11e(0x1b3)](_0x1ef11e(0x1eb),processStep3),document[_0x1ef11e(0x24b)]('processStep4')[_0x1ef11e(0x1b3)](_0x1ef11e(0x1eb),processStep4),document['getElementById']('exportButton')[_0x1ef11e(0x1b3)](_0x1ef11e(0x1eb),exportResult),document[_0x1ef11e(0x24b)](_0x1ef11e(0x22b))[_0x1ef11e(0x1b3)](_0x1ef11e(0x1eb),exportExcel),document[_0x1ef11e(0x24b)](_0x1ef11e(0x279))[_0x1ef11e(0x1b3)](_0x1ef11e(0x1ed),function(){const _0x272383=_0x1ef11e;displayAttributes(this[_0x272383(0x2a5)]);}),console[_0x1ef11e(0x1ae)](_0x1ef11e(0x1d9));}window[_0x58e5a6(0x1c4)]=init;
  </script>
</body>
</html>