<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Building Coverage Ratio Web App</title>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    html, body, #mapDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
    #controlPanel {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 15px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      max-width: 350px;
      z-index: 1000;
      max-height: 80vh;
      overflow-y: auto;
    }
    #layerPanel {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 15px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      max-width: 300px;
      z-index: 1000;
    }
    .button {
      margin-top: 10px;
      padding: 8px 12px;
      background-color: #0079c1;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
    }
    .button:hover {
      background-color: #005e95;
    }
    .button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .file-input-container {
      margin-bottom: 10px;
    }
    .field-selector {
      margin-top: 10px;
      width: 100%;
    }
    .result-info {
      margin-top: 15px;
      padding: 10px;
      background-color: #f8f8f8;
      border-radius: 4px;
      font-size: 14px;
    }
    .loading {
      display: none;
      color: #0079c1;
      margin-top: 15px;
      text-align: center;
    }
    .layer-item {
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }
    .layer-toggle {
      margin-right: 8px;
    }
    .layer-label {
      font-size: 14px;
      cursor: pointer;
    }
    .attribute-table {
      margin-top: 15px;
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    .attribute-table th, .attribute-table td {
      border: 1px solid #ddd;
      padding: 6px;
      text-align: left;
    }
    .attribute-table th {
      background-color: #f2f2f2;
    }
    .attribute-panel {
      margin-top: 15px;
      padding: 8px;
      background-color: #f8f8f8;
      border-radius: 4px;
      max-height: 300px;
      overflow-y: auto;
    }
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .panel-title {
      font-weight: bold;
      margin: 0;
    }
    hr {
      margin: 15px 0;
      border: 0;
      border-top: 1px solid #ddd;
    }
    .info-popup {
      max-height: 200px;
      overflow-y: auto;
    }
    .crs-selector {
      margin-top: 10px;
      margin-bottom: 5px;
    }
    .export-options {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }
    .export-button {
      flex: 1;
    }
    .home-button {
  position: absolute;
  top: 15px;
  right: 15px;
  z-index: 1001;
}
.home-button a {
  display: block;
  padding: 8px;
  color: #0079c1;
  background-color: white;
  border-radius: 50%;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  text-decoration: none;
  text-align: center;
}
.home-button a:hover {
  background-color: #f0f0f0;
}
.home-button i {
  font-size: 18px;
}
  </style>
</head>
<body>
  <div id="mapDiv"></div>
  
  <!-- Main Control Panel -->
  <div id="controlPanel">
    <div class="panel-header">
      <h2 class="panel-title">Building Coverage Ratio Web App</h2>
      <div class="home-button">
        <a href="page11.html" title="Back to Main Page">
          <i class="fas fa-home"></i>
        </a>
      </div>
    </div>
    
    <div class="crs-selector">
      <label for="coordSystem">Coordinate Reference System:</label>
      <select id="coordSystem" class="field-selector">
        <option value="EPSG:4326">EPSG:4326 (WGS84)</option>
        <option value="EPSG:32647">EPSG:32647 (UTM Zone 47N)</option>
        <option value="EPSG:32648">EPSG:32648 (UTM Zone 48N)</option>
      </select>
    </div>
    
    <div class="file-input-container">
      <label for="buildingFile">1. Upload Building GeoJSON:</label>
      <input type="file" id="buildingFile" accept=".geojson,.json">
      <div id="buildingStatus"></div>
    </div>
    
    <div class="file-input-container">
      <label for="parcelFile">2. Upload Land Parcel GeoJSON:</label>
      <input type="file" id="parcelFile" accept=".geojson,.json">
      <div id="parcelStatus"></div>
    </div>
    
    <div id="fieldSelectorContainer" style="display:none;">
      <label for="parcelFieldSelector">Select Parcel Identifier Field:</label>
      <select id="parcelFieldSelector" class="field-selector"></select>
    </div>
    
    <button id="processStep1" class="button" disabled>3.1 Calculate Parcel Area</button>
    <div id="step1Result" class="result-info" style="display:none;"></div>
    
    <button id="processStep2" class="button" disabled>3.2 Extract Parcel Information</button>
    <div id="step2Result" class="result-info" style="display:none;"></div>
    
    <button id="processStep3" class="button" disabled>3.3 Calculate Total Building Coverage Area</button>
    <div id="step3Result" class="result-info" style="display:none;"></div>
    
    <button id="processStep4" class="button" disabled>3.4 Calculate BCR</button>
    <div id="step4Result" class="result-info" style="display:none;"></div>
    
    <div class="export-options">
      <button id="exportButton" class="button export-button" disabled>4.1 Export as GeoJSON</button>
      <button id="exportExcelButton" class="button export-button" disabled>4.2 Export as Excel</button>
    </div>
    
    <div id="loadingIndicator" class="loading">
      <i class="fas fa-cog fa-spin"></i> Processing...
    </div>
    
    <hr>
    
    <!-- Attribute Viewer Section -->
    <div class="panel-header">
      <h3 class="panel-title">Attribute Viewer</h3>
    </div>
    
    <div>
      <label for="layerSelect">Select Layer for Attributes:</label>
      <select id="layerSelect" class="field-selector">
        <option value="">-- Select a layer --</option>
      </select>
    </div>
    
    <div id="attributePanel" class="attribute-panel" style="display:none;">
      <div id="attributeContent"></div>
    </div>
  </div>
  
  <!-- Layer Control Panel -->
  <div id="layerPanel">
    <div class="panel-header">
      <h3 class="panel-title">Map Layers</h3>
    </div>
    <div id="layerList">
      <!-- Layer toggles will be added here dynamically -->
      <div class="layer-item">
        <span class="layer-label">No layers available</span>
      </div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
  <!-- Turf.js for geometry operations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/6.5.0/turf.min.js"></script>
  <!-- Proj4js for coordinate transformations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>
  <!-- Proj4Leaflet for CRS handling in Leaflet -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4leaflet/1.0.2/proj4leaflet.min.js"></script>
  <!-- Esri Leaflet for ESRI basemaps -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/esri-leaflet/3.0.10/esri-leaflet.js"></script>
  <!-- SheetJS (XLSX) for Excel export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <script>
const _0x1f047d=_0x2623;(function(_0x508c4c,_0x5d9c05){const _0x3ad33b=_0x2623,_0xd0f230=_0x508c4c();while(!![]){try{const _0x38c931=-parseInt(_0x3ad33b(0x21a))/0x1+-parseInt(_0x3ad33b(0x1c9))/0x2+-parseInt(_0x3ad33b(0x12c))/0x3*(-parseInt(_0x3ad33b(0x222))/0x4)+-parseInt(_0x3ad33b(0x1e1))/0x5*(parseInt(_0x3ad33b(0x1ca))/0x6)+parseInt(_0x3ad33b(0x1b8))/0x7+parseInt(_0x3ad33b(0x18e))/0x8*(parseInt(_0x3ad33b(0x1b1))/0x9)+-parseInt(_0x3ad33b(0x168))/0xa*(parseInt(_0x3ad33b(0x1a2))/0xb);if(_0x38c931===_0x5d9c05)break;else _0xd0f230['push'](_0xd0f230['shift']());}catch(_0xcfc5e1){_0xd0f230['push'](_0xd0f230['shift']());}}}(_0x3556,0xb3037));let map,buildingLayer,parcelLayer,resultLayer,buildingGeojson,parcelGeojson,resultGeojson,parcelFields=[],currentCRS=_0x1f047d(0x1c2),basemapLayer,allLayers=[],layerData={};proj4[_0x1f047d(0x195)]('EPSG:32647',_0x1f047d(0x1e2)),proj4[_0x1f047d(0x195)](_0x1f047d(0x17a),'+proj=utm\x20+zone=48\x20+datum=WGS84\x20+units=m\x20+no_defs');const crs={'EPSG:4326':L[_0x1f047d(0x1f5)][_0x1f047d(0x1d8)],'EPSG:32647':new L['Proj']['CRS'](_0x1f047d(0x19c),proj4[_0x1f047d(0x195)](_0x1f047d(0x19c)),{'resolutions':[0x100,0x80,0x40,0x20,0x10,0x8,0x4,0x2,0x1,0.5,0.25],'origin':[0x0,0x0]}),'EPSG:32648':new L[(_0x1f047d(0x1a9))][(_0x1f047d(0x1f5))](_0x1f047d(0x17a),proj4[_0x1f047d(0x195)](_0x1f047d(0x17a)),{'resolutions':[0x100,0x80,0x40,0x20,0x10,0x8,0x4,0x2,0x1,0.5,0.25],'origin':[0x0,0x0]})};function initMap(){const _0x2f472a=_0x1f047d,_0x4992ce=document[_0x2f472a(0x17e)](_0x2f472a(0x145))[_0x2f472a(0x1c0)];currentCRS=_0x4992ce,map&&map[_0x2f472a(0x225)](),map=L[_0x2f472a(0x217)](_0x2f472a(0x1d7),{'crs':crs[_0x4992ce]})['setView']([13.7,100.5],0xa),_0x4992ce===_0x2f472a(0x1c2)?(basemapLayer=L[_0x2f472a(0x172)]['basemapLayer'](_0x2f472a(0x191),{'detectRetina':!![]})[_0x2f472a(0x170)](map),L[_0x2f472a(0x172)]['basemapLayer'](_0x2f472a(0x1d5))[_0x2f472a(0x170)](map)):(basemapLayer=L[_0x2f472a(0x181)]([[-0x5a,-0xb4],[0x5a,0xb4]],{'color':'#f8f8f8','weight':0x1,'fillColor':_0x2f472a(0x17f),'fillOpacity':0x1})[_0x2f472a(0x170)](map),L[_0x2f472a(0x1ed)]['attribution']({'prefix':'Base\x20map\x20limited\x20in\x20UTM\x20projection.\x20Switch\x20to\x20EPSG:4326\x20for\x20full\x20basemap.'})[_0x2f472a(0x170)](map)),console[_0x2f472a(0x199)](_0x2f472a(0x206)+_0x4992ce),reloadLayers();}function reloadLayers(){const _0x587569=_0x1f047d;buildingLayer&&map[_0x587569(0x224)](buildingLayer)&&map[_0x587569(0x131)](buildingLayer);parcelLayer&&map[_0x587569(0x224)](parcelLayer)&&map[_0x587569(0x131)](parcelLayer);resultLayer&&map[_0x587569(0x224)](resultLayer)&&map[_0x587569(0x131)](resultLayer);buildingGeojson&&addGeoJSONToMap(buildingGeojson,'building',_0x587569(0x185));parcelGeojson&&addGeoJSONToMap(parcelGeojson,_0x587569(0x20f),_0x587569(0x158));if(resultGeojson){let _0x297af8=_0x587569(0x19e),_0x2ba674=_0x587569(0x137);if(resultGeojson['features']['length']>0x0){const _0x27f0de=resultGeojson[_0x587569(0x157)][0x0][_0x587569(0x15e)];if(_0x27f0de[_0x587569(0x209)]!==undefined)_0x297af8=_0x587569(0x19e),_0x2ba674=_0x587569(0x137);else{if(_0x27f0de[_0x587569(0x21f)]!==undefined)_0x297af8='parcelsBuildingAreas',_0x2ba674='Parcels\x20with\x20Building\x20Coverage\x20Areas';else _0x27f0de[_0x587569(0x210)]!==undefined&&(_0x297af8=_0x587569(0x210),_0x2ba674=_0x587569(0x183));}}addGeoJSONToMap(resultGeojson,_0x297af8,_0x2ba674);}}function checkCRS(_0x3f111b){const _0x5a002b=_0x1f047d,_0x91b16b=document[_0x5a002b(0x17e)](_0x5a002b(0x145))['value'];if(!_0x3f111b||!_0x3f111b[_0x5a002b(0x157)]||_0x3f111b[_0x5a002b(0x157)][_0x5a002b(0x139)]===0x0)return![];const _0x185313=_0x3f111b[_0x5a002b(0x157)][0x0];let _0x26c01f=[];if(_0x185313[_0x5a002b(0x15a)]['type']===_0x5a002b(0x1c3))_0x26c01f=_0x185313[_0x5a002b(0x15a)][_0x5a002b(0x1af)];else{if(_0x185313[_0x5a002b(0x15a)][_0x5a002b(0x21c)]===_0x5a002b(0x1eb)||_0x185313[_0x5a002b(0x15a)][_0x5a002b(0x21c)]==='MultiPoint')_0x26c01f=_0x185313[_0x5a002b(0x15a)]['coordinates'][0x0];else{if(_0x185313[_0x5a002b(0x15a)][_0x5a002b(0x21c)]==='Polygon'||_0x185313[_0x5a002b(0x15a)][_0x5a002b(0x21c)]==='MultiLineString')_0x26c01f=_0x185313[_0x5a002b(0x15a)][_0x5a002b(0x1af)][0x0][0x0];else _0x185313['geometry'][_0x5a002b(0x21c)]===_0x5a002b(0x188)&&(_0x26c01f=_0x185313[_0x5a002b(0x15a)][_0x5a002b(0x1af)][0x0][0x0][0x0]);}}if(_0x26c01f[_0x5a002b(0x139)]<0x2)return![];const _0x2ae56b=_0x26c01f[0x0],_0x8c4158=_0x26c01f[0x1];return _0x91b16b===_0x5a002b(0x1c2)?_0x2ae56b>=-0xb4&&_0x2ae56b<=0xb4&&_0x8c4158>=-0x5a&&_0x8c4158<=0x5a:_0x2ae56b>0x186a0&&_0x8c4158>0x186a0;}function getRandomColor(){const _0x21e26f=_0x1f047d,_0x1d2114='0123456789ABCDEF';let _0x7476d='#';for(let _0x552e03=0x0;_0x552e03<0x6;_0x552e03++){_0x7476d+=_0x1d2114[Math[_0x21e26f(0x1f7)](Math[_0x21e26f(0x194)]()*0x10)];}return _0x7476d;}function addGeoJSONToMap(_0x5062f0,_0x3d5e64,_0x40c0bd){const _0x10aca3=_0x1f047d,_0x2c1132=document[_0x10aca3(0x17e)](_0x10aca3(0x145))[_0x10aca3(0x1c0)];let _0x304334=JSON['parse'](JSON[_0x10aca3(0x1b2)](_0x5062f0));const _0x53316b={'color':_0x3d5e64===_0x10aca3(0x187)?'#ff0000':_0x10aca3(0x12e),'weight':0x1,'opacity':0x1,'fillOpacity':0.5};if(_0x3d5e64===_0x10aca3(0x210))_0x53316b[_0x10aca3(0x203)]=_0x10aca3(0x151);else{if(_0x3d5e64===_0x10aca3(0x16f))_0x53316b[_0x10aca3(0x203)]=_0x10aca3(0x151);else _0x3d5e64===_0x10aca3(0x19e)&&(_0x53316b['color']=_0x10aca3(0x151));}let _0xcc62a4;if(_0x3d5e64==='finalResult'){function _0x18e80f(_0x599ba8){const _0x32cde6=_0x10aca3;return _0x599ba8<0x14?_0x32cde6(0x12e):_0x599ba8<0x28?_0x32cde6(0x133):_0x599ba8<0x3c?'#ffa500':_0x32cde6(0x1d0);}_0xcc62a4=L['geoJSON'](_0x304334,{'coordsToLatLng':function(_0x486a25){const _0x283885=_0x10aca3;if(_0x2c1132!==_0x283885(0x1c2)){const _0x1c1bf1=proj4(_0x2c1132,_0x283885(0x1c2),_0x486a25);return new L[(_0x283885(0x212))](_0x1c1bf1[0x1],_0x1c1bf1[0x0]);}return new L[(_0x283885(0x212))](_0x486a25[0x1],_0x486a25[0x0]);},'style':function(_0xa143ab){const _0x20d38c=_0x10aca3;return{'fillColor':_0x18e80f(_0xa143ab[_0x20d38c(0x15e)][_0x20d38c(0x209)]),'weight':0x1,'opacity':0x1,'color':'#000000','fillOpacity':0.7};},'onEachFeature':function(_0x320a9d,_0x97c265){const _0x4b14e7=_0x10aca3,_0x1dbe37=document[_0x4b14e7(0x17e)](_0x4b14e7(0x175))[_0x4b14e7(0x1c0)]||'ID',_0x138146='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info-popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>'+_0x1dbe37+':</strong>\x20'+_0x320a9d[_0x4b14e7(0x15e)][_0x1dbe37]+_0x4b14e7(0x21e)+_0x320a9d[_0x4b14e7(0x15e)][_0x4b14e7(0x210)]+_0x4b14e7(0x1aa)+_0x320a9d[_0x4b14e7(0x15e)]['totalBuildingArea']+'\x20sq.m<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>BCR:</strong>\x20'+_0x320a9d[_0x4b14e7(0x15e)][_0x4b14e7(0x209)]+_0x4b14e7(0x1b9)+(_0x320a9d[_0x4b14e7(0x15e)]['buildingCount']||0x0)+_0x4b14e7(0x130)+(_0x320a9d[_0x4b14e7(0x15e)][_0x4b14e7(0x1db)]?_0x4b14e7(0x15b)+_0x320a9d[_0x4b14e7(0x15e)][_0x4b14e7(0x1db)]+_0x4b14e7(0x17b):'')+_0x4b14e7(0x19f);_0x97c265[_0x4b14e7(0x218)](_0x138146);}})['addTo'](map);}else{if(_0x3d5e64==='parcelsBuildingAreas'){function _0x1eb63c(_0x4af15f){const _0x31342d=_0x10aca3;return _0x4af15f<0x1f4?_0x31342d(0x133):_0x4af15f<0x3e8?_0x31342d(0x223):_0x4af15f<0x7d0?_0x31342d(0x1fd):_0x31342d(0x1d0);}_0xcc62a4=L[_0x10aca3(0x197)](_0x304334,{'coordsToLatLng':function(_0x1444cf){const _0x4f54ec=_0x10aca3;if(_0x2c1132!==_0x4f54ec(0x1c2)){const _0x5dc2d4=proj4(_0x2c1132,_0x4f54ec(0x1c2),_0x1444cf);return new L[(_0x4f54ec(0x212))](_0x5dc2d4[0x1],_0x5dc2d4[0x0]);}return new L['LatLng'](_0x1444cf[0x1],_0x1444cf[0x0]);},'style':function(_0x3bfd82){const _0x19ccf6=_0x10aca3;return{'fillColor':_0x1eb63c(_0x3bfd82[_0x19ccf6(0x15e)][_0x19ccf6(0x21f)]),'weight':0x1,'opacity':0x1,'color':_0x19ccf6(0x151),'fillOpacity':0.7};},'onEachFeature':function(_0x28d347,_0x2914e3){const _0x5672ef=_0x10aca3,_0x5473f1=document[_0x5672ef(0x17e)]('parcelFieldSelector')[_0x5672ef(0x1c0)]||'ID',_0x17687b='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info-popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>'+_0x5473f1+_0x5672ef(0x21b)+_0x28d347[_0x5672ef(0x15e)][_0x5473f1]+'<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Building\x20Count:</strong>\x20'+(_0x28d347[_0x5672ef(0x15e)][_0x5672ef(0x1e3)]||0x0)+_0x5672ef(0x18b)+_0x28d347['properties'][_0x5672ef(0x21f)]+_0x5672ef(0x207)+(_0x28d347['properties']['calculationDetails']?'<strong>Calculation\x20Details:</strong><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<pre\x20style=\x22max-height:\x20100px;\x20overflow-y:\x20auto;\x22>'+_0x28d347[_0x5672ef(0x15e)][_0x5672ef(0x1db)]+_0x5672ef(0x17b):'')+_0x5672ef(0x19f);_0x2914e3[_0x5672ef(0x218)](_0x17687b);}})[_0x10aca3(0x170)](map);}else{if(_0x3d5e64==='parcelArea'){function _0x46d5a8(_0x209a00){const _0x1bcc99=_0x10aca3;return _0x209a00<0x1f4?'#ffff00':_0x209a00<0x3e8?'#ffaa00':_0x209a00<0x1388?_0x1bcc99(0x1fd):_0x1bcc99(0x1d0);}_0xcc62a4=L[_0x10aca3(0x197)](_0x304334,{'coordsToLatLng':function(_0x3b1020){const _0x9f84ee=_0x10aca3;if(_0x2c1132!==_0x9f84ee(0x1c2)){const _0x45b242=proj4(_0x2c1132,_0x9f84ee(0x1c2),_0x3b1020);return new L[(_0x9f84ee(0x212))](_0x45b242[0x1],_0x45b242[0x0]);}return new L[(_0x9f84ee(0x212))](_0x3b1020[0x1],_0x3b1020[0x0]);},'style':function(_0x2b1963){const _0x4bfce6=_0x10aca3;return{'fillColor':_0x46d5a8(_0x2b1963[_0x4bfce6(0x15e)][_0x4bfce6(0x210)]),'weight':0x1,'opacity':0x1,'color':_0x4bfce6(0x151),'fillOpacity':0.7};},'onEachFeature':function(_0x57d4dc,_0x106603){const _0x51fcc8=_0x10aca3,_0x59329c=document[_0x51fcc8(0x17e)](_0x51fcc8(0x175))['value']||'ID',_0x4ee32a=_0x51fcc8(0x1dd)+_0x59329c+_0x51fcc8(0x21b)+_0x57d4dc[_0x51fcc8(0x15e)][_0x59329c]+'<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Parcel\x20Area:</strong>\x20'+_0x57d4dc[_0x51fcc8(0x15e)][_0x51fcc8(0x210)]+'\x20sq.m\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';_0x106603[_0x51fcc8(0x218)](_0x4ee32a);}})[_0x10aca3(0x170)](map);}else _0x3d5e64==='buildingPoints'?_0xcc62a4=L['geoJSON'](_0x304334,{'coordsToLatLng':function(_0x45a740){const _0x38c3e8=_0x10aca3;if(_0x2c1132!=='EPSG:4326'){const _0x19f6fc=proj4(_0x2c1132,'EPSG:4326',_0x45a740);return new L[(_0x38c3e8(0x212))](_0x19f6fc[0x1],_0x19f6fc[0x0]);}return new L[(_0x38c3e8(0x212))](_0x45a740[0x1],_0x45a740[0x0]);},'pointToLayer':function(_0x3ba3be,_0x13da90){const _0x314c76=_0x10aca3;return L[_0x314c76(0x132)](_0x13da90,{'radius':0x6,'fillColor':_0x314c76(0x1d0),'color':_0x314c76(0x180),'weight':0x1,'opacity':0x1,'fillOpacity':0.8});},'onEachFeature':function(_0x334f42,_0x1f2cdb){const _0xe15395=_0x10aca3;let _0xe33054=_0xe15395(0x14d);for(const _0x2f6b6d in _0x334f42[_0xe15395(0x15e)]){_0xe33054+=_0xe15395(0x13f)+_0x2f6b6d+_0xe15395(0x21b)+_0x334f42[_0xe15395(0x15e)][_0x2f6b6d]+_0xe15395(0x153);}_0xe33054+='</div>',_0x1f2cdb[_0xe15395(0x218)](_0xe33054);}})[_0x10aca3(0x170)](map):_0xcc62a4=L[_0x10aca3(0x197)](_0x304334,{'coordsToLatLng':function(_0x338853){const _0x2ce935=_0x10aca3;if(_0x2c1132!=='EPSG:4326'){const _0x39e264=proj4(_0x2c1132,_0x2ce935(0x1c2),_0x338853);return new L['LatLng'](_0x39e264[0x1],_0x39e264[0x0]);}return new L[(_0x2ce935(0x212))](_0x338853[0x1],_0x338853[0x0]);},'style':_0x53316b,'onEachFeature':function(_0x13760f,_0xd0f626){const _0x23af12=_0x10aca3;let _0x32bdb2=_0x23af12(0x14d);for(const _0xdbaa8c in _0x13760f['properties']){_0x32bdb2+=_0x23af12(0x13f)+_0xdbaa8c+_0x23af12(0x21b)+_0x13760f[_0x23af12(0x15e)][_0xdbaa8c]+_0x23af12(0x153);}_0x32bdb2+=_0x23af12(0x1a4),_0xd0f626['bindPopup'](_0x32bdb2);}})[_0x10aca3(0x170)](map);}}if(_0x3d5e64===_0x10aca3(0x187))buildingLayer=_0xcc62a4;else _0x3d5e64===_0x10aca3(0x20f)?parcelLayer=_0xcc62a4:resultLayer=_0xcc62a4;addLayerToControl(_0xcc62a4,_0x3d5e64,_0x40c0bd,_0x304334);try{map[_0x10aca3(0x163)](_0xcc62a4['getBounds']());}catch(_0x19d0c4){console[_0x10aca3(0x1e0)](_0x10aca3(0x208),_0x19d0c4);}return _0xcc62a4;}function _0x2623(_0x53f168,_0x5bca95){const _0x3556a4=_0x3556();return _0x2623=function(_0x26234f,_0x58dda0){_0x26234f=_0x26234f-0x129;let _0x523b3d=_0x3556a4[_0x26234f];return _0x523b3d;},_0x2623(_0x53f168,_0x5bca95);}function addLayerToControl(_0x2d0255,_0x33baaa,_0x53e795,_0x380137){const _0xde4f46=_0x1f047d;if(layerData[_0x33baaa]){const _0x3a4194=allLayers[_0xde4f46(0x1da)](layerData[_0x33baaa]['layer']);_0x3a4194>-0x1&&allLayers[_0xde4f46(0x1ee)](_0x3a4194,0x1);}allLayers[_0xde4f46(0x16c)](_0x2d0255),layerData[_0x33baaa]={'layer':_0x2d0255,'title':_0x53e795,'geojson':_0x380137};const _0x2168c7=document['getElementById']('layerSelect');let _0x163dff=![];for(let _0x490f1b=0x0;_0x490f1b<_0x2168c7[_0xde4f46(0x200)]['length'];_0x490f1b++){if(_0x2168c7[_0xde4f46(0x200)][_0x490f1b][_0xde4f46(0x1c0)]===_0x33baaa){_0x163dff=!![];break;}}if(!_0x163dff){const _0x1a024c=document[_0xde4f46(0x215)](_0xde4f46(0x17d));_0x1a024c[_0xde4f46(0x1c0)]=_0x33baaa,_0x1a024c[_0xde4f46(0x16d)]=_0x53e795,_0x2168c7['appendChild'](_0x1a024c);}updateLayerControlPanel();}function updateLayerControlPanel(){const _0x49b647=_0x1f047d,_0x5a6531=document[_0x49b647(0x17e)]('layerList');_0x5a6531[_0x49b647(0x1bb)]='',Object[_0x49b647(0x146)](layerData)[_0x49b647(0x13e)]()[_0x49b647(0x1a7)](_0x1f6981=>{const _0x31bd3a=_0x49b647,_0x3ef0ef=layerData[_0x1f6981],_0x3ce03f=document[_0x31bd3a(0x215)](_0x31bd3a(0x1fe));_0x3ce03f[_0x31bd3a(0x1ec)]=_0x31bd3a(0x190);const _0x9df9b7=document[_0x31bd3a(0x215)](_0x31bd3a(0x19d));_0x9df9b7[_0x31bd3a(0x21c)]=_0x31bd3a(0x211),_0x9df9b7[_0x31bd3a(0x1ec)]=_0x31bd3a(0x1ea),_0x9df9b7[_0x31bd3a(0x1cf)]=map[_0x31bd3a(0x224)](_0x3ef0ef[_0x31bd3a(0x1a8)]),_0x9df9b7[_0x31bd3a(0x129)][_0x31bd3a(0x155)]=_0x1f6981,_0x9df9b7[_0x31bd3a(0x1cc)](_0x31bd3a(0x1fb),function(){const _0x26460d=_0x31bd3a;this['checked']?!map[_0x26460d(0x224)](_0x3ef0ef[_0x26460d(0x1a8)])&&map[_0x26460d(0x20a)](_0x3ef0ef[_0x26460d(0x1a8)]):map['hasLayer'](_0x3ef0ef[_0x26460d(0x1a8)])&&map[_0x26460d(0x131)](_0x3ef0ef[_0x26460d(0x1a8)]);});const _0x35bb75=document[_0x31bd3a(0x215)](_0x31bd3a(0x16b));_0x35bb75[_0x31bd3a(0x1ec)]='layer-label',_0x35bb75['textContent']=_0x3ef0ef[_0x31bd3a(0x1f4)],_0x3ce03f['appendChild'](_0x9df9b7),_0x3ce03f[_0x31bd3a(0x138)](_0x35bb75),_0x5a6531['appendChild'](_0x3ce03f);});}function displayAttributes(_0xef3bcb){const _0x11f3eb=_0x1f047d,_0x44c578=document[_0x11f3eb(0x17e)](_0x11f3eb(0x173)),_0xaa55a9=document[_0x11f3eb(0x17e)]('attributeContent');if(!_0xef3bcb||!layerData[_0xef3bcb]){_0x44c578[_0x11f3eb(0x1a6)][_0x11f3eb(0x1c7)]='none';return;}const _0x14daa4=layerData[_0xef3bcb],_0x59199a=_0x14daa4[_0x11f3eb(0x142)];if(!_0x59199a||!_0x59199a[_0x11f3eb(0x157)]||_0x59199a[_0x11f3eb(0x157)][_0x11f3eb(0x139)]===0x0){_0xaa55a9[_0x11f3eb(0x1bb)]=_0x11f3eb(0x1f3),_0x44c578[_0x11f3eb(0x1a6)]['display']=_0x11f3eb(0x1c1);return;}let _0x1e0a4f='<h4>'+_0x14daa4[_0x11f3eb(0x1f4)]+_0x11f3eb(0x154);_0x1e0a4f+=_0x11f3eb(0x12d);const _0x323209={},_0x46e3de=document[_0x11f3eb(0x17e)]('parcelFieldSelector')[_0x11f3eb(0x1c0)]||'ID';_0x323209['parcel']=[_0x11f3eb(0x19a),_0x46e3de],_0x323209[_0x11f3eb(0x187)]=[_0x11f3eb(0x19a),_0x11f3eb(0x1e4)],_0x323209[_0x11f3eb(0x14b)]=[_0x11f3eb(0x1e6),'parcelName',_0x11f3eb(0x1b7)],_0x323209[_0x11f3eb(0x210)]=[_0x46e3de,_0x11f3eb(0x210)],_0x323209['parcelsBuildingAreas']=[_0x46e3de,_0x11f3eb(0x21f)],_0x323209[_0x11f3eb(0x19e)]=[_0x46e3de,_0x11f3eb(0x210),_0x11f3eb(0x21f),_0x11f3eb(0x209)];let _0x39eebc=[];_0x323209[_0xef3bcb]?_0x39eebc=_0x323209[_0xef3bcb]:_0x59199a[_0x11f3eb(0x157)][_0x11f3eb(0x1a7)](_0x2ca7da=>{const _0x4e6cd7=_0x11f3eb;_0x2ca7da['properties']&&Object[_0x4e6cd7(0x146)](_0x2ca7da[_0x4e6cd7(0x15e)])[_0x4e6cd7(0x1a7)](_0x1bb9dd=>{const _0xb8a6e6=_0x4e6cd7;!_0x39eebc['includes'](_0x1bb9dd)&&_0x39eebc[_0xb8a6e6(0x16c)](_0x1bb9dd);});}),_0x1e0a4f+=_0x11f3eb(0x1b6),_0x1e0a4f+='<th>FID</th>',_0x39eebc[_0x11f3eb(0x1a7)](_0x2c0f7f=>{const _0x364c1a=_0x11f3eb;_0x1e0a4f+=_0x364c1a(0x1ad)+_0x2c0f7f+_0x364c1a(0x18f);}),_0x1e0a4f+=_0x11f3eb(0x159),_0x59199a[_0x11f3eb(0x157)][_0x11f3eb(0x1a7)]((_0x1e170f,_0x195534)=>{const _0x586026=_0x11f3eb;_0x1e0a4f+=_0x586026(0x1b6),_0x1e0a4f+=_0x586026(0x1be)+_0x195534+_0x586026(0x171),_0x39eebc[_0x586026(0x1a7)](_0x119328=>{const _0x376686=_0x586026,_0x1b20cb=_0x1e170f[_0x376686(0x15e)]?_0x1e170f[_0x376686(0x15e)][_0x119328]:'';_0x1e0a4f+=_0x376686(0x1be)+(_0x1b20cb!==undefined&&_0x1b20cb!==null?_0x1b20cb:'')+_0x376686(0x171);}),_0x1e0a4f+=_0x586026(0x159);}),_0x1e0a4f+=_0x11f3eb(0x1f8),_0xaa55a9['innerHTML']=_0x1e0a4f,_0x44c578[_0x11f3eb(0x1a6)][_0x11f3eb(0x1c7)]=_0x11f3eb(0x1c1);}function handleFileUpload(_0x5433ae,_0x316330){const _0x2b2d81=_0x1f047d,_0x4fb97f=_0x5433ae[_0x2b2d81(0x135)][0x0];if(!_0x4fb97f)return;const _0xc7b0d6=new FileReader();_0xc7b0d6['onload']=function(_0x9de980){const _0x582fc9=_0x2b2d81,_0x2b5db2=_0x9de980[_0x582fc9(0x1b4)][_0x582fc9(0x12f)];try{const _0x489649=JSON[_0x582fc9(0x21d)](_0x2b5db2),_0x4be713=checkCRS(_0x489649);if(!_0x4be713){const _0xf32a3=confirm(_0x582fc9(0x182)+document['getElementById'](_0x582fc9(0x145))['value']+_0x582fc9(0x136));if(!_0xf32a3)return;}if(_0x316330===_0x582fc9(0x187)&&buildingLayer)map['removeLayer'](buildingLayer),delete layerData[_0x582fc9(0x187)];else _0x316330===_0x582fc9(0x20f)&&parcelLayer&&(map['removeLayer'](parcelLayer),delete layerData[_0x582fc9(0x20f)]);if(_0x316330===_0x582fc9(0x187))buildingGeojson=_0x489649,document[_0x582fc9(0x17e)](_0x582fc9(0x213))[_0x582fc9(0x1bb)]=_0x582fc9(0x1d4)+_0x4fb97f[_0x582fc9(0x20e)]+_0x582fc9(0x1d2);else{if(_0x316330===_0x582fc9(0x20f)){parcelGeojson=_0x489649,document['getElementById']('parcelStatus')['innerHTML']=_0x582fc9(0x1d4)+_0x4fb97f['name']+_0x582fc9(0x1d2);if(_0x489649[_0x582fc9(0x157)]&&_0x489649['features'][_0x582fc9(0x139)]>0x0){const _0x789f8f=_0x489649[_0x582fc9(0x157)][0x0]['properties'];parcelFields=Object['keys'](_0x789f8f);const _0x3026d5=document[_0x582fc9(0x17e)](_0x582fc9(0x175));_0x3026d5[_0x582fc9(0x1bb)]='',parcelFields[_0x582fc9(0x1a7)](_0x1c7107=>{const _0x15520e=_0x582fc9,_0x157c12=document[_0x15520e(0x215)](_0x15520e(0x17d));_0x157c12[_0x15520e(0x1c0)]=_0x1c7107,_0x157c12[_0x15520e(0x16d)]=_0x1c7107,_0x3026d5['appendChild'](_0x157c12);}),document[_0x582fc9(0x17e)](_0x582fc9(0x14f))[_0x582fc9(0x1a6)][_0x582fc9(0x1c7)]='block';}}}addGeoJSONToMap(_0x489649,_0x316330,_0x316330===_0x582fc9(0x187)?_0x582fc9(0x185):_0x582fc9(0x158)),buildingGeojson&&parcelGeojson&&(document[_0x582fc9(0x17e)]('processStep1')[_0x582fc9(0x202)]=![]);}catch(_0x16fde6){console[_0x582fc9(0x20d)](_0x582fc9(0x166),_0x16fde6),alert('Error\x20parsing\x20GeoJSON\x20file.\x20Please\x20check\x20the\x20file\x20format.');}},_0xc7b0d6[_0x2b2d81(0x152)](_0x4fb97f);}function transformCoords(_0x3b7f11,_0x464f22,_0x3e6870){if(_0x464f22===_0x3e6870)return _0x3b7f11;return proj4(_0x464f22,_0x3e6870,_0x3b7f11);}function transformGeoJSON(_0x3c69ef,_0x3b678a,_0x4efe1f){const _0x55753b=_0x1f047d;if(_0x3b678a===_0x4efe1f)return JSON[_0x55753b(0x21d)](JSON[_0x55753b(0x1b2)](_0x3c69ef));const _0x3800ab={'type':_0x3c69ef[_0x55753b(0x21c)],'features':[]};return _0x3c69ef[_0x55753b(0x157)]['forEach'](_0x2b19b8=>{const _0x18943b=_0x55753b,_0x3b775c={'type':_0x2b19b8['type'],'properties':{..._0x2b19b8[_0x18943b(0x15e)]},'geometry':{'type':_0x2b19b8['geometry'][_0x18943b(0x21c)]}};if(_0x2b19b8[_0x18943b(0x15a)][_0x18943b(0x21c)]==='Point')_0x3b775c[_0x18943b(0x15a)][_0x18943b(0x1af)]=transformCoords(_0x2b19b8[_0x18943b(0x15a)][_0x18943b(0x1af)],_0x3b678a,_0x4efe1f);else{if(_0x2b19b8[_0x18943b(0x15a)]['type']===_0x18943b(0x1eb)||_0x2b19b8[_0x18943b(0x15a)][_0x18943b(0x21c)]==='MultiPoint')_0x3b775c[_0x18943b(0x15a)][_0x18943b(0x1af)]=_0x2b19b8['geometry'][_0x18943b(0x1af)][_0x18943b(0x217)](_0x446b94=>transformCoords(_0x446b94,_0x3b678a,_0x4efe1f));else{if(_0x2b19b8[_0x18943b(0x15a)][_0x18943b(0x21c)]===_0x18943b(0x20b)||_0x2b19b8['geometry'][_0x18943b(0x21c)]===_0x18943b(0x1dc))_0x3b775c[_0x18943b(0x15a)][_0x18943b(0x1af)]=_0x2b19b8[_0x18943b(0x15a)][_0x18943b(0x1af)]['map'](_0x40fdf1=>_0x40fdf1['map'](_0x39889f=>transformCoords(_0x39889f,_0x3b678a,_0x4efe1f)));else _0x2b19b8[_0x18943b(0x15a)][_0x18943b(0x21c)]===_0x18943b(0x188)&&(_0x3b775c[_0x18943b(0x15a)][_0x18943b(0x1af)]=_0x2b19b8['geometry'][_0x18943b(0x1af)][_0x18943b(0x217)](_0xd94576=>_0xd94576[_0x18943b(0x217)](_0x319130=>_0x319130[_0x18943b(0x217)](_0x1c7059=>transformCoords(_0x1c7059,_0x3b678a,_0x4efe1f)))));}}_0x3800ab['features'][_0x18943b(0x16c)](_0x3b775c);}),_0x3800ab;}function processStep1(){const _0x3b8cce=_0x1f047d;if(!parcelGeojson){alert(_0x3b8cce(0x15d));return;}document[_0x3b8cce(0x17e)](_0x3b8cce(0x184))[_0x3b8cce(0x1a6)][_0x3b8cce(0x1c7)]=_0x3b8cce(0x1c1),setTimeout(()=>{const _0x46b28b=_0x3b8cce;try{console[_0x46b28b(0x199)](_0x46b28b(0x1a5));const _0x16d59f=document[_0x46b28b(0x17e)](_0x46b28b(0x145))['value'],_0x590269=[];for(let _0x379156=0x0;_0x379156<parcelGeojson[_0x46b28b(0x157)]['length'];_0x379156++){try{const _0x22416f=parcelGeojson[_0x46b28b(0x157)][_0x379156];console['log'](_0x46b28b(0x143)+(_0x379156+0x1)+'/'+parcelGeojson[_0x46b28b(0x157)][_0x46b28b(0x139)]);let _0x4f2151;_0x16d59f===_0x46b28b(0x1c2)?_0x4f2151=turf[_0x46b28b(0x192)](_0x22416f):_0x4f2151=calculateAreaUTM(_0x22416f[_0x46b28b(0x15a)],_0x16d59f),console[_0x46b28b(0x199)](_0x46b28b(0x1fc)+_0x379156+'\x20-\x20Area:\x20'+_0x4f2151['toFixed'](0x2)+_0x46b28b(0x164)),_0x590269[_0x46b28b(0x16c)]({'type':'Feature','properties':{..._0x22416f[_0x46b28b(0x15e)],'parcelArea':Math[_0x46b28b(0x1c4)](_0x4f2151*0x64)/0x64},'geometry':_0x22416f[_0x46b28b(0x15a)]});}catch(_0x403fb8){console['warn'](_0x46b28b(0x1e9)+_0x379156+':',_0x403fb8);}}if(_0x590269[_0x46b28b(0x139)]===0x0)throw new Error(_0x46b28b(0x186));resultGeojson={'type':_0x46b28b(0x1d9),'features':_0x590269},console[_0x46b28b(0x199)]('Parcel\x20Area\x20GeoJSON\x20created:',resultGeojson);resultLayer&&(map['removeLayer'](resultLayer),delete layerData[_0x46b28b(0x210)]);addGeoJSONToMap(resultGeojson,'parcelArea',_0x46b28b(0x183));let _0x54ab73=0x0;_0x590269[_0x46b28b(0x1a7)](_0x4680a5=>{const _0xc8047c=_0x46b28b;_0x54ab73+=_0x4680a5[_0xc8047c(0x15e)]['parcelArea'];});const _0x53a77c=_0x54ab73/_0x590269['length'];document[_0x46b28b(0x17e)](_0x46b28b(0x220))[_0x46b28b(0x1bb)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Parcel\x20areas\x20calculated\x20for\x20'+_0x590269[_0x46b28b(0x139)]+'\x20parcels</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20area:\x20'+Math[_0x46b28b(0x1c4)](_0x54ab73*0x64)/0x64+_0x46b28b(0x214)+Math[_0x46b28b(0x1c4)](_0x53a77c*0x64)/0x64+_0x46b28b(0x193)+_0x16d59f+_0x46b28b(0x141),document[_0x46b28b(0x17e)](_0x46b28b(0x220))[_0x46b28b(0x1a6)]['display']=_0x46b28b(0x1c1),document[_0x46b28b(0x17e)](_0x46b28b(0x13d))[_0x46b28b(0x202)]=![],document[_0x46b28b(0x17e)](_0x46b28b(0x184))['style'][_0x46b28b(0x1c7)]=_0x46b28b(0x1ac);}catch(_0x457dbc){console['error'](_0x46b28b(0x1c8),_0x457dbc),alert('Error\x20processing\x20step\x201:\x20'+_0x457dbc[_0x46b28b(0x14c)]),document[_0x46b28b(0x17e)]('loadingIndicator')[_0x46b28b(0x1a6)][_0x46b28b(0x1c7)]=_0x46b28b(0x1ac);}},0x64);}function calculateAreaUTM(_0x1b470c,_0x3ab898){const _0x384956=_0x1f047d;let _0x5a1a19=0x0;if(_0x1b470c[_0x384956(0x21c)]===_0x384956(0x20b))_0x5a1a19=polygonArea(_0x1b470c[_0x384956(0x1af)][0x0]);else{if(_0x1b470c[_0x384956(0x21c)]===_0x384956(0x188))for(const _0x53705b of _0x1b470c[_0x384956(0x1af)]){_0x5a1a19+=polygonArea(_0x53705b[0x0]);for(let _0x33f708=0x1;_0x33f708<_0x53705b[_0x384956(0x139)];_0x33f708++){_0x5a1a19-=polygonArea(_0x53705b[_0x33f708]);}}}return Math[_0x384956(0x13c)](_0x5a1a19);}function polygonArea(_0x3569f6){const _0x1709f7=_0x1f047d;let _0x11a7ac=0x0;const _0x13f106=_0x3569f6[_0x1709f7(0x139)];if(_0x13f106<0x3)return 0x0;for(let _0x26d989=0x0;_0x26d989<_0x13f106-0x1;_0x26d989++){_0x11a7ac+=_0x3569f6[_0x26d989][0x0]*_0x3569f6[_0x26d989+0x1][0x1]-_0x3569f6[_0x26d989+0x1][0x0]*_0x3569f6[_0x26d989][0x1];}return _0x11a7ac+=_0x3569f6[_0x13f106-0x1][0x0]*_0x3569f6[0x0][0x1]-_0x3569f6[0x0][0x0]*_0x3569f6[_0x13f106-0x1][0x1],Math['abs'](_0x11a7ac/0x2);}function processStep2(){const _0x477b67=_0x1f047d;if(!buildingGeojson||!parcelGeojson){alert(_0x477b67(0x179));return;}const _0xabe6c5=document['getElementById'](_0x477b67(0x175))[_0x477b67(0x1c0)];if(!_0xabe6c5){alert(_0x477b67(0x19b));return;}document[_0x477b67(0x17e)](_0x477b67(0x184))['style']['display']=_0x477b67(0x1c1),setTimeout(()=>{const _0x46db8c=_0x477b67;try{console[_0x46db8c(0x199)]('Starting\x20step\x202\x20processing...');const _0x355977=document[_0x46db8c(0x17e)]('coordSystem')[_0x46db8c(0x1c0)],_0x11ae84=[];let _0xc104f7=0x0,_0x561481=0x0;buildingGeojson[_0x46db8c(0x157)][_0x46db8c(0x1a7)]((_0x3bbabc,_0x50bc64)=>{const _0x1db972=_0x46db8c;try{console[_0x1db972(0x199)]('Processing\x20building\x20'+(_0x50bc64+0x1)+'/'+buildingGeojson[_0x1db972(0x157)][_0x1db972(0x139)]);let _0x565bc0;if(_0x3bbabc['geometry']['type']===_0x1db972(0x20b))_0x565bc0=calculateCentroid(_0x3bbabc[_0x1db972(0x15a)][_0x1db972(0x1af)][0x0]);else{if(_0x3bbabc[_0x1db972(0x15a)]['type']===_0x1db972(0x188))_0x565bc0=calculateCentroid(_0x3bbabc['geometry'][_0x1db972(0x1af)][0x0][0x0]);else throw new Error(_0x1db972(0x1d1)+_0x3bbabc[_0x1db972(0x15a)][_0x1db972(0x21c)]);}const _0x1bc822={'type':_0x1db972(0x1bf),'properties':{..._0x3bbabc['properties'],'parcelId':null,'parcelName':null,'buildingArea':typeof _0x3bbabc[_0x1db972(0x15e)][_0x1db972(0x1e4)]==='number'?_0x3bbabc[_0x1db972(0x15e)][_0x1db972(0x1e4)]:0x0},'geometry':{'type':_0x1db972(0x1c3),'coordinates':_0x565bc0}};_0x11ae84[_0x1db972(0x16c)](_0x1bc822),_0x561481++;}catch(_0x5e2c6a){console[_0x1db972(0x1e0)]('Error\x20creating\x20point\x20for\x20building\x20'+_0x50bc64+':',_0x5e2c6a,_0x3bbabc),_0xc104f7++;}}),console[_0x46db8c(0x199)](_0x46db8c(0x1ba)+_0x11ae84[_0x46db8c(0x139)]+_0x46db8c(0x1f0)+_0x561481+',\x20Failed:\x20'+_0xc104f7);if(_0x11ae84[_0x46db8c(0x139)]===0x0)throw new Error(_0x46db8c(0x1b0));const _0x5b3518={'type':_0x46db8c(0x1d9),'features':_0x11ae84};_0x5b3518['features'][_0x46db8c(0x1a7)]((_0x26dc1c,_0x5a187a)=>{const _0x1783bf=_0x46db8c;try{for(const _0x129ebe of parcelGeojson['features']){if(pointInPolygon(_0x26dc1c[_0x1783bf(0x15a)][_0x1783bf(0x1af)],_0x129ebe['geometry'])){_0x26dc1c[_0x1783bf(0x15e)]['parcelId']=_0x129ebe[_0x1783bf(0x15e)][_0xabe6c5],_0x26dc1c[_0x1783bf(0x15e)][_0x1783bf(0x1d6)]=_0x129ebe[_0x1783bf(0x15e)][_0xabe6c5];break;}}}catch(_0x1dd1f6){console[_0x1783bf(0x1e0)]('Error\x20processing\x20point\x20'+_0x5a187a+':',_0x1dd1f6);}}),layerData[_0x46db8c(0x14b)]&&layerData[_0x46db8c(0x14b)]['layer']&&(map[_0x46db8c(0x131)](layerData[_0x46db8c(0x14b)][_0x46db8c(0x1a8)]),delete layerData[_0x46db8c(0x14b)]),addGeoJSONToMap(_0x5b3518,_0x46db8c(0x14b),_0x46db8c(0x1df)),document[_0x46db8c(0x17e)]('step2Result')[_0x46db8c(0x16d)]=_0x46db8c(0x140)+_0xabe6c5+_0x46db8c(0x1f1),document[_0x46db8c(0x17e)]('step2Result')[_0x46db8c(0x1a6)][_0x46db8c(0x1c7)]=_0x46db8c(0x1c1),document[_0x46db8c(0x17e)](_0x46db8c(0x1b3))['disabled']=![],document[_0x46db8c(0x17e)]('loadingIndicator')[_0x46db8c(0x1a6)][_0x46db8c(0x1c7)]=_0x46db8c(0x1ac);}catch(_0x382ee7){console[_0x46db8c(0x20d)](_0x46db8c(0x1d3),_0x382ee7),alert(_0x46db8c(0x1f9)+_0x382ee7[_0x46db8c(0x14c)]),document['getElementById']('loadingIndicator')[_0x46db8c(0x1a6)][_0x46db8c(0x1c7)]='none';}},0x64);}function calculateCentroid(_0x47b731){const _0x6a3977=_0x1f047d;let _0x3f5c00=0x0,_0xeb44b1=0x0;for(let _0x555744=0x0;_0x555744<_0x47b731[_0x6a3977(0x139)];_0x555744++){_0x3f5c00+=_0x47b731[_0x555744][0x0],_0xeb44b1+=_0x47b731[_0x555744][0x1];}return[_0x3f5c00/_0x47b731[_0x6a3977(0x139)],_0xeb44b1/_0x47b731[_0x6a3977(0x139)]];}function pointInPolygon(_0x58f3b7,_0x194772){const _0x3b70cf=_0x1f047d;try{if(_0x194772[_0x3b70cf(0x21c)]===_0x3b70cf(0x20b))return isPointInPolygon(_0x58f3b7,_0x194772[_0x3b70cf(0x1af)][0x0]);else{if(_0x194772[_0x3b70cf(0x21c)]===_0x3b70cf(0x188))for(const _0x1bcd5d of _0x194772[_0x3b70cf(0x1af)]){if(isPointInPolygon(_0x58f3b7,_0x1bcd5d[0x0]))return!![];}}return![];}catch(_0x575202){return console[_0x3b70cf(0x1e0)](_0x3b70cf(0x16e),_0x575202),![];}}function _0x3556(){const _0x5977d0=['</th>','layer-item','Imagery','area','\x20sq.m</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>CRS:\x20','random','defs','step3Result','geoJSON','BCR\x20(%)','log','OBJECTID','Please\x20select\x20a\x20parcel\x20field.','EPSG:32647','input','finalResult','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>BCR\x20calculated\x20per\x20parcel:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>BCR\x20=\x20(totalBuildingArea\x20/\x20parcelArea)\x20*\x20100</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<hr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Summary\x20Statistics:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20parcels:\x20','Starting\x20step\x204\x20processing...','53779ArfbQf','click','</div>','Starting\x20step\x201\x20processing...','style','forEach','layer','Proj','\x20sq.m<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Total\x20Building\x20Coverage\x20Area:</strong>\x20','%</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Minimum\x20BCR:</strong>\x20','none','<th>','EPSG:32647\x20or\x20EPSG:32648\x20as\x20per\x20source\x20data','coordinates','Failed\x20to\x20create\x20any\x20building\x20points.\x20Check\x20the\x20building\x20GeoJSON\x20data.','4446PgXPtd','stringify','processStep3','target','%</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Maximum\x20BCR:</strong>\x20','<tr>','buildingArea','8350944cGLKTq','%<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Building\x20Count:</strong>\x20','Created\x20','innerHTML','targetProjection','crs','<td>','Feature','value','block','EPSG:4326','Point','round','exportExcelButton','filter','display','Error\x20in\x20step\x201\x20processing:','1654290cognBT','7062pMfUcM','%</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>CRS:\x20','addEventListener','.xlsx','layerSelect','checked','#ff0000','Unsupported\x20geometry\x20type:\x20','\x20loaded','Error\x20in\x20step\x202\x20processing:','<i\x20class=\x22fas\x20fa-check-circle\x22></i>\x20','ImageryLabels','parcelName','mapDiv','EPSG3857','FeatureCollection','indexOf','calculationDetails','MultiLineString','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info-popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>','step4Result','Building\x20Points','warn','170OlJThr','+proj=utm\x20+zone=47\x20+datum=WGS84\x20+units=m\x20+no_defs','buildingCount','BL_AREA','Average\x20BCR\x20(%)','parcelId','reduce','BCR\x20Analysis','Error\x20processing\x20parcel\x20','layer-toggle','LineString','className','control','splice','processStep4','\x20building\x20points.\x20Success:\x20','\x20information','createObjectURL','<p>No\x20attribute\x20data\x20available\x20for\x20this\x20layer.</p>','title','CRS','\x20sq.m</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Average\x20BCR:</strong>\x20','floor','</table>','Error\x20processing\x20step\x202:\x20','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20building\x20coverage\x20area:\x20','change','Parcel\x20','#ff5500','div','Starting\x20step\x203\x20processing...','options','utils','disabled','color','\x20sq.m</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x27re\x20using\x20the\x20BL_AREA\x20field\x20as\x20the\x20building\x20footprint\x20area</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>CRS:\x20','writeFile','Map\x20initialized\x20with\x20CRS:\x20','\x20sq.m<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Could\x20not\x20zoom\x20to\x20layer\x20bounds:','BCR','addLayer','Polygon','Building\x20','error','name','parcel','parcelArea','checkbox','LatLng','buildingStatus','\x20sq.m</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Average\x20parcel\x20area:\x20','createElement','SUMMARY\x20STATISTICS','map','bindPopup','buildingList','981263BJCunq',':</strong>\x20','type','parse','<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Parcel\x20Area:</strong>\x20','totalBuildingArea','step1Result','Please\x20complete\x20step\x202\x20first.','4MQxDNR','#ffaa00','hasLayer','remove','dataset','Maximum\x20BCR\x20(%)','href','1086537Rkgman','<table\x20class=\x22attribute-table\x22>','#00ff00','result','<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','removeLayer','circleMarker','#ffff00','Parcel\x20Area\x20(sq.m)','files',').\x20Do\x20you\x20want\x20to\x20continue\x20anyway?\x20If\x20not,\x20please\x20change\x20the\x20coordinate\x20system\x20and\x20try\x20again.','Final\x20Result\x20(BCR)','appendChild','length','min','replace','abs','processStep2','reverse','<strong>','Buildings\x20converted\x20to\x20points\x20with\x20','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','geojson','Processing\x20parcel\x20','book_new','coordSystem','keys','BCR_analysis_result.geojson','buildingFile','revokeObjectURL','exportButton','buildingPoints','message','<div\x20class=\x22info-popup\x22>','Minimum\x20BCR\x20(%)','fieldSelectorContainer','Parcels\x20with\x20Building\x20Coverage\x20Areas','#000000','readAsText','<br>','\x20Attributes</h4>','layerId','parcelFile','features','Land\x20Parcels','</tr>','geometry','<strong>Calculation\x20Details:</strong><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<pre\x20style=\x22max-height:\x20100px;\x20overflow-y:\x20auto;\x22>','Error\x20processing\x20step\x203:\x20','Please\x20upload\x20parcel\x20file\x20first.','properties','No\x20buildings\x20found\x20in\x20this\x20parcel','onload','Error\x20in\x20step\x204\x20processing:','download','fitBounds','\x20sq.m','Please\x20complete\x20step\x204\x20first.','Error\x20parsing\x20GeoJSON:','Error\x20in\x20step\x203\x20processing:','380DaiwyF','Error\x20processing\x20building\x20','number','label','push','textContent','Error\x20in\x20pointInPolygon:','parcelsBuildingAreas','addTo','</td>','esri','attributePanel','removeChild','parcelFieldSelector','Application\x20initialized\x20successfully!','finalResultGeojson','\x20sq.m\x20footprint\x20area','Please\x20upload\x20building\x20and\x20parcel\x20files\x20first.','EPSG:32648','</pre>','processStep1','option','getElementById','#f8f8f8','#000','rectangle','WARNING:\x20The\x20coordinates\x20in\x20this\x20file\x20may\x20not\x20match\x20the\x20selected\x20coordinate\x20system\x20(','Parcels\x20with\x20Area','loadingIndicator','Buildings','Failed\x20to\x20calculate\x20areas\x20for\x20any\x20parcels.','building','MultiPolygon','BCR_analysis_result_','application/json','<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Total\x20Building\x20Coverage\x20Area:</strong>\x20','json_to_sheet','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20building\x20coverage\x20areas\x20calculated\x20per\x20parcel</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20buildings\x20processed:\x20','19632zmyCCB'];_0x3556=function(){return _0x5977d0;};return _0x3556();}function isPointInPolygon(_0x12eb31,_0x1ec9d9){const _0x5e7c1a=_0x1f047d,_0x49342d=_0x12eb31[0x0],_0xa501a8=_0x12eb31[0x1];let _0x20d41a=![];for(let _0x223498=0x0,_0x5b0f3e=_0x1ec9d9['length']-0x1;_0x223498<_0x1ec9d9[_0x5e7c1a(0x139)];_0x5b0f3e=_0x223498++){const _0x3664e7=_0x1ec9d9[_0x223498][0x0],_0x1171ba=_0x1ec9d9[_0x223498][0x1],_0x22ef53=_0x1ec9d9[_0x5b0f3e][0x0],_0x150e25=_0x1ec9d9[_0x5b0f3e][0x1],_0x4a32b8=_0x1171ba>_0xa501a8!==_0x150e25>_0xa501a8&&_0x49342d<(_0x22ef53-_0x3664e7)*(_0xa501a8-_0x1171ba)/(_0x150e25-_0x1171ba)+_0x3664e7;if(_0x4a32b8)_0x20d41a=!_0x20d41a;}return _0x20d41a;}function processStep3(){const _0x428eec=_0x1f047d;if(!buildingGeojson||!parcelGeojson){alert(_0x428eec(0x221));return;}document[_0x428eec(0x17e)](_0x428eec(0x184))[_0x428eec(0x1a6)][_0x428eec(0x1c7)]=_0x428eec(0x1c1),setTimeout(()=>{const _0x41650f=_0x428eec;try{console[_0x41650f(0x199)](_0x41650f(0x1ff));const _0x2fdd21=document[_0x41650f(0x17e)]('parcelFieldSelector')['value'],_0x3f45fd=JSON[_0x41650f(0x21d)](JSON[_0x41650f(0x1b2)](resultGeojson||parcelGeojson)),_0x176461={};_0x3f45fd[_0x41650f(0x157)][_0x41650f(0x1a7)](_0xea70e=>{const _0x1c199f=_0x41650f,_0x24e56a=_0xea70e[_0x1c199f(0x15e)][_0x2fdd21];_0x176461[_0x24e56a]=0x0;});const _0x2ef3ef={};_0x3f45fd[_0x41650f(0x157)][_0x41650f(0x1a7)](_0x263713=>{const _0x13355f=_0x263713['properties'][_0x2fdd21];_0x2ef3ef[_0x13355f]={'buildingCount':0x0,'buildingList':[]};}),buildingGeojson[_0x41650f(0x157)]['forEach']((_0xb80019,_0x1a91ac)=>{const _0x2cacc3=_0x41650f;try{let _0x1bcf14;if(_0xb80019[_0x2cacc3(0x15a)][_0x2cacc3(0x21c)]==='Polygon')_0x1bcf14=calculateCentroid(_0xb80019['geometry'][_0x2cacc3(0x1af)][0x0]);else{if(_0xb80019[_0x2cacc3(0x15a)][_0x2cacc3(0x21c)]===_0x2cacc3(0x188))_0x1bcf14=calculateCentroid(_0xb80019[_0x2cacc3(0x15a)][_0x2cacc3(0x1af)][0x0][0x0]);else throw new Error(_0x2cacc3(0x1d1)+_0xb80019[_0x2cacc3(0x15a)][_0x2cacc3(0x21c)]);}let _0x340f4f=0x0;if(typeof _0xb80019[_0x2cacc3(0x15e)][_0x2cacc3(0x1e4)]===_0x2cacc3(0x16a))_0x340f4f=_0xb80019[_0x2cacc3(0x15e)][_0x2cacc3(0x1e4)];else typeof _0xb80019['properties'][_0x2cacc3(0x1e4)]==='string'&&(_0x340f4f=parseFloat(_0xb80019[_0x2cacc3(0x15e)][_0x2cacc3(0x1e4)])||0x0);_0x340f4f=isNaN(_0x340f4f)||_0x340f4f<0x0?0x0:_0x340f4f;const _0x19aa27=_0x340f4f;console['log'](_0x2cacc3(0x20c)+_0x1a91ac+':\x20'+_0x340f4f+_0x2cacc3(0x178));for(const _0x354798 of parcelGeojson['features']){if(pointInPolygon(_0x1bcf14,_0x354798[_0x2cacc3(0x15a)])){const _0x3f74b3=_0x354798[_0x2cacc3(0x15e)][_0x2fdd21];_0x176461[_0x3f74b3]+=_0x19aa27,_0x2ef3ef[_0x3f74b3]['buildingCount']++,_0x2ef3ef[_0x3f74b3][_0x2cacc3(0x219)][_0x2cacc3(0x16c)]({'id':_0x1a91ac,'area':_0x340f4f,'footprintArea':_0x19aa27});break;}}}catch(_0x43d268){console[_0x2cacc3(0x1e0)](_0x2cacc3(0x169)+_0x1a91ac+':',_0x43d268);}}),_0x3f45fd['features'][_0x41650f(0x1a7)](_0x4500b1=>{const _0x48fa59=_0x41650f,_0xf86bc8=_0x4500b1[_0x48fa59(0x15e)][_0x2fdd21];_0x4500b1[_0x48fa59(0x15e)][_0x48fa59(0x21f)]=_0x176461[_0xf86bc8]||0x0,_0x4500b1[_0x48fa59(0x15e)][_0x48fa59(0x21f)]=Math[_0x48fa59(0x1c4)](_0x4500b1[_0x48fa59(0x15e)]['totalBuildingArea']*0x64)/0x64;}),resultGeojson=_0x3f45fd;resultLayer&&(map['removeLayer'](resultLayer),delete layerData[_0x41650f(0x16f)]);_0x3f45fd[_0x41650f(0x157)][_0x41650f(0x1a7)](_0x2fe548=>{const _0xd1e1d4=_0x41650f,_0x15aaf2=_0x2fe548['properties'][_0x2fdd21];if(_0x2ef3ef[_0x15aaf2]){_0x2fe548[_0xd1e1d4(0x15e)][_0xd1e1d4(0x1e3)]=_0x2ef3ef[_0x15aaf2][_0xd1e1d4(0x1e3)];let _0x598d4e='Buildings\x20calculation\x20details:\x0a';_0x2ef3ef[_0x15aaf2][_0xd1e1d4(0x219)][_0xd1e1d4(0x1a7)](_0x50956f=>{const _0x4e3ddb=_0xd1e1d4;_0x598d4e+=_0x4e3ddb(0x20c)+_0x50956f['id']+':\x20'+_0x50956f[_0x4e3ddb(0x192)]+'\x20sq.m\x20footprint\x20area\x0a';}),_0x2fe548[_0xd1e1d4(0x15e)]['calculationDetails']=_0x598d4e;}else _0x2fe548[_0xd1e1d4(0x15e)][_0xd1e1d4(0x1e3)]=0x0,_0x2fe548['properties'][_0xd1e1d4(0x1db)]=_0xd1e1d4(0x15f);}),addGeoJSONToMap(resultGeojson,_0x41650f(0x16f),_0x41650f(0x150));let _0x10df2b=0x0,_0x57bc3b=0x0;Object[_0x41650f(0x146)](_0x2ef3ef)[_0x41650f(0x1a7)](_0x5b3d5d=>{const _0x16989e=_0x41650f;_0x10df2b+=_0x2ef3ef[_0x5b3d5d]['buildingCount'],_0x2ef3ef[_0x5b3d5d][_0x16989e(0x219)][_0x16989e(0x1a7)](_0x442171=>{_0x57bc3b+=_0x442171['footprintArea'];});}),document['getElementById'](_0x41650f(0x196))['innerHTML']=_0x41650f(0x18d)+_0x10df2b+_0x41650f(0x1fa)+Math[_0x41650f(0x1c4)](_0x57bc3b*0x64)/0x64+_0x41650f(0x204)+document['getElementById'](_0x41650f(0x145))[_0x41650f(0x1c0)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document[_0x41650f(0x17e)](_0x41650f(0x196))[_0x41650f(0x1a6)]['display']=_0x41650f(0x1c1),document[_0x41650f(0x17e)](_0x41650f(0x1ef))[_0x41650f(0x202)]=![],document[_0x41650f(0x17e)](_0x41650f(0x184))[_0x41650f(0x1a6)][_0x41650f(0x1c7)]=_0x41650f(0x1ac);}catch(_0x11ae91){console[_0x41650f(0x20d)](_0x41650f(0x167),_0x11ae91),alert(_0x41650f(0x15c)+_0x11ae91['message']),document[_0x41650f(0x17e)]('loadingIndicator')[_0x41650f(0x1a6)][_0x41650f(0x1c7)]=_0x41650f(0x1ac);}},0x64);}function processStep4(){const _0x691bc0=_0x1f047d;if(!resultGeojson){alert('Please\x20complete\x20step\x203\x20first.');return;}document[_0x691bc0(0x17e)](_0x691bc0(0x184))[_0x691bc0(0x1a6)][_0x691bc0(0x1c7)]=_0x691bc0(0x1c1),setTimeout(()=>{const _0x68ff24=_0x691bc0;try{console['log'](_0x68ff24(0x1a1));const _0x347021=document['getElementById'](_0x68ff24(0x175))['value'],_0xa06724=JSON[_0x68ff24(0x21d)](JSON[_0x68ff24(0x1b2)](resultGeojson));_0xa06724[_0x68ff24(0x157)][_0x68ff24(0x1a7)](_0x52b9b5=>{const _0x4d1e0f=_0x68ff24,_0x13bebe=_0x52b9b5[_0x4d1e0f(0x15e)][_0x4d1e0f(0x21f)]||0x0,_0x2b0c56=_0x52b9b5[_0x4d1e0f(0x15e)]['parcelArea']||0x0;_0x2b0c56>0x0?_0x52b9b5[_0x4d1e0f(0x15e)][_0x4d1e0f(0x209)]=_0x13bebe/_0x2b0c56*0x64:_0x52b9b5['properties']['BCR']=0x0,_0x52b9b5[_0x4d1e0f(0x15e)][_0x4d1e0f(0x209)]=Math[_0x4d1e0f(0x1c4)](_0x52b9b5[_0x4d1e0f(0x15e)][_0x4d1e0f(0x209)]*0x64)/0x64;});resultLayer&&(map['removeLayer'](resultLayer),delete layerData[_0x68ff24(0x19e)]);addGeoJSONToMap(_0xa06724,'finalResult',_0x68ff24(0x137)),window[_0x68ff24(0x177)]=_0xa06724;let _0x4ef9ef=0x0,_0x29f01f=0x0,_0x20d9a6=_0xa06724[_0x68ff24(0x157)][_0x68ff24(0x139)],_0x31e862=0x0,_0x18be18=[];_0xa06724[_0x68ff24(0x157)]['forEach'](_0x11fd4b=>{const _0x10a679=_0x68ff24;_0x11fd4b[_0x10a679(0x15e)]['parcelArea']>0x0&&(_0x4ef9ef+=_0x11fd4b[_0x10a679(0x15e)][_0x10a679(0x210)],_0x29f01f+=_0x11fd4b[_0x10a679(0x15e)][_0x10a679(0x21f)]||0x0,_0x11fd4b['properties'][_0x10a679(0x209)]!==undefined&&_0x11fd4b[_0x10a679(0x15e)]['parcelArea']>0x0&&_0x18be18[_0x10a679(0x16c)](_0x11fd4b[_0x10a679(0x15e)][_0x10a679(0x209)]),_0x31e862++);});const _0x202169=_0x18be18[_0x68ff24(0x139)]>0x0?_0x18be18['reduce']((_0x347e77,_0x11d482)=>_0x347e77+_0x11d482,0x0)/_0x18be18[_0x68ff24(0x139)]:0x0,_0x444baa=_0x18be18[_0x68ff24(0x139)]>0x0?Math['max'](..._0x18be18):0x0,_0xc2e727=_0x18be18[_0x68ff24(0x139)]>0x0?Math[_0x68ff24(0x13a)](..._0x18be18):0x0;document['getElementById'](_0x68ff24(0x1de))['innerHTML']=_0x68ff24(0x1a0)+_0x20d9a6+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20parcel\x20area:\x20'+Math[_0x68ff24(0x1c4)](_0x4ef9ef*0x64)/0x64+'\x20sq.m</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Total\x20building\x20coverage\x20area:\x20'+Math[_0x68ff24(0x1c4)](_0x29f01f*0x64)/0x64+_0x68ff24(0x1f6)+Math[_0x68ff24(0x1c4)](_0x202169*0x64)/0x64+_0x68ff24(0x1b5)+Math[_0x68ff24(0x1c4)](_0x444baa*0x64)/0x64+_0x68ff24(0x1ab)+Math[_0x68ff24(0x1c4)](_0xc2e727*0x64)/0x64+_0x68ff24(0x1cb)+document[_0x68ff24(0x17e)]('coordSystem')[_0x68ff24(0x1c0)]+_0x68ff24(0x141),document['getElementById'](_0x68ff24(0x1de))[_0x68ff24(0x1a6)]['display']=_0x68ff24(0x1c1),document['getElementById'](_0x68ff24(0x14a))[_0x68ff24(0x202)]=![],document[_0x68ff24(0x17e)](_0x68ff24(0x1c5))[_0x68ff24(0x202)]=![],document['getElementById'](_0x68ff24(0x184))[_0x68ff24(0x1a6)][_0x68ff24(0x1c7)]=_0x68ff24(0x1ac);}catch(_0x549435){console['error'](_0x68ff24(0x161),_0x549435),alert('Error\x20processing\x20step\x204:\x20'+_0x549435['message']),document['getElementById'](_0x68ff24(0x184))[_0x68ff24(0x1a6)][_0x68ff24(0x1c7)]=_0x68ff24(0x1ac);}},0x64);}function exportResult(){const _0x2abccd=_0x1f047d;if(!window['finalResultGeojson']){alert(_0x2abccd(0x165));return;}const _0x2d618d=JSON[_0x2abccd(0x21d)](JSON['stringify'](window[_0x2abccd(0x177)]));parcelGeojson&&parcelGeojson[_0x2abccd(0x1bd)]?_0x2d618d[_0x2abccd(0x1bd)]=parcelGeojson[_0x2abccd(0x1bd)]:_0x2d618d[_0x2abccd(0x1bd)]={'type':_0x2abccd(0x20e),'properties':{'name':'EPSG:4326'}};_0x2d618d['properties']=_0x2d618d[_0x2abccd(0x15e)]||{},_0x2d618d[_0x2abccd(0x15e)][_0x2abccd(0x1bc)]=_0x2abccd(0x1ae);const _0x4aa53a=new Blob([JSON[_0x2abccd(0x1b2)](_0x2d618d)],{'type':_0x2abccd(0x18a)}),_0x6190eb=URL[_0x2abccd(0x1f2)](_0x4aa53a),_0x364105=document[_0x2abccd(0x215)]('a');_0x364105[_0x2abccd(0x12b)]=_0x6190eb,_0x364105[_0x2abccd(0x162)]=_0x2abccd(0x147),document['body'][_0x2abccd(0x138)](_0x364105),_0x364105['click'](),document['body'][_0x2abccd(0x174)](_0x364105),URL[_0x2abccd(0x149)](_0x6190eb);}function exportExcel(){const _0x3ac693=_0x1f047d;if(!window['finalResultGeojson']){alert(_0x3ac693(0x165));return;}const _0x286f86=document[_0x3ac693(0x17e)]('coordSystem')[_0x3ac693(0x1c0)],_0x5f415a=document['getElementById'](_0x3ac693(0x175))[_0x3ac693(0x1c0)]||'ID',_0x498454=XLSX[_0x3ac693(0x201)][_0x3ac693(0x144)](),_0x27f180=window[_0x3ac693(0x177)]['features'][_0x3ac693(0x217)](_0x609b65=>{const _0xcb10ff=_0x3ac693;return{[_0x5f415a]:_0x609b65[_0xcb10ff(0x15e)][_0x5f415a],'Parcel\x20Area\x20(sq.m)':_0x609b65['properties']['parcelArea'],'Total\x20Building\x20Coverage\x20Area\x20(sq.m)':_0x609b65['properties']['totalBuildingArea'],'BCR\x20(%)':_0x609b65['properties'][_0xcb10ff(0x209)],'Building\x20Count':_0x609b65[_0xcb10ff(0x15e)]['buildingCount']||0x0};});let _0x10e7ac=_0x27f180[_0x3ac693(0x1c6)](_0x359dce=>_0x359dce[_0x3ac693(0x134)]>0x0)[_0x3ac693(0x217)](_0x989c15=>_0x989c15[_0x3ac693(0x198)]);const _0xe760e0=_0x10e7ac[_0x3ac693(0x139)]>0x0?_0x10e7ac[_0x3ac693(0x1e7)]((_0x18494f,_0x140610)=>_0x18494f+_0x140610,0x0)/_0x10e7ac[_0x3ac693(0x139)]:0x0,_0x29656c=_0x10e7ac[_0x3ac693(0x139)]>0x0?Math['max'](..._0x10e7ac):0x0,_0x2de06b=_0x10e7ac[_0x3ac693(0x139)]>0x0?Math[_0x3ac693(0x13a)](..._0x10e7ac):0x0;_0x27f180[_0x3ac693(0x16c)]({}),_0x27f180[_0x3ac693(0x16c)]({[_0x5f415a]:_0x3ac693(0x216)}),_0x27f180['push']({[_0x5f415a]:_0x3ac693(0x1e5),'BCR\x20(%)':Math[_0x3ac693(0x1c4)](_0xe760e0*0x64)/0x64}),_0x27f180[_0x3ac693(0x16c)]({[_0x5f415a]:_0x3ac693(0x12a),'BCR\x20(%)':Math['round'](_0x29656c*0x64)/0x64}),_0x27f180['push']({[_0x5f415a]:_0x3ac693(0x14e),'BCR\x20(%)':Math[_0x3ac693(0x1c4)](_0x2de06b*0x64)/0x64});const _0x71ab71=XLSX[_0x3ac693(0x201)][_0x3ac693(0x18c)](_0x27f180);XLSX['utils']['book_append_sheet'](_0x498454,_0x71ab71,_0x3ac693(0x1e8)),XLSX[_0x3ac693(0x205)](_0x498454,_0x3ac693(0x189)+_0x286f86[_0x3ac693(0x13b)](':','_')+_0x3ac693(0x1cd));}function init(){const _0x48d2a1=_0x1f047d;initMap(),document[_0x48d2a1(0x17e)](_0x48d2a1(0x145))[_0x48d2a1(0x1cc)](_0x48d2a1(0x1fb),function(){initMap();}),document[_0x48d2a1(0x17e)](_0x48d2a1(0x148))[_0x48d2a1(0x1cc)](_0x48d2a1(0x1fb),function(){handleFileUpload(this,'building');}),document[_0x48d2a1(0x17e)](_0x48d2a1(0x156))[_0x48d2a1(0x1cc)](_0x48d2a1(0x1fb),function(){const _0x1830d3=_0x48d2a1;handleFileUpload(this,_0x1830d3(0x20f));}),document[_0x48d2a1(0x17e)](_0x48d2a1(0x17c))[_0x48d2a1(0x1cc)](_0x48d2a1(0x1a3),processStep1),document[_0x48d2a1(0x17e)]('processStep2')[_0x48d2a1(0x1cc)](_0x48d2a1(0x1a3),processStep2),document[_0x48d2a1(0x17e)](_0x48d2a1(0x1b3))[_0x48d2a1(0x1cc)]('click',processStep3),document['getElementById'](_0x48d2a1(0x1ef))[_0x48d2a1(0x1cc)](_0x48d2a1(0x1a3),processStep4),document[_0x48d2a1(0x17e)]('exportButton')[_0x48d2a1(0x1cc)](_0x48d2a1(0x1a3),exportResult),document['getElementById'](_0x48d2a1(0x1c5))['addEventListener']('click',exportExcel),document['getElementById'](_0x48d2a1(0x1ce))[_0x48d2a1(0x1cc)](_0x48d2a1(0x1fb),function(){const _0x4a9976=_0x48d2a1;displayAttributes(this[_0x4a9976(0x1c0)]);}),console[_0x48d2a1(0x199)](_0x48d2a1(0x176));}window[_0x1f047d(0x160)]=init;
  </script>
</body>
</html>