<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RECLASS BLDG</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .gradient-bg {
            background: #f0fdfa;
            min-height: 100vh;
        }
        
        .main-container {
            padding: 2rem;
            margin: 0 auto;
            max-width: 1200px;
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            }
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .title-container {
            margin-bottom: 2rem;
            text-align: center;
        }

        .controls-container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .section-title {
            color: #134e4a;
            font-size: 1rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .file-button {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #e2e8f0;
            color: #64748b;
            border-radius: 4px;
            transition: all 0.3s;
            background: #ffffff;
            text-align: left;
        }

        .process-button {
            width: 100%;
            padding: 0.75rem 1rem;
            background-color: #134e4a;
            color: white;
            border-radius: 4px;
            transition: all 0.3s;
            border: none;
            text-align: center;
            font-weight: 600;
        }

        .file-button:hover {
            border-color: #134e4a;
        }

        .process-button:hover {
            background-color: #115e59;
        }

        .fixed-buttons {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            gap: 1rem;
        }

        .home-button, .landuse-button {
            background-color: #134e4a;
            color: white;
            padding: 0.75rem;
            border-radius: 9999px;
            transition: all 0.3s;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .landuse-button {
            padding: 0.75rem 1.5rem;
            white-space: nowrap;
        }

        .home-button:hover, .landuse-button:hover {
            background-color: #115e59;
            color: white;
        }

        .custom-progress {
            width: 100%;
            background-color: #f0fdfa;
            border-radius: 4px;
            padding: 2px;
            border: 1px solid #134e4a;
        }

        .custom-progress-bar {
            background-color: #134e4a;
            height: 16px;
            border-radius: 2px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
        }

        .manual-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #134e4a;
            text-decoration: none;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .manual-link:hover {
            color: #115e59;
        }

        .main-title {
            color: #134e4a;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: #1f2937;
            font-size: 1.1rem;
        }

        .file-name-display {
            font-size: 0.875rem;
            color: #475569;
            margin-top: 0.5rem;
            min-height: 1.25rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-input-container {
            width: 100%;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
        }

        .column-mapping {
            margin-bottom: 15px;
        }

        .column-mapping label {
            display: block;
            color: #134e4a;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .column-mapping select {
            width: 100%;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            background-color: white;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .modal-button {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }

        .modal-button-primary {
            background-color: #134e4a;
            color: white;
        }

        .modal-button-secondary {
            background-color: #e2e8f0;
            color: #64748b;
        }

        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 10px;
            padding: 10px;
            background-color: #fee2e2;
            border-radius: 4px;
        }

        .steps-container {
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        .step {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: flex-start;
        }

        .step-number {
            background-color: #134e4a;
            color: white;
            width: 2rem;
            height: 2rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            color: #134e4a;
            margin-bottom: 0.5rem;
        }

        .step-description {
            color: #4b5563;
            font-size: 0.9rem;
        }
    </style>
</head>
<body class="gradient-bg">
    <div class="main-container">
        <div class="card">
            <div class="title-container">
                <h1 class="main-title">Reclass BLDG</h1>
                <h2 class="subtitle">จัดประเภทข้อมูลอาคาร</h2>
            </div>

            <div class="steps-container">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">เลือกไฟล์ข้อมูลอาคาร (Excel)</div>
                        <div class="step-description">
                            เลือกไฟล์ข้อมูลอาคาร (Excel) โดยไฟล์ควรมีคอลัมน์ BL_TYPE, BL_USE, BL_AREA, BL_NSTOREY, BL_NUNIT, ACQYEAR, PL_BLOCK และ PL_USE <br>
                            กดปุ่ม RECLASS <br>
                            ในกรณีที่ไฟล์ของผู้ใช้งานมีชื่อคอลัมน์ไม่ตรงกับที่ใช้งานในระบบ ระบบดำเนินการให้ผู้ใช้งานจับคู่คอลัมน์ก่อนการประมวลผล
                        </div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">ประมวลผลข้อมูลอาคาร (RECLASS)</div>
                        <div class="step-description">
                            หลังกดปุ่ม RECLASS ระบบดำเนินการประมวลผลข้อมูล ได้แก่ พื้นที่การใช้ประโยชน์อาคารรวม , RE_BL_USE , RE_BL_AREA ตามเกณฑ์การจัดประเภทอาคาร <br>
                            <a href="reclassbldg.pdf" class="manual-link">เกณฑ์การจัดประเภทอาคาร</a> <br>
                            ในกรณีที่ผังมีชื่อบริเวณเป็นตัวอักษร ระบบดำเนินการประมวลผลการจัดกลุ่มบริเวณการใช้ประโยชน์ที่เป็นย่าน (PL_BLOCK2) อัตโนมัติ 
                        </div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">นำออกข้อมูลอาคาร (Excel)</div>
                        <div class="step-description">
                            หลังจากประมวลผลเสร็จ กดปุ่ม "นำออกไฟล์อาคาร (Excel)" เพื่อบันทึกผลลัพธ์เป็นไฟล์ Excel
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls-container">
                <a href="Reclass BLDG Handbook.pdf" class="manual-link">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                    คู่มือการใช้งาน
                </a>

                <div class="mt-4">
                    <div class="section-title">ไฟล์อาคาร (Excel)</div>
                    <div class="file-input-container">
                        <input type="file" id="excelFile" accept=".xlsx, .xls" class="hidden" onchange="updateFileName(this)">
                        <button onclick="document.getElementById('excelFile').click()" class="file-button">
                            Choose File
                        </button>
                        <div id="fileName" class="file-name-display"></div>
                    </div>
                </div>

                <button id="processButton" class="process-button">
                    RECLASS
                </button>

                <div id="progressContainer" class="d-none w-full">
                    <div class="custom-progress">
                        <div id="progressBar" class="custom-progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                    </div>
                </div>

                <button id="exportButton" class="process-button d-none">
                    นำออกไฟล์อาคาร (Excel)
                </button>

                <div id="errorMessage" class="error-message d-none"></div>
            </div>
        </div>
    </div>

    <!-- Fixed buttons -->
    <div class="fixed-buttons">
        <a href="index.html" class="home-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
        </a>
        <a href="page3.html" class="landuse-button">
            Calculate Landuse
        </a>
    </div>

    <!-- Column Mapping Modal -->
    <div id="columnModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>จับคู่คอลัมน์</h3>
                <button class="modal-close" onclick="closeColumnModal()">&times;</button>
            </div>
            <div id="columnMappingList">
                <!-- Column mappings will be inserted here -->
            </div>
            <div class="modal-buttons">
                <button class="modal-button modal-button-secondary" onclick="closeColumnModal()">ยกเลิก</button>
                <button class="modal-button modal-button-primary" onclick="processWithMapping()">ประมวลผล</button>
            </div>
        </div>
    </div>

    <script>
const _0x1c4857=_0x1fb4;(function(_0x28677d,_0x3b593c){const _0x248db2=_0x1fb4,_0xbcfabb=_0x28677d();while(!![]){try{const _0x1090c3=-parseInt(_0x248db2(0xc6))/0x1+-parseInt(_0x248db2(0x91))/0x2+-parseInt(_0x248db2(0xa6))/0x3*(-parseInt(_0x248db2(0xf4))/0x4)+-parseInt(_0x248db2(0xbb))/0x5+parseInt(_0x248db2(0xa9))/0x6+parseInt(_0x248db2(0xb2))/0x7*(-parseInt(_0x248db2(0x96))/0x8)+-parseInt(_0x248db2(0x9a))/0x9*(-parseInt(_0x248db2(0xdc))/0xa);if(_0x1090c3===_0x3b593c)break;else _0xbcfabb['push'](_0xbcfabb['shift']());}catch(_0x39e90f){_0xbcfabb['push'](_0xbcfabb['shift']());}}}(_0x3d8e,0x88d60));let fileData=null,columnMapping={},processedData=[];const requiredColumns=[_0x1c4857(0x8d),'BL_USE',_0x1c4857(0xf3),_0x1c4857(0xf8),_0x1c4857(0xe0),_0x1c4857(0xd9),'PL_BLOCK',_0x1c4857(0xf0)],plBlockPatterns={'อย.':'อย.','ย.1':'ย.1','ย.2':_0x1c4857(0xbe),'ย.3':_0x1c4857(0xdf),'ย.4':_0x1c4857(0xac),'ย.5':_0x1c4857(0xd4),'ย.6':'ย.6','ย.7':_0x1c4857(0xe2),'ย.8':_0x1c4857(0x9b),'พ.1':'พ.1','พ.2':_0x1c4857(0xea),'พ.3':_0x1c4857(0xd7),'พ.4':_0x1c4857(0xa1),'ขข.':_0x1c4857(0xad),'อ.1':_0x1c4857(0xb5),'อ.2':'อ.2','อ.3':'อ.3','อ.4':'อ.4','ก.1':_0x1c4857(0xba),'ก.2':_0x1c4857(0x99),'ก.3':_0x1c4857(0xa4),'ก.4':'ก.4','ก.5':_0x1c4857(0xd5),'อก.':'อก.','ปก.':'ปก.','อท.':_0x1c4857(0xd6),'ล.':'ล.','ลล.':_0x1c4857(0xb1),'สล.':_0x1c4857(0xfd),'อป.':_0x1c4857(0xfe),'ศษ.':'ศษ.','ลช.':_0x1c4857(0xa3),'ลส.':_0x1c4857(0xc4),'อศ.':_0x1c4857(0xfc),'ศน.':'ศน.','ส.':'ส.'},reuse2Data={'1000':'10','1100':'10','1101':'10','1102':'10','1103':'10','1121':'10','1122':'10','1123':'10','1131':'10','1132':'10','1200':'10','1300':'10','1310':'10','1320':'10','1330':'10','1340':'10','1350':'10','1800':'90','2000':'20','2100':'20','2200':'20','2210':'20','2220':'20','2230':'20','2231':'20','2232':'20','2233':'20','2234':'20','2240':'20','2241':'20','2250':'20','2251':'20','2260':'20','2270':'20','2280':'20','2300':'20','2301':'20','2302':'20','2400':'20','2410':'20','2420':'20','2480':'20','2500':'20','2800':'20','3000':'30','3100':'30','3110':'30','3120':'30','3300':'33','3310':'33','3311':'33','3321':'33','3322':'33','3800':'30','4100':'41','4110':'41','4120':'41','4121':'41','4122':'41','4123':'41','4180':'41','4200':'30','4300':'30','5000':'90','5130':'90','5140':'90','5150':'90','5160':'90','5180':'90','5200':'90','5210':'90','5220':'90','5230':'90','5300':'90','5310':'90','5320':'90','5330':'90','5400':'90','5410':'90','5420':'90','5430':'90','5440':'90','5500':'90','5510':'90','5520':'90','5800':'90','6000':'90','6100':'90','6105':'90','6110':'90','6120':'90','6130':'90','6140':'90','6141':'90','6142':'90','6143':'90','6150':'90','6160':'90','6180':'90','6200':'90','6210':'90','6220':'90','6230':'90','6240':'90','6250':'90','6260':'90','6270':'90','6280':'90','6300':'90','6310':'90','6320':'90','6330':'90','6340':'90','6350':'90','6360':'90','6370':'90','6380':'90','6381':'90','6382':'90','6383':'90','6400':'90','6500':'90','6510':'90','6530':'90','6580':'90','6600':'90','6610':'90','6620':'90','6630':'90','6640':'90','6650':'90','6660':'90','6800':'90','6830':'90','6831':'90','7000':'90','7200':'90','7210':'90','7220':'90','7300':'90','7310':'90','7320':'90','7321':'90','7322':'90','7323':'90','7324':'90','7330':'90','7380':'90','8000':'80','8170':'80','8180':'80','8190':'80','8310':'80','8500':'80','9991':'90','9993':'90','9998':'90','9999':'90'};function checkPLBlock(_0x461f08){const _0x35a4c3=_0x1c4857;if(!_0x461f08)return'';_0x461f08=_0x461f08['toString']();for(const [_0x30b67c,_0x47376e]of Object[_0x35a4c3(0x85)](plBlockPatterns)){if(_0x461f08[_0x35a4c3(0xb7)](_0x30b67c))return _0x47376e;}return'';}function _0x1fb4(_0x4728ed,_0x5cafbb){const _0x3d8e8a=_0x3d8e();return _0x1fb4=function(_0x1fb407,_0x4f0713){_0x1fb407=_0x1fb407-0x85;let _0x2b2d7e=_0x3d8e8a[_0x1fb407];return _0x2b2d7e;},_0x1fb4(_0x4728ed,_0x5cafbb);}function checkPLBlockPattern(_0x2bb378){const _0x19aa94=_0x1c4857;if(!_0x2bb378)return![];const _0xaed5b4=/[ก-ฺa-zA-Z]+\.\d+-\d+/;return _0xaed5b4[_0x19aa94(0x86)](_0x2bb378);}function extractTextUpToPeriod(_0x46bbb3){const _0x5c14c0=_0x1c4857;if(!_0x46bbb3)return'';const _0x1aee97=_0x46bbb3[_0x5c14c0(0xe5)]('.');if(_0x1aee97===-0x1)return _0x46bbb3;return _0x46bbb3[_0x5c14c0(0xcb)](0x0,_0x1aee97+0x1);}function convertToText(_0x191c83){const _0x522933=_0x1c4857;if(_0x191c83===null||_0x191c83===undefined)return'';return _0x191c83[_0x522933(0x9d)]();}function showError(_0x36646a){const _0x5e79f5=_0x1c4857,_0xfc05fb=document[_0x5e79f5(0xae)](_0x5e79f5(0xa8));_0xfc05fb[_0x5e79f5(0xaf)]=_0x36646a,_0xfc05fb['classList'][_0x5e79f5(0xc2)](_0x5e79f5(0xa7)),setTimeout(()=>{const _0x556826=_0x5e79f5;_0xfc05fb[_0x556826(0xe9)][_0x556826(0xc3)](_0x556826(0xa7));},0x1388);}function updateFileName(_0x3cda94){const _0x4f0ed5=_0x1c4857,_0x343c01=document['getElementById'](_0x4f0ed5(0xb4));_0x3cda94['files']&&_0x3cda94[_0x4f0ed5(0x98)][0x0]?_0x343c01[_0x4f0ed5(0xaf)]=_0x3cda94[_0x4f0ed5(0x98)][0x0][_0x4f0ed5(0xdb)]:_0x343c01['textContent']='';}function validateRequiredData(_0x60f86e){const _0x2151a2=_0x1c4857,_0xdf382f=[];(!_0x60f86e['BL_TYPE']||_0x60f86e['BL_TYPE']===''||_0x60f86e[_0x2151a2(0x8d)]===null||_0x60f86e['BL_TYPE']===undefined)&&_0xdf382f[_0x2151a2(0xd1)](_0x2151a2(0xe1));(!_0x60f86e[_0x2151a2(0xed)]||_0x60f86e[_0x2151a2(0xed)]===''||_0x60f86e[_0x2151a2(0xed)]===null||_0x60f86e[_0x2151a2(0xed)]===undefined)&&_0xdf382f[_0x2151a2(0xd1)]('BL_USE\x20ไม่มีข้อมูล');const _0x459900=parseFloat(_0x60f86e[_0x2151a2(0xf3)]);(!_0x60f86e[_0x2151a2(0xf3)]||_0x60f86e[_0x2151a2(0xf3)]===''||_0x60f86e['BL_AREA']===null||_0x60f86e[_0x2151a2(0xf3)]===undefined||isNaN(_0x459900)||_0x459900<=0x0)&&_0xdf382f[_0x2151a2(0xd1)](_0x2151a2(0xd2));const _0x3f9a35=parseFloat(_0x60f86e[_0x2151a2(0xf8)]);(!_0x60f86e[_0x2151a2(0xf8)]||_0x60f86e[_0x2151a2(0xf8)]===''||_0x60f86e[_0x2151a2(0xf8)]===null||_0x60f86e[_0x2151a2(0xf8)]===undefined||isNaN(_0x3f9a35)||_0x3f9a35<=0x0)&&_0xdf382f['push'](_0x2151a2(0xaa));if(_0x60f86e['BL_NUNIT']!==null&&_0x60f86e[_0x2151a2(0xe0)]!==undefined&&_0x60f86e[_0x2151a2(0xe0)]!==''){const _0x3d771a=parseFloat(_0x60f86e['BL_NUNIT']);(isNaN(_0x3d771a)||_0x3d771a<0x0)&&_0xdf382f['push'](_0x2151a2(0x87));}if(_0x60f86e[_0x2151a2(0x8d)]==='6'||_0x60f86e[_0x2151a2(0x8d)]===0x6){if(!_0x60f86e[_0x2151a2(0xe0)]||_0x60f86e['BL_NUNIT']===''||_0x60f86e[_0x2151a2(0xe0)]===null||_0x60f86e[_0x2151a2(0xe0)]===undefined)_0xdf382f[_0x2151a2(0xd1)](_0x2151a2(0x9e));else{const _0x1cd09f=parseFloat(_0x60f86e['BL_NUNIT']);(isNaN(_0x1cd09f)||_0x1cd09f<=0x0)&&_0xdf382f[_0x2151a2(0xd1)](_0x2151a2(0xf7));}}if(!_0x60f86e[_0x2151a2(0xd9)]||_0x60f86e['ACQYEAR']===''||_0x60f86e['ACQYEAR']===null||_0x60f86e['ACQYEAR']===undefined)_0xdf382f['push'](_0x2151a2(0x8e));else{const _0x4a84b8=parseInt(_0x60f86e['ACQYEAR']);(isNaN(_0x4a84b8)||_0x4a84b8<0x9ec||_0x4a84b8>0xa28)&&_0xdf382f[_0x2151a2(0xd1)](_0x2151a2(0x8b));}return _0xdf382f;}function showColumnModal(_0x3e9bc3){const _0x400914=_0x1c4857,_0x25337f=document[_0x400914(0xae)](_0x400914(0x89)),_0x3a29bf=document[_0x400914(0xae)](_0x400914(0xfa));_0x3a29bf[_0x400914(0xd0)]='',requiredColumns[_0x400914(0xe4)](_0x231803=>{const _0x131626=_0x400914,_0x507877=document[_0x131626(0xdd)]('div');_0x507877[_0x131626(0xcf)]='column-mapping';const _0x3d9994=document[_0x131626(0xdd)]('label');_0x3d9994['textContent']=_0x231803,_0x507877[_0x131626(0xc8)](_0x3d9994);const _0x42972e=document['createElement'](_0x131626(0xfb));_0x42972e[_0x131626(0xdb)]=_0x231803;const _0x4e1ad6=document[_0x131626(0xdd)](_0x131626(0xb6));_0x4e1ad6[_0x131626(0xce)]='',_0x4e1ad6[_0x131626(0xaf)]='--\x20เลือกคอลัมน์\x20--',_0x42972e[_0x131626(0xc8)](_0x4e1ad6),_0x3e9bc3[_0x131626(0xe4)](_0x54299f=>{const _0x13910f=_0x131626,_0x244d5e=document[_0x13910f(0xdd)](_0x13910f(0xb6));_0x244d5e[_0x13910f(0xce)]=_0x54299f,_0x244d5e[_0x13910f(0xaf)]=_0x54299f,_0x54299f[_0x13910f(0x95)]()===_0x231803&&(_0x244d5e['selected']=!![]),_0x42972e[_0x13910f(0xc8)](_0x244d5e);}),_0x507877[_0x131626(0xc8)](_0x42972e),_0x3a29bf[_0x131626(0xc8)](_0x507877);}),_0x25337f['style'][_0x400914(0xbd)]='block';}function closeColumnModal(){const _0x3cb8ed=_0x1c4857;document[_0x3cb8ed(0xae)](_0x3cb8ed(0x89))[_0x3cb8ed(0xca)][_0x3cb8ed(0xbd)]=_0x3cb8ed(0x90);}function getColumnMapping(){const _0x45f451=_0x1c4857,_0x287dc4={},_0x18b7ff=document['querySelectorAll'](_0x45f451(0x93));let _0x2b72f1=!![];return _0x18b7ff[_0x45f451(0xe4)](_0x316763=>{const _0x26845b=_0x45f451;_0x316763[_0x26845b(0xce)]?_0x287dc4[_0x316763[_0x26845b(0xdb)]]=_0x316763[_0x26845b(0xce)]:_0x2b72f1=![];}),{'mapping':_0x287dc4,'isValid':_0x2b72f1};}function processExcel(){const _0x2ccf2d=_0x1c4857,_0x776347=document['getElementById'](_0x2ccf2d(0xc5)),_0x91cca7=_0x776347[_0x2ccf2d(0x98)][0x0];if(!_0x91cca7){showError(_0x2ccf2d(0x88));return;}const _0x1de976=new FileReader();_0x1de976[_0x2ccf2d(0xb3)]=function(_0x26b537){const _0x2c9596=_0x2ccf2d,_0xafee83=new Uint8Array(_0x26b537[_0x2c9596(0xc7)][_0x2c9596(0x97)]),_0x6f7e84=XLSX[_0x2c9596(0xe6)](_0xafee83,{'type':_0x2c9596(0xa2)}),_0x2c275f=_0x6f7e84[_0x2c9596(0xb0)][0x0],_0x459d06=_0x6f7e84[_0x2c9596(0xa5)][_0x2c275f],_0x584248=XLSX[_0x2c9596(0xf6)][_0x2c9596(0xec)](_0x459d06);if(_0x584248[_0x2c9596(0xc1)]===0x0){showError(_0x2c9596(0xcd));return;}fileData=_0x584248;const _0xee5ca8=Object['keys'](_0x584248[0x0]),_0x5ecf0d=requiredColumns['filter'](_0x1f0a29=>!_0xee5ca8['some'](_0x47cf77=>_0x47cf77[_0x2c9596(0x95)]()===_0x1f0a29));_0x5ecf0d[_0x2c9596(0xc1)]===0x0?processData(_0x584248):showColumnModal(_0xee5ca8);},_0x1de976[_0x2ccf2d(0x8a)](_0x91cca7);}function processWithMapping(){const {mapping:_0x2d39bf,isValid:_0x20bd75}=getColumnMapping();if(!_0x20bd75){showError('กรุณาเลือกคอลัมน์ให้ครบทุกรายการ');return;}columnMapping=_0x2d39bf,closeColumnModal();const _0x10b2ad=fileData['map'](_0x55e980=>{const _0x34f028=_0x1fb4,_0x45c323={};return Object[_0x34f028(0xd8)](columnMapping)[_0x34f028(0xe4)](_0xade390=>{_0x45c323[_0xade390]=_0x55e980[columnMapping[_0xade390]];}),Object[_0x34f028(0xd8)](_0x55e980)['forEach'](_0x318355=>{const _0x1e3117=_0x34f028;!Object[_0x1e3117(0x8c)](columnMapping)[_0x1e3117(0xb7)](_0x318355)&&(_0x45c323[_0x318355]=_0x55e980[_0x318355]);}),_0x45c323;});processData(_0x10b2ad);}function _0x3d8e(){const _0x38ca77=['2248cKmiSS','พื้นที่การใช้ประโยชน์อาคารรวม','utils','BL_TYPE\x20=\x206\x20ต้องระบุจำนวนห้อง\x20(BL_NUNIT)\x20ให้ถูกต้อง','BL_NSTOREY','ไม่พบรหัส\x20BL_USE\x20(','columnMappingList','select','อศ.','สล.','อป.','entries','test','BL_NUNIT\x20มีค่าไม่ถูกต้อง','กรุณาเลือกไฟล์\x20Excel','columnModal','readAsArrayBuffer','ACQYEAR\x20มีค่าไม่ถูกต้อง','values','BL_TYPE','ACQYEAR\x20ไม่มีข้อมูล','หมายเหตุ','none','665208RUQjkJ','RE_BL_AREA','#columnMappingList\x20select',')\x20ในฐานข้อมูลการจัดประเภท','toUpperCase','2487448OeBrGX','result','files','ก.2','3809691fExPBK','ย.8','trim','toString','BL_TYPE\x20=\x206\x20ต้องระบุจำนวนห้อง\x20(BL_NUNIT)','ไม่สามารถประมวลผลได้:\x20','exportButton','พ.4','array','ลช.','ก.3','Sheets','1893IVBjES','d-none','errorMessage','6548358aZxjZY','BL_NSTOREY\x20ไม่มีข้อมูลหรือมีค่าไม่ถูกต้อง','progressBar','ย.4','ขข.','getElementById','textContent','SheetNames','ลล.','14pGwsvN','onload','fileName','อ.1','option','includes','RE_BL_USE','aria-valuenow','ก.1','3979020ZPKmrz','width','display','ย.2','writeFile','addEventListener','length','remove','add','ลส.','excelFile','828461Ofgffg','target','appendChild','click','style','substring','onclick','ไฟล์\x20Excel\x20ไม่มีข้อมูล','value','className','innerHTML','push','BL_AREA\x20ไม่มีข้อมูลหรือมีค่าไม่ถูกต้อง','เกิดข้อผิดพลาดในการประมวลผล:\x20','ย.5','ก.5','อท.','พ.3','keys','ACQYEAR','PL_BLOCK','name','40vwxNgO','createElement','some','ย.3','BL_NUNIT','BL_TYPE\x20ไม่มีข้อมูล','ย.7','processButton','forEach','indexOf','read','setAttribute','round','classList','พ.2','PL_BLOCK2','sheet_to_json','BL_USE','progressContainer','message','PL_USE','PL_USE_O','map','BL_AREA'];_0x3d8e=function(){return _0x38ca77;};return _0x3d8e();}function processData(_0x5a113a){const _0x42c578=_0x1c4857,_0xcabedd=document[_0x42c578(0xae)](_0x42c578(0xab)),_0x12bc0a=document[_0x42c578(0xae)](_0x42c578(0xee));_0x12bc0a[_0x42c578(0xe9)][_0x42c578(0xc2)](_0x42c578(0xa7));let _0x2f138e=_0x5a113a[_0x42c578(0xf2)]((_0xedac0b,_0xd03942)=>{const _0x4fd949=_0x42c578,_0x106e2c=Math[_0x4fd949(0xe8)]((_0xd03942+0x1)/_0x5a113a[_0x4fd949(0xc1)]*0x32);_0xcabedd[_0x4fd949(0xca)][_0x4fd949(0xbc)]=_0x106e2c+'%',_0xcabedd[_0x4fd949(0xe7)](_0x4fd949(0xb9),_0x106e2c),_0xcabedd[_0x4fd949(0xaf)]=_0x106e2c+'%';const _0x4bcd95={..._0xedac0b};_0x4bcd95[_0x4fd949(0x8d)]=convertToText(_0xedac0b[_0x4fd949(0x8d)]),_0x4bcd95['BL_USE']=convertToText(_0xedac0b[_0x4fd949(0xed)]),_0x4bcd95['ACQYEAR']=convertToText(_0xedac0b[_0x4fd949(0xd9)]),_0x4bcd95[_0x4fd949(0xda)]=convertToText(_0xedac0b['PL_BLOCK']),_0x4bcd95[_0x4fd949(0xf0)]=convertToText(_0xedac0b['PL_USE']);const _0x5717aa=_0xedac0b['BL_NUNIT'];return _0x5717aa!==null&&_0x5717aa!==undefined?_0x4bcd95[_0x4fd949(0xe0)]=Math[_0x4fd949(0xe8)](parseFloat(_0x5717aa)):_0x4bcd95[_0x4fd949(0xe0)]=0x0,_0x4bcd95['PL_BLOCK2']=checkPLBlock(_0xedac0b[_0x4fd949(0xda)]),_0x4bcd95;});const _0x3b5d8c=_0x2f138e[_0x42c578(0xde)](_0x1c6694=>_0x1c6694['PL_BLOCK2']&&_0x1c6694[_0x42c578(0xeb)][_0x42c578(0x9c)]()!=='');_0x3b5d8c?processedData=_0x2f138e['map']((_0x3430ae,_0x279ba9)=>{const _0x52f0bc=_0x42c578,_0x50fd4f=Math[_0x52f0bc(0xe8)](0x32+(_0x279ba9+0x1)/_0x2f138e[_0x52f0bc(0xc1)]*0x32);return _0xcabedd[_0x52f0bc(0xca)][_0x52f0bc(0xbc)]=_0x50fd4f+'%',_0xcabedd[_0x52f0bc(0xe7)](_0x52f0bc(0xb9),_0x50fd4f),_0xcabedd[_0x52f0bc(0xaf)]=_0x50fd4f+'%',!_0x3430ae['PL_BLOCK2']&&_0x3430ae[_0x52f0bc(0xda)]&&(_0x3430ae['PL_BLOCK2']=extractTextUpToPeriod(_0x3430ae['PL_BLOCK'])),_0x3430ae[_0x52f0bc(0xf1)]=_0x3430ae[_0x52f0bc(0xf0)],checkPLBlockPattern(_0x3430ae[_0x52f0bc(0xda)])&&(_0x3430ae[_0x52f0bc(0xf0)]=_0x3430ae[_0x52f0bc(0xf1)]+'-'+_0x3430ae[_0x52f0bc(0xeb)]),processRowData(_0x3430ae);}):processedData=_0x2f138e['map']((_0x287188,_0x35422e)=>{const _0x3a2dc5=_0x42c578,_0x308722=Math['round'](0x32+(_0x35422e+0x1)/_0x2f138e[_0x3a2dc5(0xc1)]*0x32);return _0xcabedd[_0x3a2dc5(0xca)][_0x3a2dc5(0xbc)]=_0x308722+'%',_0xcabedd[_0x3a2dc5(0xe7)](_0x3a2dc5(0xb9),_0x308722),_0xcabedd['textContent']=_0x308722+'%',_0x287188[_0x3a2dc5(0xf1)]=_0x287188['PL_USE'],processRowData(_0x287188);}),document[_0x42c578(0xae)](_0x42c578(0xa0))[_0x42c578(0xe9)][_0x42c578(0xc2)](_0x42c578(0xa7));}function processRowData(_0x5623e0){const _0x122e29=_0x1c4857,_0x15735f=validateRequiredData(_0x5623e0);_0x5623e0['หมายเหตุ']='';if(_0x15735f['length']>0x0)return _0x5623e0[_0x122e29(0xf5)]=0x0,_0x5623e0[_0x122e29(0xb8)]='',_0x5623e0['RE_BL_AREA']=0x0,_0x5623e0[_0x122e29(0x8f)]=_0x122e29(0x9f)+_0x15735f['join'](',\x20'),_0x5623e0;const _0x1eda1a=parseFloat(_0x5623e0['BL_AREA'])||0x0,_0x2c4210=parseFloat(_0x5623e0[_0x122e29(0xf8)])||0x0,_0x543ec1=parseInt(_0x5623e0[_0x122e29(0xe0)])||0x0;_0x5623e0[_0x122e29(0xf5)]=_0x1eda1a*_0x2c4210,_0x5623e0[_0x122e29(0xb8)]=reuse2Data[_0x5623e0[_0x122e29(0xed)]]||'';if(!_0x5623e0['RE_BL_USE'])return _0x5623e0[_0x122e29(0x92)]=0x0,_0x5623e0[_0x122e29(0x8f)]=_0x122e29(0xf9)+_0x5623e0[_0x122e29(0xed)]+_0x122e29(0x94),_0x5623e0;try{_0x5623e0['RE_BL_AREA']=determineCode({..._0x5623e0,'BL_AREA':_0x1eda1a,'BL_NSTOREY':_0x2c4210,'BL_NUNIT':_0x543ec1}),_0x5623e0[_0x122e29(0x92)]===0x0&&(_0x5623e0[_0x122e29(0x8f)]='ไม่สามารถจัดประเภทอาคารได้ตามเกณฑ์ที่กำหนด');}catch(_0x523cf4){_0x5623e0[_0x122e29(0x92)]=0x0,_0x5623e0[_0x122e29(0x8f)]=_0x122e29(0xd3)+_0x523cf4[_0x122e29(0xef)];}return _0x5623e0;}function determineCode(_0x3e5d9e){const _0x5e3f58=_0x1c4857,{RE_BL_USE:_0x2e0111,BL_TYPE:_0x132185,BL_NSTOREY:_0x452f25}=_0x3e5d9e,_0x2e70a2=parseFloat(_0x3e5d9e['BL_AREA'])||0x0,_0x1be901=_0x3e5d9e[_0x5e3f58(0xf5)];if(_0x1be901>=0x7d0){if(_0x2e0111==='10'&&_0x2e70a2>=0x65&&_0x2e70a2<=0x190)return 0x4;if(_0x2e0111==='10'&&_0x2e70a2>=0x191)return 0x5;if(_0x2e0111==='20'&&_0x2e70a2>=0x65&&_0x2e70a2<=0x190)return 0x2;if(_0x2e0111==='20'&&_0x2e70a2>=0x191)return 0x3;if(_0x2e0111==='41'&&_0x2e70a2>=0x65&&_0x2e70a2<=0x190)return 0x2;if(_0x2e0111==='41'&&_0x2e70a2>=0x191)return 0x3;}if(_0x1be901>=0x3e8&&_0x452f25>=0x5){if(_0x2e0111==='10'&&_0x2e70a2>=0x65&&_0x2e70a2<=0x190)return 0x4;if(_0x2e0111==='10'&&_0x2e70a2>=0x191)return 0x5;if(_0x2e0111==='20'&&_0x2e70a2>=0x65&&_0x2e70a2<=0x190)return 0x2;if(_0x2e0111==='20'&&_0x2e70a2>=0x191)return 0x3;if(_0x2e0111==='41'&&_0x2e70a2>=0x65&&_0x2e70a2<=0x190)return 0x2;if(_0x2e0111==='41'&&_0x2e70a2>=0x191)return 0x3;}if(_0x452f25>=0x8){if(_0x2e0111==='10'&&_0x2e70a2>=0x65&&_0x2e70a2<=0x190)return 0x4;if(_0x2e0111==='10'&&_0x2e70a2>=0x191)return 0x5;if(_0x2e0111==='20'&&_0x2e70a2>=0x65&&_0x2e70a2<=0x190)return 0x2;if(_0x2e0111==='20'&&_0x2e70a2>=0x191)return 0x3;if(_0x2e0111==='41'&&_0x2e70a2>=0x65&&_0x2e70a2<=0x190)return 0x2;if(_0x2e0111==='41'&&_0x2e70a2>=0x191)return 0x3;}if(_0x2e0111==='10'){if(_0x132185==='1'||_0x132185==='2')return 0x1;if(_0x132185==='3'||_0x132185==='4'||_0x132185==='5')return 0x2;if(_0x132185==='6')return 0x3;}if(_0x2e0111==='20'||_0x2e0111==='41')return 0x1;if(_0x2e0111==='30'){if(_0x2e70a2<=0xc8)return 0x1;if(_0x2e70a2>0xc8&&_0x2e70a2<=0x1f4)return 0x2;if(_0x2e70a2>0x1f4&&_0x2e70a2<=0x3e8)return 0x3;if(_0x2e70a2>0x3e8)return 0x4;}if(_0x2e0111==='33'){if(_0x2e70a2<=0x64)return 0x1;if(_0x2e70a2>0x64&&_0x2e70a2<=0x1f4)return 0x2;if(_0x2e70a2>0x1f4)return 0x3;}if(_0x2e0111==='80'||_0x2e0111==='90')return 0x1;return 0x0;}function exportToExcel(){const _0xdbcdae=_0x1c4857,_0x23cb2c=XLSX[_0xdbcdae(0xf6)]['json_to_sheet'](processedData),_0xcc4920=XLSX[_0xdbcdae(0xf6)]['book_new']();XLSX['utils']['book_append_sheet'](_0xcc4920,_0x23cb2c,'ProcessedData'),XLSX[_0xdbcdae(0xbf)](_0xcc4920,'bldg_reclass.xlsx');}document['getElementById'](_0x1c4857(0xe3))[_0x1c4857(0xc0)](_0x1c4857(0xc9),processExcel),document[_0x1c4857(0xae)](_0x1c4857(0xa0))[_0x1c4857(0xc0)](_0x1c4857(0xc9),exportToExcel),window[_0x1c4857(0xcc)]=function(_0x27ff24){const _0x504f6e=_0x1c4857,_0x39f630=document[_0x504f6e(0xae)](_0x504f6e(0x89));_0x27ff24['target']===_0x39f630&&closeColumnModal();};
    </script>
<script data-goatcounter="https://mponline.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> 
</body>
</html>
