<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RECLASS BLDG</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .gradient-bg {
            background: #f0fdfa;
            min-height: 100vh;
        }
        
        .main-container {
            padding: 2rem;
            margin: 0 auto;
            max-width: 1200px;
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            }
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .title-container {
            margin-bottom: 2rem;
            text-align: center;
        }

        .controls-container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .section-title {
            color: #134e4a;
            font-size: 1rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .file-button {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #e2e8f0;
            color: #64748b;
            border-radius: 4px;
            transition: all 0.3s;
            background: #ffffff;
            text-align: left;
        }

        .process-button {
            width: 100%;
            padding: 0.75rem 1rem;
            background-color: #134e4a;
            color: white;
            border-radius: 4px;
            transition: all 0.3s;
            border: none;
            text-align: center;
            font-weight: 600;
        }

        .file-button:hover {
            border-color: #134e4a;
        }

        .process-button:hover {
            background-color: #115e59;
        }

        .fixed-buttons {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            gap: 1rem;
        }

        .home-button, .landuse-button {
            background-color: #134e4a;
            color: white;
            padding: 0.75rem;
            border-radius: 9999px;
            transition: all 0.3s;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .landuse-button {
            padding: 0.75rem 1.5rem;
            white-space: nowrap;
        }

        .home-button:hover, .landuse-button:hover {
            background-color: #115e59;
            color: white;
        }

        .custom-progress {
            width: 100%;
            background-color: #f0fdfa;
            border-radius: 4px;
            padding: 2px;
            border: 1px solid #134e4a;
        }

        .custom-progress-bar {
            background-color: #134e4a;
            height: 16px;
            border-radius: 2px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
        }

        .manual-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #134e4a;
            text-decoration: none;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .manual-link:hover {
            color: #115e59;
        }

        .main-title {
            color: #134e4a;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: #1f2937;
            font-size: 1.1rem;
        }

        .file-name-display {
            font-size: 0.875rem;
            color: #475569;
            margin-top: 0.5rem;
            min-height: 1.25rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-input-container {
            width: 100%;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
        }

        .column-mapping {
            margin-bottom: 15px;
        }

        .column-mapping label {
            display: block;
            color: #134e4a;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .column-mapping select {
            width: 100%;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            background-color: white;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .modal-button {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }

        .modal-button-primary {
            background-color: #134e4a;
            color: white;
        }

        .modal-button-secondary {
            background-color: #e2e8f0;
            color: #64748b;
        }

        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 10px;
            padding: 10px;
            background-color: #fee2e2;
            border-radius: 4px;
        }

        .steps-container {
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        .step {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: flex-start;
        }

        .step-number {
            background-color: #134e4a;
            color: white;
            width: 2rem;
            height: 2rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            color: #134e4a;
            margin-bottom: 0.5rem;
        }

        .step-description {
            color: #4b5563;
            font-size: 0.9rem;
        }
    </style>
</head>
<body class="gradient-bg">
    <div class="main-container">
        <div class="card">
            <div class="title-container">
                <h1 class="main-title">Reclass BLDG</h1>
                <h2 class="subtitle">จัดประเภทข้อมูลอาคาร</h2>
            </div>

            <div class="steps-container">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">เลือกไฟล์ข้อมูลอาคาร (Excel)</div>
                        <div class="step-description">
                            เลือกไฟล์ข้อมูลอาคาร (Excel) โดยไฟล์ควรมีคอลัมน์ BL_TYPE, BL_USE, BL_AREA, BL_NSTOREY, BL_NUNIT, ACQYEAR, PL_BLOCK และ PL_USE <br>
                            กดปุ่ม RECLASS <br>
                            ในกรณีที่ไฟล์ของผู้ใช้งานมีชื่อคอลัมน์ไม่ตรงกับที่ใช้งานในระบบ ระบบดำเนินการให้ผู้ใช้งานจับคู่คอลัมน์ก่อนการประมวลผล
                        </div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">ประมวลผลข้อมูลอาคาร (RECLASS)</div>
                        <div class="step-description">
                            หลังกดปุ่ม RECLASS ระบบดำเนินการประมวลผลข้อมูล ได้แก่ พื้นที่การใช้ประโยชน์อาคารรวม , RE_BL_USE , RE_BL_AREA ตามเกณฑ์การจัดประเภทอาคาร <br>
                            <a href="reclassbldg.pdf" class="manual-link">เกณฑ์การจัดประเภทอาคาร</a> <br>
                            ในกรณีที่ผังมีชื่อบริเวณเป็นตัวอักษร ระบบดำเนินการประมวลผลการจัดกลุ่มบริเวณการใช้ประโยชน์ที่เป็นย่าน (PL_BLOCK2) อัตโนมัติ 
                        </div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">นำออกข้อมูลอาคาร (Excel)</div>
                        <div class="step-description">
                            หลังจากประมวลผลเสร็จ กดปุ่ม "นำออกไฟล์อาคาร (Excel)" เพื่อบันทึกผลลัพธ์เป็นไฟล์ Excel
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls-container">
                <a href="Reclass BLDG Handbook.pdf" class="manual-link">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                    คู่มือการใช้งาน
                </a>

                <div class="mt-4">
                    <div class="section-title">ไฟล์อาคาร (Excel)</div>
                    <div class="file-input-container">
                        <input type="file" id="excelFile" accept=".xlsx, .xls" class="hidden" onchange="updateFileName(this)">
                        <button onclick="document.getElementById('excelFile').click()" class="file-button">
                            Choose File
                        </button>
                        <div id="fileName" class="file-name-display"></div>
                    </div>
                </div>

                <button id="processButton" class="process-button">
                    RECLASS
                </button>

                <div id="progressContainer" class="d-none w-full">
                    <div class="custom-progress">
                        <div id="progressBar" class="custom-progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                    </div>
                </div>

                <button id="exportButton" class="process-button d-none">
                    นำออกไฟล์อาคาร (Excel)
                </button>

                <div id="errorMessage" class="error-message d-none"></div>
            </div>
        </div>
    </div>

    <!-- Fixed buttons -->
    <div class="fixed-buttons">
        <a href="index.html" class="home-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
        </a>
        <a href="page3.html" class="landuse-button">
            Calculate Landuse
        </a>
    </div>

    <!-- Column Mapping Modal -->
    <div id="columnModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>จับคู่คอลัมน์</h3>
                <button class="modal-close" onclick="closeColumnModal()">&times;</button>
            </div>
            <div id="columnMappingList">
                <!-- Column mappings will be inserted here -->
            </div>
            <div class="modal-buttons">
                <button class="modal-button modal-button-secondary" onclick="closeColumnModal()">ยกเลิก</button>
                <button class="modal-button modal-button-primary" onclick="processWithMapping()">ประมวลผล</button>
            </div>
        </div>
    </div>

    <script>
const _0x149a98=_0x329f;function _0x329f(_0x2474fc,_0x15ed94){const _0x4797f1=_0x4797();return _0x329f=function(_0x329f9a,_0x28e17b){_0x329f9a=_0x329f9a-0xcf;let _0x1411b7=_0x4797f1[_0x329f9a];return _0x1411b7;},_0x329f(_0x2474fc,_0x15ed94);}(function(_0xbd5c2b,_0x391e33){const _0x1272c3=_0x329f,_0x2255fa=_0xbd5c2b();while(!![]){try{const _0x2035e2=parseInt(_0x1272c3(0x10d))/0x1+parseInt(_0x1272c3(0x123))/0x2+parseInt(_0x1272c3(0xeb))/0x3+-parseInt(_0x1272c3(0x133))/0x4+-parseInt(_0x1272c3(0x13c))/0x5*(parseInt(_0x1272c3(0x116))/0x6)+parseInt(_0x1272c3(0xf9))/0x7+parseInt(_0x1272c3(0xe7))/0x8*(-parseInt(_0x1272c3(0x128))/0x9);if(_0x2035e2===_0x391e33)break;else _0x2255fa['push'](_0x2255fa['shift']());}catch(_0x1f1f91){_0x2255fa['push'](_0x2255fa['shift']());}}}(_0x4797,0xb8a7a));let fileData=null,columnMapping={},processedData=[];const requiredColumns=[_0x149a98(0x137),_0x149a98(0x132),'BL_AREA','BL_NSTOREY',_0x149a98(0x142),_0x149a98(0xe8),'PL_BLOCK','PL_USE'],validBLTypes=['1','2','3','4','5','6','7','8','98','99'],plBlockPatterns={'อย.':_0x149a98(0x136),'ย.1':'ย.1','ย.2':_0x149a98(0xf4),'ย.3':_0x149a98(0x10e),'ย.4':'ย.4','ย.5':'ย.5','ย.6':_0x149a98(0xe4),'ย.7':_0x149a98(0x11d),'ย.8':_0x149a98(0xdc),'พ.1':'พ.1','พ.2':_0x149a98(0x13d),'พ.3':_0x149a98(0x135),'พ.4':_0x149a98(0xd7),'ขก.':_0x149a98(0x10f),'อ.1':'อ.1','อ.2':_0x149a98(0xfb),'อ.3':'อ.3','อ.4':_0x149a98(0xcf),'ก.1':_0x149a98(0x130),'ก.2':'ก.2','ก.3':_0x149a98(0x12a),'ก.4':_0x149a98(0x12c),'ก.5':'ก.5','อก.':_0x149a98(0xe0),'ปก.':_0x149a98(0xec),'อท.':'อท.','ล.':'ล.','ลล.':_0x149a98(0x10c),'สล.':'สล.','อป.':_0x149a98(0xe6),'ศษ.':'ศษ.','ลช.':_0x149a98(0xff),'ลส.':_0x149a98(0xf2),'อศ.':_0x149a98(0xf8),'ศน.':_0x149a98(0x12d),'ส.':'ส.'},reuse2Data={'1000':'10','1100':'10','1101':'10','1102':'10','1103':'10','1121':'10','1122':'10','1123':'10','1131':'10','1132':'10','1200':'10','1300':'10','1310':'10','1320':'10','1330':'10','1340':'10','1350':'10','1800':'90','2000':'20','2100':'20','2200':'20','2210':'20','2220':'20','2230':'20','2231':'20','2232':'20','2233':'20','2234':'20','2240':'20','2241':'20','2250':'20','2251':'20','2260':'20','2270':'20','2280':'20','2300':'20','2301':'20','2302':'20','2400':'20','2410':'20','2420':'20','2480':'20','2500':'20','2800':'20','3000':'30','3100':'30','3110':'30','3120':'30','3300':'33','3310':'33','3311':'33','3321':'33','3322':'33','3800':'30','4100':'41','4110':'41','4120':'41','4121':'41','4122':'41','4123':'41','4180':'41','4200':'30','4300':'30','5000':'90','5130':'90','5140':'90','5150':'90','5160':'90','5180':'90','5200':'90','5210':'90','5220':'90','5230':'90','5300':'90','5310':'90','5320':'90','5330':'90','5400':'90','5410':'90','5420':'90','5430':'90','5440':'90','5500':'90','5510':'90','5520':'90','5800':'90','6000':'90','6100':'90','6105':'90','6110':'90','6120':'90','6130':'90','6140':'90','6141':'90','6142':'90','6143':'90','6150':'90','6160':'90','6180':'90','6200':'90','6210':'90','6220':'90','6230':'90','6240':'90','6250':'90','6260':'90','6270':'90','6280':'90','6300':'90','6310':'90','6320':'90','6330':'90','6340':'90','6350':'90','6360':'90','6370':'90','6380':'90','6381':'90','6382':'90','6383':'90','6400':'90','6500':'90','6510':'90','6530':'90','6580':'90','6600':'90','6610':'90','6620':'90','6630':'90','6640':'90','6650':'90','6660':'90','6800':'90','6830':'90','6831':'90','7000':'90','7200':'90','7210':'90','7220':'90','7300':'90','7310':'90','7320':'90','7321':'90','7322':'90','7323':'90','7324':'90','7330':'90','7380':'90','8000':'80','8170':'80','8180':'80','8190':'80','8310':'80','8500':'80','9991':'90','9993':'90','9998':'90','9999':'90'};function validateRowData(_0x3bddcd,_0x2cd323){const _0x2797b5=_0x149a98,_0xc02bac=[],_0x7074f8=convertToText(_0x3bddcd[_0x2797b5(0x137)])['trim']();if(!_0x7074f8||_0x7074f8===''||_0x7074f8===_0x2797b5(0x118)||_0x7074f8==='undefined')_0xc02bac['push']('ไม่มีข้อมูล\x20BL_TYPE');else!validBLTypes[_0x2797b5(0x13f)](_0x7074f8)&&_0xc02bac[_0x2797b5(0x141)](_0x2797b5(0xf7));const _0x392e37=convertToText(_0x3bddcd[_0x2797b5(0x132)])[_0x2797b5(0x13b)]();if(!_0x392e37||_0x392e37===''||_0x392e37==='null'||_0x392e37===_0x2797b5(0xd4))_0xc02bac[_0x2797b5(0x141)]('ไม่มีข้อมูล\x20BL_USE');else!reuse2Data[_0x392e37]&&_0xc02bac[_0x2797b5(0x141)](_0x2797b5(0xd9));const _0x2ef032=convertToText(_0x3bddcd['BL_AREA'])[_0x2797b5(0x13b)]();if(!_0x2ef032||_0x2ef032===''||_0x2ef032===_0x2797b5(0x118)||_0x2ef032===_0x2797b5(0xd4))_0xc02bac[_0x2797b5(0x141)](_0x2797b5(0xee));else{const _0x101050=parseFloat(_0x2ef032);(isNaN(_0x101050)||_0x101050<=0x0)&&_0xc02bac[_0x2797b5(0x141)](_0x2797b5(0xef));}const _0x51d64c=convertToText(_0x3bddcd['BL_NSTOREY'])[_0x2797b5(0x13b)]();if(!_0x51d64c||_0x51d64c===''||_0x51d64c===_0x2797b5(0x118)||_0x51d64c===_0x2797b5(0xd4))_0xc02bac[_0x2797b5(0x141)](_0x2797b5(0xd3));else{const _0x2938c5=parseFloat(_0x51d64c);(isNaN(_0x2938c5)||_0x2938c5<=0x0)&&_0xc02bac[_0x2797b5(0x141)](_0x2797b5(0xf0));}if(_0x7074f8==='6'){const _0x3cf29e=convertToText(_0x3bddcd[_0x2797b5(0x142)])[_0x2797b5(0x13b)]();if(!_0x3cf29e||_0x3cf29e===''||_0x3cf29e==='null'||_0x3cf29e===_0x2797b5(0xd4))_0xc02bac[_0x2797b5(0x141)](_0x2797b5(0xd8));else{const _0xaba1e6=parseFloat(_0x3cf29e);(isNaN(_0xaba1e6)||_0xaba1e6<=0x0)&&_0xc02bac[_0x2797b5(0x141)]('ไม่มีข้อมูล\x20BL_NUNIT');}}const _0x7239=convertToText(_0x3bddcd[_0x2797b5(0xe8)])[_0x2797b5(0x13b)]();if(!_0x7239||_0x7239===''||_0x7239===_0x2797b5(0x118)||_0x7239===_0x2797b5(0xd4))_0xc02bac[_0x2797b5(0x141)]('ไม่มีข้อมูล\x20ACQYEAR');else{const _0x213f1b=parseInt(_0x7239);(isNaN(_0x213f1b)||_0x213f1b<0x9ec||_0x213f1b>0xa28)&&_0xc02bac['push'](_0x2797b5(0x119));}const _0x17fd5c=convertToText(_0x3bddcd[_0x2797b5(0x111)])[_0x2797b5(0x13b)]();(!_0x17fd5c||_0x17fd5c===''||_0x17fd5c===_0x2797b5(0x118)||_0x17fd5c==='undefined')&&_0xc02bac[_0x2797b5(0x141)](_0x2797b5(0xed));const _0x613a9a=convertToText(_0x3bddcd[_0x2797b5(0x110)])['trim']();return(!_0x613a9a||_0x613a9a===''||_0x613a9a===_0x2797b5(0x118)||_0x613a9a==='undefined')&&_0xc02bac[_0x2797b5(0x141)](_0x2797b5(0x144)),_0xc02bac[_0x2797b5(0x129)](',\x20');}function checkPLBlock(_0xbd44b){const _0x30c9bf=_0x149a98;if(!_0xbd44b)return'';_0xbd44b=_0xbd44b['toString']();for(const [_0x40e7cb,_0x371b79]of Object[_0x30c9bf(0xe2)](plBlockPatterns)){if(_0xbd44b[_0x30c9bf(0x13f)](_0x40e7cb))return _0x371b79;}return'';}function checkPLBlockPattern(_0x2f4cd7){const _0x75c300=_0x149a98;if(!_0x2f4cd7)return![];const _0x3adc90=/[ก-์a-zA-Z]+\.\d+-\d+/;return _0x3adc90[_0x75c300(0x104)](_0x2f4cd7);}function extractTextUpToPeriod(_0x20ac0d){const _0x4c4977=_0x149a98;if(!_0x20ac0d)return'';const _0x5cd554=_0x20ac0d[_0x4c4977(0xe3)]('.');if(_0x5cd554===-0x1)return _0x20ac0d;return _0x20ac0d['substring'](0x0,_0x5cd554+0x1);}function convertToText(_0x541bd0){const _0x1b5d47=_0x149a98;if(_0x541bd0===null||_0x541bd0===undefined)return'';return _0x541bd0[_0x1b5d47(0x134)]();}function showError(_0x218cab){const _0x34e7fe=_0x149a98,_0x204661=document['getElementById'](_0x34e7fe(0x126));_0x204661['textContent']=_0x218cab,_0x204661['classList']['remove'](_0x34e7fe(0x114)),setTimeout(()=>{const _0x2322f5=_0x34e7fe;_0x204661[_0x2322f5(0x117)][_0x2322f5(0xdd)]('d-none');},0x1388);}function updateFileName(_0x2e49a7){const _0x5c623f=_0x149a98,_0xcbe992=document[_0x5c623f(0x10a)](_0x5c623f(0x143));_0x2e49a7[_0x5c623f(0x122)]&&_0x2e49a7[_0x5c623f(0x122)][0x0]?_0xcbe992[_0x5c623f(0x102)]=_0x2e49a7[_0x5c623f(0x122)][0x0][_0x5c623f(0xf5)]:_0xcbe992[_0x5c623f(0x102)]='';}function showColumnModal(_0x2da520){const _0x5d7f5d=_0x149a98,_0x457da6=document[_0x5d7f5d(0x10a)](_0x5d7f5d(0x105)),_0x6df136=document['getElementById']('columnMappingList');_0x6df136['innerHTML']='',requiredColumns[_0x5d7f5d(0x140)](_0x336b6b=>{const _0x2d51f8=_0x5d7f5d,_0x5286f7=document[_0x2d51f8(0x112)]('div');_0x5286f7['className']=_0x2d51f8(0xdf);const _0x19ad93=document[_0x2d51f8(0x112)](_0x2d51f8(0x121));_0x19ad93[_0x2d51f8(0x102)]=_0x336b6b,_0x5286f7['appendChild'](_0x19ad93);const _0x33f7dd=document[_0x2d51f8(0x112)]('select');_0x33f7dd[_0x2d51f8(0xf5)]=_0x336b6b;const _0x32a975=document['createElement'](_0x2d51f8(0xd5));_0x32a975[_0x2d51f8(0x11c)]='',_0x32a975[_0x2d51f8(0x102)]='--\x20เลือกคอลัมน์\x20--',_0x33f7dd['appendChild'](_0x32a975),_0x2da520['forEach'](_0x28c5de=>{const _0x2fe8a5=_0x2d51f8,_0x27b7d7=document['createElement'](_0x2fe8a5(0xd5));_0x27b7d7['value']=_0x28c5de,_0x27b7d7['textContent']=_0x28c5de,_0x28c5de[_0x2fe8a5(0x12e)]()===_0x336b6b&&(_0x27b7d7[_0x2fe8a5(0x120)]=!![]),_0x33f7dd['appendChild'](_0x27b7d7);}),_0x5286f7['appendChild'](_0x33f7dd),_0x6df136[_0x2d51f8(0x10b)](_0x5286f7);}),_0x457da6[_0x5d7f5d(0xd0)]['display']=_0x5d7f5d(0xfd);}function closeColumnModal(){const _0x5e65ad=_0x149a98;document['getElementById'](_0x5e65ad(0x105))[_0x5e65ad(0xd0)][_0x5e65ad(0xe1)]=_0x5e65ad(0x107);}function getColumnMapping(){const _0x336cc6=_0x149a98,_0x40896c={},_0x1b4572=document['querySelectorAll'](_0x336cc6(0xda));let _0x1a7429=!![];return _0x1b4572[_0x336cc6(0x140)](_0x10855d=>{const _0x16a9a8=_0x336cc6;_0x10855d[_0x16a9a8(0x11c)]?_0x40896c[_0x10855d[_0x16a9a8(0xf5)]]=_0x10855d[_0x16a9a8(0x11c)]:_0x1a7429=![];}),{'mapping':_0x40896c,'isValid':_0x1a7429};}function processExcel(){const _0x24c8ee=_0x149a98,_0x3fd017=document[_0x24c8ee(0x10a)](_0x24c8ee(0xfa)),_0x5132c1=_0x3fd017[_0x24c8ee(0x122)][0x0];if(!_0x5132c1){showError(_0x24c8ee(0x138));return;}const _0x394b61=new FileReader();_0x394b61[_0x24c8ee(0x11a)]=function(_0x5df583){const _0x3b62c5=_0x24c8ee,_0x47fb20=new Uint8Array(_0x5df583[_0x3b62c5(0x124)][_0x3b62c5(0xe5)]),_0x32a08c=XLSX[_0x3b62c5(0x11e)](_0x47fb20,{'type':'array'}),_0x54568f=_0x32a08c[_0x3b62c5(0xde)][0x0],_0x32f1b5=_0x32a08c['Sheets'][_0x54568f],_0x114078=XLSX['utils'][_0x3b62c5(0x125)](_0x32f1b5);if(_0x114078[_0x3b62c5(0xe9)]===0x0){showError(_0x3b62c5(0x11f));return;}fileData=_0x114078;const _0x14f2a9=Object[_0x3b62c5(0x109)](_0x114078[0x0]),_0x49dd81=requiredColumns[_0x3b62c5(0x11b)](_0x422b60=>!_0x14f2a9['some'](_0x18deb2=>_0x18deb2['toUpperCase']()===_0x422b60));_0x49dd81[_0x3b62c5(0xe9)]===0x0?processData(_0x114078):showColumnModal(_0x14f2a9);},_0x394b61['readAsArrayBuffer'](_0x5132c1);}function processWithMapping(){const _0x427d37=_0x149a98,{mapping:_0x5925a2,isValid:_0x57c703}=getColumnMapping();if(!_0x57c703){showError(_0x427d37(0x100));return;}columnMapping=_0x5925a2,closeColumnModal();const _0x2dab14=fileData[_0x427d37(0xfc)](_0x9754d3=>{const _0x3630e7=_0x427d37,_0x43721b={};return Object[_0x3630e7(0x109)](columnMapping)[_0x3630e7(0x140)](_0x16d822=>{_0x43721b[_0x16d822]=_0x9754d3[columnMapping[_0x16d822]];}),Object[_0x3630e7(0x109)](_0x9754d3)[_0x3630e7(0x140)](_0xacaf0=>{const _0x58d0b0=_0x3630e7;!Object[_0x58d0b0(0x113)](columnMapping)[_0x58d0b0(0x13f)](_0xacaf0)&&(_0x43721b[_0xacaf0]=_0x9754d3[_0xacaf0]);}),_0x43721b;});processData(_0x2dab14);}function _0x4797(){const _0x2122c4=['BL_TYPE','กรุณาเลือกไฟล์\x20Excel','round','book_append_sheet','trim','3144055IjGoRK','พ.2','aria-valuenow','includes','forEach','push','BL_NUNIT','fileName','ไม่มีข้อมูล\x20PL_USE','อ.4','style','remove','PL_BLOCK2','ไม่มีข้อมูล\x20BL_NSTOREY','undefined','option','width','พ.4','ไม่มีข้อมูล\x20BL_NUNIT','ข้อมูล\x20BL_USE\x20ไม่ถูกต้อง','#columnMappingList\x20select','book_new','ย.8','add','SheetNames','column-mapping','อก.','display','entries','indexOf','ย.6','result','อป.','250024iiLnPh','ACQYEAR','length','พื้นที่การใช้ประโยชน์อาคารรวม','4263255bFETMn','ปก.','ไม่มีข้อมูล\x20PL_BLOCK','ไม่มีข้อมูล\x20BL_AREA','ข้อมูล\x20BL_AREA\x20ไม่ถูกต้อง','ข้อมูล\x20BL_NSTOREY\x20ไม่ถูกต้อง','progressBar','ลส.','click','ย.2','name','BL_AREA','ข้อมูล\x20BL_TYPE\x20ไม่ถูกต้อง','อศ.','3653174jJpmfc','excelFile','อ.2','map','block','RE_BL_USE','ลช.','กรุณาเลือกคอลัมน์ให้ครบทุกรายการ','json_to_sheet','textContent','exportButton','test','columnModal','PL_USE_O','none','bldg_reclass.xlsx','keys','getElementById','appendChild','ลล.','398239WFbBmO','ย.3','ขก.','PL_USE','PL_BLOCK','createElement','values','d-none','ProcessedData','12MqMDNN','classList','null','ข้อมูล\x20ACQYEAR\x20ไม่ถูกต้อง','onload','filter','value','ย.7','read','ไฟล์\x20Excel\x20ไม่มีข้อมูล','selected','label','files','224494bQbAHz','target','sheet_to_json','errorMessage','processButton','63FIjugx','join','ก.3','utils','ก.4','ศน.','toUpperCase','RE_BL_AREA','ก.1','setAttribute','BL_USE','882856xxxuBC','toString','พ.3','อย.'];_0x4797=function(){return _0x2122c4;};return _0x4797();}function processData(_0x797194){const _0x1e6eef=_0x149a98,_0x37e466=document[_0x1e6eef(0x10a)](_0x1e6eef(0xf1)),_0x267811=document[_0x1e6eef(0x10a)]('progressContainer');_0x267811[_0x1e6eef(0x117)][_0x1e6eef(0xd1)](_0x1e6eef(0x114));let _0x5962b9=_0x797194[_0x1e6eef(0xfc)]((_0x86f255,_0xff0a15)=>{const _0x22a6ca=_0x1e6eef,_0x36affc=Math[_0x22a6ca(0x139)]((_0xff0a15+0x1)/_0x797194[_0x22a6ca(0xe9)]*0x32);_0x37e466['style'][_0x22a6ca(0xd6)]=_0x36affc+'%',_0x37e466['setAttribute']('aria-valuenow',_0x36affc),_0x37e466['textContent']=_0x36affc+'%';const _0x3b4ea8={..._0x86f255};_0x3b4ea8[_0x22a6ca(0x137)]=convertToText(_0x86f255[_0x22a6ca(0x137)]),_0x3b4ea8[_0x22a6ca(0x132)]=convertToText(_0x86f255['BL_USE']),_0x3b4ea8['ACQYEAR']=convertToText(_0x86f255[_0x22a6ca(0xe8)]),_0x3b4ea8[_0x22a6ca(0x111)]=convertToText(_0x86f255[_0x22a6ca(0x111)]),_0x3b4ea8[_0x22a6ca(0x110)]=convertToText(_0x86f255[_0x22a6ca(0x110)]);const _0x205e38=_0x86f255['BL_NUNIT'];return _0x205e38!==null&&_0x205e38!==undefined?_0x3b4ea8[_0x22a6ca(0x142)]=Math['round'](parseFloat(_0x205e38)):_0x3b4ea8['BL_NUNIT']=0x0,_0x3b4ea8[_0x22a6ca(0xd2)]=checkPLBlock(_0x86f255[_0x22a6ca(0x111)]),_0x3b4ea8['REMARKS']=validateRowData(_0x3b4ea8,_0xff0a15),_0x3b4ea8;});const _0x5f00fd=_0x5962b9['some'](_0x365640=>_0x365640['PL_BLOCK2']&&_0x365640[_0x1e6eef(0xd2)][_0x1e6eef(0x13b)]()!=='');_0x5f00fd?processedData=_0x5962b9[_0x1e6eef(0xfc)]((_0x43d99d,_0x15db1b)=>{const _0x31d932=_0x1e6eef,_0x2fadfb=Math[_0x31d932(0x139)](0x32+(_0x15db1b+0x1)/_0x5962b9[_0x31d932(0xe9)]*0x32);_0x37e466[_0x31d932(0xd0)][_0x31d932(0xd6)]=_0x2fadfb+'%',_0x37e466[_0x31d932(0x131)](_0x31d932(0x13e),_0x2fadfb),_0x37e466[_0x31d932(0x102)]=_0x2fadfb+'%';!_0x43d99d[_0x31d932(0xd2)]&&_0x43d99d[_0x31d932(0x111)]&&(_0x43d99d[_0x31d932(0xd2)]=extractTextUpToPeriod(_0x43d99d[_0x31d932(0x111)]));_0x43d99d[_0x31d932(0x106)]=_0x43d99d[_0x31d932(0x110)];checkPLBlockPattern(_0x43d99d[_0x31d932(0x111)])&&(_0x43d99d[_0x31d932(0x110)]=_0x43d99d['PL_USE_O']+'-'+_0x43d99d[_0x31d932(0xd2)]);const _0x228355=parseFloat(_0x43d99d[_0x31d932(0xf6)])||0x0,_0x417645=parseFloat(_0x43d99d['BL_NSTOREY'])||0x0,_0x2ffca3=parseInt(_0x43d99d['BL_NUNIT'])||0x0;return _0x43d99d[_0x31d932(0xea)]=_0x228355*_0x417645,_0x43d99d[_0x31d932(0xfe)]=reuse2Data[_0x43d99d['BL_USE']]||'',_0x43d99d[_0x31d932(0x12f)]=determineCode({..._0x43d99d,'BL_AREA':_0x228355,'BL_NSTOREY':_0x417645,'BL_NUNIT':_0x2ffca3}),_0x43d99d;}):processedData=_0x5962b9['map']((_0x21499c,_0x18a006)=>{const _0xce47a7=_0x1e6eef,_0x27fc37=Math['round'](0x32+(_0x18a006+0x1)/_0x5962b9[_0xce47a7(0xe9)]*0x32);_0x37e466[_0xce47a7(0xd0)][_0xce47a7(0xd6)]=_0x27fc37+'%',_0x37e466[_0xce47a7(0x131)](_0xce47a7(0x13e),_0x27fc37),_0x37e466['textContent']=_0x27fc37+'%';const _0x27fd00=parseFloat(_0x21499c[_0xce47a7(0xf6)])||0x0,_0x40e688=parseFloat(_0x21499c['BL_NSTOREY'])||0x0,_0x520414=parseInt(_0x21499c[_0xce47a7(0x142)])||0x0;return _0x21499c[_0xce47a7(0xea)]=_0x27fd00*_0x40e688,_0x21499c[_0xce47a7(0xfe)]=reuse2Data[_0x21499c['BL_USE']]||'',_0x21499c[_0xce47a7(0x12f)]=determineCode({..._0x21499c,'BL_AREA':_0x27fd00,'BL_NSTOREY':_0x40e688,'BL_NUNIT':_0x520414}),_0x21499c;}),document[_0x1e6eef(0x10a)](_0x1e6eef(0x103))['classList'][_0x1e6eef(0xd1)]('d-none');}function determineCode(_0x5cb8dc){const _0x941829=_0x149a98,{RE_BL_USE:_0x3b7059,BL_TYPE:_0xc7299,BL_NSTOREY:_0x3b3bc5}=_0x5cb8dc,_0x1a6761=parseFloat(_0x5cb8dc[_0x941829(0xf6)])||0x0,_0x3ed3f2=_0x5cb8dc['พื้นที่การใช้ประโยชน์อาคารรวม'];if(_0x3ed3f2>=0x7d0){if(_0x3b7059==='10'&&_0x1a6761>=0x65&&_0x1a6761<=0x190)return 0x4;if(_0x3b7059==='10'&&_0x1a6761>=0x191)return 0x5;if(_0x3b7059==='20'&&_0x1a6761>=0x65&&_0x1a6761<=0x190)return 0x2;if(_0x3b7059==='20'&&_0x1a6761>=0x191)return 0x3;if(_0x3b7059==='41'&&_0x1a6761>=0x65&&_0x1a6761<=0x190)return 0x2;if(_0x3b7059==='41'&&_0x1a6761>=0x191)return 0x3;}if(_0x3ed3f2>=0x3e8&&_0x3b3bc5>=0x5){if(_0x3b7059==='10'&&_0x1a6761>=0x65&&_0x1a6761<=0x190)return 0x4;if(_0x3b7059==='10'&&_0x1a6761>=0x191)return 0x5;if(_0x3b7059==='20'&&_0x1a6761>=0x65&&_0x1a6761<=0x190)return 0x2;if(_0x3b7059==='20'&&_0x1a6761>=0x191)return 0x3;if(_0x3b7059==='41'&&_0x1a6761>=0x65&&_0x1a6761<=0x190)return 0x2;if(_0x3b7059==='41'&&_0x1a6761>=0x191)return 0x3;}if(_0x3b3bc5>=0x8){if(_0x3b7059==='10'&&_0x1a6761>=0x65&&_0x1a6761<=0x190)return 0x4;if(_0x3b7059==='10'&&_0x1a6761>=0x191)return 0x5;if(_0x3b7059==='20'&&_0x1a6761>=0x65&&_0x1a6761<=0x190)return 0x2;if(_0x3b7059==='20'&&_0x1a6761>=0x191)return 0x3;if(_0x3b7059==='41'&&_0x1a6761>=0x65&&_0x1a6761<=0x190)return 0x2;if(_0x3b7059==='41'&&_0x1a6761>=0x191)return 0x3;}if(_0x3b7059==='10'){if(_0xc7299==='1'||_0xc7299==='2')return 0x1;if(_0xc7299==='3'||_0xc7299==='4'||_0xc7299==='5')return 0x2;if(_0xc7299==='6')return 0x3;}if(_0x3b7059==='20'||_0x3b7059==='41')return 0x1;if(_0x3b7059==='30'){if(_0x1a6761<=0xc8)return 0x1;if(_0x1a6761>0xc8&&_0x1a6761<=0x1f4)return 0x2;if(_0x1a6761>0x1f4&&_0x1a6761<=0x3e8)return 0x3;if(_0x1a6761>0x3e8)return 0x4;}if(_0x3b7059==='33'){if(_0x1a6761<=0x64)return 0x1;if(_0x1a6761>0x64&&_0x1a6761<=0x1f4)return 0x2;if(_0x1a6761>0x1f4)return 0x3;}if(_0x3b7059==='80'||_0x3b7059==='90')return 0x1;return 0x0;}function exportToExcel(){const _0x5c356c=_0x149a98,_0x26edb8=XLSX[_0x5c356c(0x12b)][_0x5c356c(0x101)](processedData),_0x573e77=XLSX[_0x5c356c(0x12b)][_0x5c356c(0xdb)]();XLSX[_0x5c356c(0x12b)][_0x5c356c(0x13a)](_0x573e77,_0x26edb8,_0x5c356c(0x115)),XLSX['writeFile'](_0x573e77,_0x5c356c(0x108));}document['getElementById'](_0x149a98(0x127))['addEventListener'](_0x149a98(0xf3),processExcel),document[_0x149a98(0x10a)](_0x149a98(0x103))['addEventListener'](_0x149a98(0xf3),exportToExcel);
    </script>
<script data-goatcounter="https://mponline.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> 
</body>
</html>