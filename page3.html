<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>คำนวณพื้นที่การใช้ประโยชน์ที่ดิน</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        .filter-container { margin-bottom: 20px; }
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .total-row { background-color: #e6f2ff; font-weight: bold; }
    </style>
</head>
<body>
    <h1>คำนวณพื้นที่การใช้ประโยชน์ที่ดิน</h1>
    
    <div>
        <label for="buildingFile">ไฟล์อาคาร:</label>
        <input type="file" id="buildingFile" accept=".xlsx, .xls">
    </div>
    
    <div>
        <label for="plluFile">ไฟล์ pllu:</label>
        <input type="file" id="plluFile" accept=".xlsx, .xls">
    </div>

    <div>
        กรณีต้องการเรียงรายการตามประเภทการใช้ประโยชน์ที่ดิน ให้คลิกปุ่ม <a href="page5.html" class="btn btn-info mt-3">ปรับข้อมูล PLLU</a> <br>
        แล้วนำผลที่ได้จากการปรับข้อมูล มาใส่ในไฟล์ pllu 
    </div>
    
    <button onclick="processFiles()">ประมวลผล</button>
    <button onclick="exportToExcel()">ส่งออกเป็น Excel</button>
    
    <div class="filter-container">
        <label for="pl-use-filter">กรองตาม PL_USE:</label>
        <select id="pl-use-filter">
            <option value="all">ทั้งหมด</option>
        </select>
        
        <div>
            <label>กรองตาม ACQYEAR:</label>
            <div id="acqyear-filter" class="checkbox-group"></div>
        </div>
        
        <div>
            <label>กรองตาม Re_BL_CODE:</label>
            <div id="re-bl-code-filter" class="checkbox-group"></div>
        </div>
    </div>
    
    <div id="tableContainer"></div>

    <script>
(function(_0x33a765,_0x58e364){const _0x3ae8c5=_0x591a,_0x11d00a=_0x33a765();while(!![]){try{const _0x47fae7=-parseInt(_0x3ae8c5(0xb8))/0x1+parseInt(_0x3ae8c5(0x8c))/0x2*(-parseInt(_0x3ae8c5(0x80))/0x3)+-parseInt(_0x3ae8c5(0x97))/0x4+-parseInt(_0x3ae8c5(0x85))/0x5+-parseInt(_0x3ae8c5(0xc2))/0x6+-parseInt(_0x3ae8c5(0xa8))/0x7+-parseInt(_0x3ae8c5(0xbe))/0x8*(-parseInt(_0x3ae8c5(0x9b))/0x9);if(_0x47fae7===_0x58e364)break;else _0x11d00a['push'](_0x11d00a['shift']());}catch(_0x23138f){_0x11d00a['push'](_0x11d00a['shift']());}}}(_0x57fa,0xc2015));function _0x57fa(){const _0x1ec931=['</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','3567366HCYyxX','result','option','<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','landUseArea','input','</th>','ACQYEAR','sort','checked','querySelector','<table><tr><th>บริเวณการใช้ประโยชน์ที่ดิน</th><th>พื้นที่\x20block</th>','land_use_calculation.xlsx','acqyear-filter','%</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>','target','plluFile','utils','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','AREA','Sheets','466611MAAaLx','textContent','re-bl-code-filter','กรุณาเลือกไฟล์ทั้งสองไฟล์','getElementById','2184535XiKzDN','readAsArrayBuffer','read','Re_BL_CODE','change','from','<td>','2KGtTrc','PL_BLOCK','querySelectorAll','toLocaleString','checkbox','innerHTML','table','flatMap','addEventListener','htmlFor','buildingCount','4620024vgwTsw','<th\x20colspan=\x222\x22>รวมพื้นที่อาคารคลุมดิน</th><th\x20colspan=\x222\x22>การใช้ประโยชน์ที่ดิน</th></tr>','coveredArea','<th>จำนวนอาคาร</th><th>พื้นที่อาคารคลุมดินรวม</th><th>พื้นที่การใช้ที่ดินรวม</th>','621mfeDJo','array','onload','files','<tr><th></th><th></th>','<th>จำนวนอาคาร</th><th>พื้นที่อาคารรวม</th><th>พื้นที่</th><th>ร้อยละพื้นที่</th></tr>','toString','#re-bl-code-filter\x20input:checked','en-US','acqyear-','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','writeFile','map','6522516eoVcnc','forEach','length','<th\x20colspan=\x223\x22>','<td>0</td><td>0</td><td>0</td>','label','appendChild','some','filter','createElement','<tr\x20class=\x22total-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>ผลรวม</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','</td>','re-bl-code-','reduce','type','split','340587yRHrwB','Sheet\x20JS','pl-use-filter','value','BL_AREA','code','511192TiMfGM','PL_USE','includes'];_0x57fa=function(){return _0x1ec931;};return _0x57fa();}let buildingData,plluData;function processFiles(){const _0x3955c9=_0x591a,_0x3a0e3d=document[_0x3955c9(0x84)]('buildingFile')[_0x3955c9(0x9e)][0x0],_0x124432=document['getElementById'](_0x3955c9(0xd2))[_0x3955c9(0x9e)][0x0];if(!_0x3a0e3d||!_0x124432){alert(_0x3955c9(0x83));return;}const _0x551f71=new FileReader();_0x551f71[_0x3955c9(0x9d)]=function(_0x32d606){const _0x1a9849=_0x3955c9,_0x34c2d1=new Uint8Array(_0x32d606['target'][_0x1a9849(0xc3)]),_0x5c5b1d=XLSX[_0x1a9849(0x87)](_0x34c2d1,{'type':_0x1a9849(0x9c)});buildingData=XLSX[_0x1a9849(0xd3)]['sheet_to_json'](_0x5c5b1d[_0x1a9849(0x7f)][_0x5c5b1d['SheetNames'][0x0]]);const _0x412805=new FileReader();_0x412805[_0x1a9849(0x9d)]=function(_0x127d3c){const _0x36faff=_0x1a9849,_0x5997b6=new Uint8Array(_0x127d3c[_0x36faff(0xd1)]['result']),_0xcb66f4=XLSX[_0x36faff(0x87)](_0x5997b6,{'type':'array'});plluData=XLSX[_0x36faff(0xd3)]['sheet_to_json'](_0xcb66f4[_0x36faff(0x7f)][_0xcb66f4['SheetNames'][0x0]]),setupFilters(),calculateAndDisplayTable();},_0x412805['readAsArrayBuffer'](_0x124432);},_0x551f71[_0x3955c9(0x86)](_0x3a0e3d);}function _0x591a(_0x1b47ef,_0x2eec76){const _0x57fa1c=_0x57fa();return _0x591a=function(_0x591a17,_0x12f34d){_0x591a17=_0x591a17-0x7e;let _0x288c3c=_0x57fa1c[_0x591a17];return _0x288c3c;},_0x591a(_0x1b47ef,_0x2eec76);}function setupFilters(){const _0x19ec35=_0x591a,_0xf33df8=document[_0x19ec35(0x84)](_0x19ec35(0xba)),_0x13bead=document[_0x19ec35(0x84)](_0x19ec35(0xcf)),_0x4fc288=document[_0x19ec35(0x84)](_0x19ec35(0x82)),_0x365a40=[...new Set(plluData['map'](_0x51172e=>_0x51172e[_0x19ec35(0xbf)]))];_0x365a40['forEach'](_0x115d1c=>{const _0x321592=_0x19ec35,_0x151e87=document[_0x321592(0xb1)](_0x321592(0xc4));_0x151e87[_0x321592(0xbb)]=_0x115d1c,_0x151e87['textContent']=_0x115d1c,_0xf33df8[_0x321592(0xae)](_0x151e87);});const _0x46bae6=[...new Set(buildingData[_0x19ec35(0xa7)](_0x10297b=>_0x10297b[_0x19ec35(0xc9)]))];_0x46bae6[_0x19ec35(0xa9)](_0x4cae94=>{const _0x4b8eab=_0x19ec35,_0x36fc98=document[_0x4b8eab(0xb1)](_0x4b8eab(0xc7));_0x36fc98['type']=_0x4b8eab(0x90),_0x36fc98['id']=_0x4b8eab(0xa4)+_0x4cae94,_0x36fc98[_0x4b8eab(0xbb)]=_0x4cae94,_0x36fc98[_0x4b8eab(0xcb)]=!![];const _0x4657fe=document['createElement'](_0x4b8eab(0xad));_0x4657fe['htmlFor']=_0x4b8eab(0xa4)+_0x4cae94,_0x4657fe[_0x4b8eab(0x81)]=_0x4cae94,_0x13bead['appendChild'](_0x36fc98),_0x13bead[_0x4b8eab(0xae)](_0x4657fe);});const _0x342ba2=[...new Set(buildingData[_0x19ec35(0xa7)](_0x2b3fc8=>_0x2b3fc8[_0x19ec35(0x88)]))]['filter'](_0x11af2b=>_0x11af2b>=0xa);_0x342ba2[_0x19ec35(0xa9)](_0x310bfe=>{const _0x1943d9=_0x19ec35,_0x2ec72e=document[_0x1943d9(0xb1)](_0x1943d9(0xc7));_0x2ec72e[_0x1943d9(0xb6)]=_0x1943d9(0x90),_0x2ec72e['id']=_0x1943d9(0xb4)+_0x310bfe,_0x2ec72e[_0x1943d9(0xbb)]=_0x310bfe,_0x2ec72e['checked']=!![];const _0x4a4c58=document[_0x1943d9(0xb1)](_0x1943d9(0xad));_0x4a4c58[_0x1943d9(0x95)]=_0x1943d9(0xb4)+_0x310bfe,_0x4a4c58[_0x1943d9(0x81)]=_0x310bfe,_0x4fc288['appendChild'](_0x2ec72e),_0x4fc288[_0x1943d9(0xae)](_0x4a4c58);}),_0xf33df8[_0x19ec35(0x94)](_0x19ec35(0x89),calculateAndDisplayTable),_0x13bead['addEventListener'](_0x19ec35(0x89),calculateAndDisplayTable),_0x4fc288[_0x19ec35(0x94)]('change',calculateAndDisplayTable);}function calculateAndDisplayTable(){const _0x31b144=_0x591a,_0x23dcfb=document[_0x31b144(0x84)](_0x31b144(0xba))[_0x31b144(0xbb)],_0x2d37a3=Array['from'](document[_0x31b144(0x8e)]('#acqyear-filter\x20input:checked'))[_0x31b144(0xa7)](_0x231329=>_0x231329[_0x31b144(0xbb)]),_0x449469=Array[_0x31b144(0x8a)](document[_0x31b144(0x8e)](_0x31b144(0xa2)))[_0x31b144(0xa7)](_0x189817=>_0x189817['value']),_0x36cfa6=_0x23dcfb==='all'?plluData:plluData[_0x31b144(0xb0)](_0xa7b446=>_0xa7b446[_0x31b144(0xbf)]===_0x23dcfb),_0x10c510=buildingData['filter'](_0x201edc=>_0x2d37a3['includes'](_0x201edc[_0x31b144(0xc9)][_0x31b144(0xa1)]())&&_0x449469[_0x31b144(0xc0)](_0x201edc[_0x31b144(0x88)][_0x31b144(0xa1)]())&&_0x201edc[_0x31b144(0x88)]>=0xa),_0x303efa=_0x449469[_0x31b144(0x93)](_0x228d55=>[0x1,0x2,0x3,0x4,0x5][_0x31b144(0xa7)](_0x4b94e2=>_0x228d55+'_'+_0x4b94e2))[_0x31b144(0xca)](),_0x2c8e51=_0x36cfa6[_0x31b144(0xa7)](_0x29a014=>{const _0xaec5b0=_0x31b144,_0x47ce3c=_0x10c510[_0xaec5b0(0xb0)](_0x2230b0=>_0x2230b0[_0xaec5b0(0x8d)]===_0x29a014['PL_BLOCK']),_0x4388df={};return _0x303efa[_0xaec5b0(0xa9)](_0x2dcdf4=>{const _0x277ba7=_0xaec5b0,[_0x2961e5,_0x2162d7]=_0x2dcdf4[_0x277ba7(0xb7)]('_')[_0x277ba7(0xa7)](Number),_0x264ef1=_0x47ce3c[_0x277ba7(0xb0)](_0x31d190=>_0x31d190['Re_BL_CODE']==_0x2961e5&&_0x31d190[_0x277ba7(0xbd)]==_0x2162d7);_0x264ef1[_0x277ba7(0xaa)]>0x0&&(_0x4388df[_0x2dcdf4]={'buildingCount':_0x264ef1[_0x277ba7(0xaa)],'coveredArea':_0x264ef1['reduce']((_0x936cc6,_0x38b881)=>_0x936cc6+_0x38b881[_0x277ba7(0xbc)],0x0),'landUseArea':calculateLandUseArea(_0x264ef1,_0x2961e5,_0x2162d7)});}),{'PL_BLOCK':_0x29a014[_0xaec5b0(0x8d)],'AREA':_0x29a014[_0xaec5b0(0x7e)],..._0x4388df};}),_0x5987ba=_0x2c8e51[_0x31b144(0xb5)]((_0x5c538d,_0xf05686)=>{const _0x5b99ce=_0x31b144;return _0x5c538d[_0x5b99ce(0x7e)]+=_0xf05686[_0x5b99ce(0x7e)],_0x303efa[_0x5b99ce(0xa9)](_0x13f24d=>{const _0xa7e146=_0x5b99ce;_0xf05686[_0x13f24d]&&(!_0x5c538d[_0x13f24d]&&(_0x5c538d[_0x13f24d]={'buildingCount':0x0,'coveredArea':0x0,'landUseArea':0x0}),_0x5c538d[_0x13f24d][_0xa7e146(0x96)]+=_0xf05686[_0x13f24d][_0xa7e146(0x96)],_0x5c538d[_0x13f24d][_0xa7e146(0x99)]+=_0xf05686[_0x13f24d][_0xa7e146(0x99)],_0x5c538d[_0x13f24d][_0xa7e146(0xc6)]+=_0xf05686[_0x13f24d][_0xa7e146(0xc6)]);}),_0x5c538d;},{'AREA':0x0}),_0x51472b=document[_0x31b144(0x84)]('tableContainer');let _0x12fe5b=_0x31b144(0xcd);_0x303efa[_0x31b144(0xa9)](_0x4982f1=>{const _0x33ccbc=_0x31b144;_0x2c8e51[_0x33ccbc(0xaf)](_0x43a4d9=>_0x43a4d9[_0x4982f1])&&(_0x12fe5b+=_0x33ccbc(0xab)+_0x4982f1+_0x33ccbc(0xc8));}),_0x12fe5b+=_0x31b144(0x98),_0x12fe5b+=_0x31b144(0x9f),_0x303efa[_0x31b144(0xa9)](_0x1db57c=>{const _0x2b3fdd=_0x31b144;_0x2c8e51[_0x2b3fdd(0xaf)](_0x225045=>_0x225045[_0x1db57c])&&(_0x12fe5b+=_0x2b3fdd(0x9a));}),_0x12fe5b+=_0x31b144(0xa0),_0x2c8e51[_0x31b144(0xa9)](_0x2a5ca1=>{const _0x579dc4=_0x31b144;_0x12fe5b+=_0x579dc4(0xc5)+_0x2a5ca1[_0x579dc4(0x8d)]+_0x579dc4(0xd4)+formatNumber(_0x2a5ca1[_0x579dc4(0x7e)])+_0x579dc4(0xb3);let _0x22a652=0x0,_0x4da78e=0x0,_0x29d476=0x0;_0x303efa[_0x579dc4(0xa9)](_0xa1c3f7=>{const _0x504d55=_0x579dc4;_0x2c8e51[_0x504d55(0xaf)](_0x351b57=>_0x351b57[_0xa1c3f7])&&(_0x2a5ca1[_0xa1c3f7]?(_0x12fe5b+=_0x504d55(0x8b)+formatNumber(_0x2a5ca1[_0xa1c3f7][_0x504d55(0x96)])+_0x504d55(0xc1)+formatNumber(_0x2a5ca1[_0xa1c3f7][_0x504d55(0x99)])+_0x504d55(0xc1)+formatNumber(_0x2a5ca1[_0xa1c3f7]['landUseArea'])+'</td>',_0x22a652+=_0x2a5ca1[_0xa1c3f7][_0x504d55(0x96)],_0x4da78e+=_0x2a5ca1[_0xa1c3f7][_0x504d55(0x99)],_0x29d476+=_0x2a5ca1[_0xa1c3f7][_0x504d55(0xc6)]):_0x12fe5b+=_0x504d55(0xac));});const _0x4f6729=_0x29d476/_0x2a5ca1[_0x579dc4(0x7e)]*0x64;_0x12fe5b+='<td>'+formatNumber(_0x22a652)+_0x579dc4(0xd4)+formatNumber(_0x4da78e)+_0x579dc4(0xd4)+formatNumber(_0x29d476)+_0x579dc4(0xd4)+formatNumber(_0x4f6729)+_0x579dc4(0xd0);}),_0x12fe5b+=_0x31b144(0xb2)+formatNumber(_0x5987ba['AREA'])+_0x31b144(0xb3);let _0x3d931c=0x0,_0x20efaa=0x0,_0x71302=0x0;_0x303efa[_0x31b144(0xa9)](_0x310267=>{const _0x58c21e=_0x31b144;_0x2c8e51['some'](_0x5a917e=>_0x5a917e[_0x310267])&&(_0x5987ba[_0x310267]?(_0x12fe5b+=_0x58c21e(0x8b)+formatNumber(_0x5987ba[_0x310267]['buildingCount'])+_0x58c21e(0xa5)+formatNumber(_0x5987ba[_0x310267]['coveredArea'])+_0x58c21e(0xa5)+formatNumber(_0x5987ba[_0x310267][_0x58c21e(0xc6)])+_0x58c21e(0xb3),_0x3d931c+=_0x5987ba[_0x310267][_0x58c21e(0x96)],_0x20efaa+=_0x5987ba[_0x310267][_0x58c21e(0x99)],_0x71302+=_0x5987ba[_0x310267][_0x58c21e(0xc6)]):_0x12fe5b+=_0x58c21e(0xac));});const _0x342f66=_0x71302/_0x5987ba[_0x31b144(0x7e)]*0x64;_0x12fe5b+='<td>'+formatNumber(_0x3d931c)+_0x31b144(0xd5)+formatNumber(_0x20efaa)+_0x31b144(0xd5)+formatNumber(_0x71302)+_0x31b144(0xd5)+formatNumber(_0x342f66)+'%</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</tr>',_0x12fe5b+='</table>',_0x51472b[_0x31b144(0x91)]=_0x12fe5b;}function calculateLandUseArea(_0x7c7323,_0x3d2ca5,_0x3fb319){return _0x7c7323['reduce']((_0x4cd39d,_0x43dc78)=>{const _0x24f3ca=_0x591a;let _0xf1f53e;if(_0x3d2ca5==0xa){if(_0x3fb319==0x1)_0xf1f53e=0x32;else{if(_0x3fb319==0x2||_0x3fb319==0x3)_0xf1f53e=0x3c;else{if(_0x3fb319==0x4)_0xf1f53e=0x28;else{if(_0x3fb319==0x5)_0xf1f53e=0x41;}}}}else{if(_0x3d2ca5==0x14){if(_0x3fb319==0x1)_0xf1f53e=0x46;else{if(_0x3fb319==0x2)_0xf1f53e=0x28;else{if(_0x3fb319==0x3)_0xf1f53e=0x41;}}}else{if(_0x3d2ca5==0x29){if(_0x3fb319==0x1)_0xf1f53e=0x46;else{if(_0x3fb319==0x2)_0xf1f53e=0x28;else{if(_0x3fb319==0x3)_0xf1f53e=0x41;}}}else{if(_0x3d2ca5==0x1e){if(_0x3fb319==0x1)_0xf1f53e=0x46;else{if(_0x3fb319==0x2||_0x3fb319==0x4)_0xf1f53e=0x2d;else{if(_0x3fb319==0x3)_0xf1f53e=0x32;}}}else{if(_0x3d2ca5==0x21){if(_0x3fb319==0x1)_0xf1f53e=0x14;else{if(_0x3fb319==0x2)_0xf1f53e=0x28;else{if(_0x3fb319==0x3)_0xf1f53e=0x32;}}}else{if(_0x3d2ca5==0x50&&_0x3fb319==0x1)_0xf1f53e=0x14;else _0x3d2ca5==0x5a&&_0x3fb319==0x1&&(_0xf1f53e=0x46);}}}}}return _0x4cd39d+_0x43dc78[_0x24f3ca(0xbc)]*0x64/_0xf1f53e;},0x0);}function formatNumber(_0x42c9ad){const _0x7700da=_0x591a;return _0x42c9ad[_0x7700da(0x8f)](_0x7700da(0xa3),{'maximumFractionDigits':0x2});}function exportToExcel(){const _0x30b4dd=_0x591a,_0x19d846=document[_0x30b4dd(0xcc)](_0x30b4dd(0x92)),_0x133546=XLSX[_0x30b4dd(0xd3)]['table_to_book'](_0x19d846,{'sheet':_0x30b4dd(0xb9)});XLSX[_0x30b4dd(0xa6)](_0x133546,_0x30b4dd(0xce));}
    </script>
</body>
</html>   
