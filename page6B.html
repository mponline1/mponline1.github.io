<!DOCTYPE html>
<html lang="th">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ระบบคำนวณประชากร</title>
        <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
    
            body {
                font-family: 'Sarabun', sans-serif;
                margin: 0;
                padding: 0;
                background-color: #f5f5f5;
                min-height: 100vh;
            }
    
            .header {
                background-color: white;
                padding: 1rem 2rem;
                display: flex;
                justify-content: space-between;
                align-items: center;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
    
            .title-section {
                display: flex;
                flex-direction: column;
            }
    
            .title-section h1 {
                margin: 0;
                color: #FF4B55;
                font-size: 24px;
                font-weight: bold;
            }
    
            .title-section h2 {
                margin: 0;
                font-size: 18px;
                color: #FF4B55;
            }
    
            .nav-buttons {
                display: flex;
                gap: 1rem;
                align-items: center;
            }
    
            .nav-button {
                padding: 0.5rem 1.5rem;
                border-radius: 25px;
                border: none;
                color: white;
                cursor: pointer;
                font-family: 'Sarabun', sans-serif;
                font-size: 16px;
                text-decoration: none;
                text-align: center;
                font-weight: 500;
            }
    
            .reclass-button, .prepare-button {
                background-color: #FF4B55;
                min-width: 120px;
                transition: background-color 0.3s ease;
            }
    
            .reclass-button:hover, .prepare-button:hover {
                background-color: #ff3340;
            }
    
            .home-button {
                background-color: #FF4B55;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 0;
                transition: background-color 0.3s ease;
            }
    
            .home-button:hover {
                background-color: #ff303a;
            }
    
            .home-icon {
                color: white;
                font-size: 24px;
                line-height: 1;
            }
    
            .manual-section {
                margin: 2rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                color: #FF4B55;
                text-decoration: none;
                font-size: 16px;
            }
    
            .manual-section:hover {
                text-decoration: underline;
            }
    
            .book-icon {
                width: 24px;
                height: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
    
            .content {
                margin: 0 2rem 2rem 2rem;
                background-color: white;
                padding: 2rem;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
    
            .input-group {
                margin-bottom: 1.5rem;
            }
    
            .input-group label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: 500;
                color: #333;
            }
    
            input[type="file"], 
            input[type="number"],
            select {
                width: 100%;
                padding: 0.5rem;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-family: 'Sarabun', sans-serif;
            }
    
            input[type="number"] {
                width: 200px;
            }
    
            .filter-section {
                margin-top: 1.5rem;
                padding: 1rem;
                background-color: #f8f9fa;
                border-radius: 4px;
                border: 1px solid #ddd;
            }
    
            .filter-section label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: 500;
                color: #333;
            }

            .checkbox-container {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin-top: 10px;
            }

            .checkbox-item {
                display: flex;
                align-items: center;
                margin-right: 15px;
            }

            .checkbox-item input[type="checkbox"] {
                margin-right: 5px;
            }
    
            .button-container {
                display: flex;
                gap: 1rem;
                justify-content: center;
                margin-top: 2rem;
            }
    
            .action-button {
                padding: 0.75rem 2rem;
                border-radius: 4px;
                border: none;
                color: white;
                cursor: pointer;
                font-family: 'Sarabun', sans-serif;
                font-size: 16px;
                font-weight: 500;
                transition: background-color 0.3s ease;
            }
    
            .process-button {
                background-color: #007bff;
            }
    
            .process-button:hover {
                background-color: #0056b3;
            }
    
            .export-button {
                background-color: #28a745;
            }
    
            .export-button:hover {
                background-color: #218838;
            }
    
            .table-container {
                overflow-x: auto;
                margin-top: 2rem;
                display: none;
            }
    
            table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 1rem;
            }
    
            th, td {
                border: 1px solid #ddd;
                padding: 12px 8px;
                text-align: center;
            }
    
            th {
                background-color: #f8f9fa;
                color: #333;
                font-weight: bold;
                white-space: nowrap;
            }
    
            tr:nth-child(even) {
                background-color: #f8f9fa;
            }
    
            tr:hover {
                background-color: #f5f5f5;
            }
    
            .status-message {
                margin: 1rem 0;
                padding: 1rem;
                border-radius: 4px;
                text-align: center;
                display: none;
            }
    
            .error {
                background-color: #fff3f3;
                color: #dc3545;
                border: 1px solid #f5c6cb;
            }
    
            .success {
                background-color: #f0fff0;
                color: #28a745;
                border: 1px solid #c3e6cb;
            }
    
            @media (max-width: 768px) {
                .header {
                    padding: 1rem;
                    flex-direction: column;
                    gap: 1rem;
                    text-align: center;
                }
    
                .nav-buttons {
                    flex-wrap: wrap;
                    justify-content: center;
                }
    
                .content {
                    margin: 1rem;
                    padding: 1rem;
                }
    
                .button-container {
                    flex-direction: column;
                }
    
                .action-button {
                    width: 100%;
                }
    
                input[type="number"] {
                    width: 100%;
                }
            }
        </style>
    </head>
    <body>
        <header class="header">
            <div class="title-section">
                <h1>Calculate Population</h1>
                <h2>คำนวณประชากร</h2>
            </div>
            <div class="nav-buttons">
                <a href="page2.html" class="nav-button reclass-button">Reclass BLDG</a>
                <a href="page5.html" class="nav-button prepare-button">Prepare PLLU</a>
                <a href="index.html" class="nav-button home-button">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 24px; height: 24px;">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </a>
            </div>
        </header>
    
        <a href="https://1drv.ms/v/c/b492e72c8b6a5bca/ETjs351tvVZGopDK4mcnVUsBWGe1MQIHbU5lC76ieOBIBg?e=4rBvNT" class="manual-section">
            <div class="book-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                </svg>
            </div>
            <span>คู่มือการใช้งาน</span>
        </a>
    
        <div class="content">
            <div class="input-group">
                <label>ไฟล์อาคาร (Excel):</label>
                <input type="file" id="buildingFile" accept=".xlsx,.xls">
            </div>
    
            <div class="input-group">
                <label>ไฟล์กริด (Excel):</label>
                <input type="file" id="plluFile" accept=".xlsx,.xls">
            </div>
    
            <div class="input-group">
                <label>ขนาดครัวเรือนเฉลี่ย:</label>
                <input type="number" id="householdSize" value="3.0" step="0.01">
            </div>
    
            <div class="filter-section">
                <label>กรองตามรหัสการใช้ประโยชน์อาคาร (BL_USE):</label>
                <button id="selectAll" class="action-button process-button" style="padding: 5px 10px; margin-left: 10px;">เลือกทั้งหมด</button>
                <button id="clearAll" class="action-button" style="padding: 5px 10px; margin-left: 10px; background-color: #dc3545;">ล้างทั้งหมด</button>
                <div id="blUseCheckboxes" class="checkbox-container"></div>
            </div>
    
            <div class="button-container">
                <button onclick="processData()" class="action-button process-button">Calculate</button>
                <button onclick="exportToExcel()" class="action-button export-button">นำออกผลการคำนวณประชากร(Excel)</button>
            </div>
    
            <div id="statusMessage" class="status-message"></div>
    
            <div class="table-container" id="tableContainer">
                <table id="resultTable">
                    <thead>
                        <tr>
                            <th rowspan="2">บริเวณกริด</th>
                            <th colspan="2">บ้านเดี่ยว/อาคารเดี่ยว</th>
                            <th colspan="2">บ้านแฝด</th>
                            <th colspan="2">ทาวน์เฮาส์</th>
                            <th colspan="2">ห้องแถว</th>
                            <th colspan="2">ตึกแถว</th>
                            <th colspan="2">เรือนแพ</th>
                            <th colspan="3">อาคารพักอาศัย</th>
                            <th colspan="2">อื่นๆ</th>
                            <th rowspan="2">จำนวนอาคารรวม</th>
                            <th rowspan="2">ประชากรรวม</th>
                            <th rowspan="2">พื้นที่ทั้งหมด(ไร่)</th>
                            <th rowspan="2">ความหนาแน่นประชากร(คน/ไร่)</th>
                        </tr>
                        <tr>
                            <th>จำนวนอาคาร</th>
                            <th>ประชากร</th>
                            <th>จำนวนอาคาร</th>
                            <th>ประชากร</th>
                            <th>จำนวนอาคาร</th>
                            <th>ประชากร</th>
                            <th>จำนวนอาคาร</th>
                            <th>ประชากร</th>
                            <th>จำนวนอาคาร</th>
                            <th>ประชากร</th>
                            <th>จำนวนอาคาร</th>
                            <th>ประชากร</th>
                            <th>จำนวนอาคาร</th>
                            <th>จำนวนห้อง</th>
                            <th>ประชากร</th>
                            <th>จำนวนอาคาร</th>
                            <th>ประชากร</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

    <script>
const _0x6ebbcc=_0x7b6e;(function(_0xaacd89,_0x34a3fb){const _0xac0374=_0x7b6e,_0x452982=_0xaacd89();while(!![]){try{const _0x2b5bdc=-parseInt(_0xac0374(0x229))/0x1*(-parseInt(_0xac0374(0x24d))/0x2)+parseInt(_0xac0374(0x25c))/0x3*(-parseInt(_0xac0374(0x1de))/0x4)+parseInt(_0xac0374(0x212))/0x5*(parseInt(_0xac0374(0x259))/0x6)+parseInt(_0xac0374(0x23b))/0x7*(parseInt(_0xac0374(0x24c))/0x8)+parseInt(_0xac0374(0x1f9))/0x9+-parseInt(_0xac0374(0x1fa))/0xa+-parseInt(_0xac0374(0x252))/0xb*(-parseInt(_0xac0374(0x20a))/0xc);if(_0x2b5bdc===_0x34a3fb)break;else _0x452982['push'](_0x452982['shift']());}catch(_0x556743){_0x452982['push'](_0x452982['shift']());}}}(_0x1d69,0xd1b0c));let buildingData=[],plluData=[],filteredBuildings=[],filteredPllu=[];function _0x1d69(){const _0x56ce00=['8800530JWmILv','1132','textContent','others','tableContainer','ประชากร\x20(ตึกแถว)','rooms','กรุณาอัพโหลดไฟล์ให้ครบถ้วน','จำนวนอาคาร\x20(บ้านแฝด)','insertCell','4180','จำนวนอาคาร\x20(อาคารพักอาศัย)','เกิดข้อผิดพลาดในการอ่านไฟล์อาคาร','1310','className','1100','375108WwIvfo','จำนวนห้อง\x20(อาคารพักอาศัย)','readAsBinaryString','reduce','จำนวนอาคาร\x20(อื่นๆ)','addEventListener','error','ประชากร\x20(บ้านแฝด)','5690930qpvCwk','block','SheetNames','length','buildingFile','townhouse','even-row','1320','tbody','จำนวนอาคาร\x20(ทาวน์เฮาส์)','totalPopulation','.xlsx','createElement','เกิดข้อผิดพลาดในการประมวลผลข้อมูล','blUse_','forEach','1300','cells','เกิดข้อผิดพลาดในการคำนวณข้อมูล','aoa_to_sheet','htmlFor','stats','รวม','3mYgENN','sheet_to_json','innerHTML','1131','ประชากร\x20(อื่นๆ)','value','label','book_new','type','filter','PL_BLOCK','population_calculation_','wch','toLocaleString','apartment','BL_NUNIT','เกิดข้อผิดพลาดในการส่งออกข้อมูล','totalArea','19145NeSLPl','getElementById','เกิดข้อผิดพลาดในการอ่านไฟล์\x20PLLU','onload','4123','querySelector','getElementsByTagName','จำนวนอาคาร\x20(เรือนแพ)','จำนวนอาคารรวม','!cols','success','.export-button','includes','population','houseboat','1121','click','2480VcrHTA','730302itlVcD','book_append_sheet','display','4110','status-message\x20','99GxQRqE','toISOString','duplexHouse','sort','ข้อมูลประชากร','keypress','1103','6gtptBg','area','key','5039628DBukcx','style','1350','querySelectorAll','trim','blUseCheckboxes','resultTable','target','map','density','4100','insertRow','พื้นที่ทั้งหมด(ไร่)','none','4300','AREA_rai','checked','split','1123','Enter','values','#blUseCheckboxes\x20input[type=\x22checkbox\x22]','push','div','4ifcXhE','householdSize','BL_USE','1101','4121','add','singleHouse','อัพโหลดไฟล์อาคารสำเร็จ','clearAll','statusMessage','totalBuildings','count','ประชากร\x20(บ้านเดี่ยว)','plluFile','files','utils','4120','total-row','commercial','th-TH','read','replace','odd-row','appendChild','onerror','shophouse','plBlock','504009nKGcpA'];_0x1d69=function(){return _0x56ce00;};return _0x1d69();}const residentialCodes=[_0x6ebbcc(0x209),_0x6ebbcc(0x1e1),'1102',_0x6ebbcc(0x258),_0x6ebbcc(0x24a),'1122',_0x6ebbcc(0x1d8),_0x6ebbcc(0x22c),_0x6ebbcc(0x1fb),_0x6ebbcc(0x222),_0x6ebbcc(0x207),_0x6ebbcc(0x219),'1330','1340',_0x6ebbcc(0x25e),_0x6ebbcc(0x266),_0x6ebbcc(0x250),_0x6ebbcc(0x1ee),_0x6ebbcc(0x1e2),'4122',_0x6ebbcc(0x23f),_0x6ebbcc(0x204),_0x6ebbcc(0x1d4)];let selectedBlUse=[...residentialCodes];document[_0x6ebbcc(0x23c)](_0x6ebbcc(0x216))[_0x6ebbcc(0x20f)]('change',handleBuildingFile),document['getElementById'](_0x6ebbcc(0x1eb))['addEventListener']('change',handlePlluFile),document[_0x6ebbcc(0x23c)](_0x6ebbcc(0x1df))[_0x6ebbcc(0x20f)](_0x6ebbcc(0x257),function(_0x2d779b){const _0x1cf547=_0x6ebbcc;_0x2d779b[_0x1cf547(0x25b)]===_0x1cf547(0x1d9)&&processData();}),document[_0x6ebbcc(0x23c)]('selectAll')[_0x6ebbcc(0x20f)](_0x6ebbcc(0x24b),selectAllBlUse),document[_0x6ebbcc(0x23c)](_0x6ebbcc(0x1e6))['addEventListener'](_0x6ebbcc(0x24b),clearAllBlUse);function normalizeBuildingType(_0x18b1a8){const _0x45c265=_0x6ebbcc,_0x39e287=String(_0x18b1a8)[_0x45c265(0x260)](),_0x2ce350={'1':0x1,'บ้านเดี่ยว':0x1,'2':0x2,'บ้านแฝด':0x2,'3':0x3,'ทาวน์เฮาส์':0x3,'4':0x4,'ห้องแถว':0x4,'5':0x5,'ตึกแถว':0x5,'6':0x6,'อาคารพักอาศัย':0x6,'7':0x7,'เรือนแพ':0x7,'8':0x8,'อื่นๆ':0x8,'98':0x62};return _0x2ce350[_0x39e287]||null;}function formatNumber(_0x2e7c72,_0x4b8d15=0x0){const _0x12aa4d=_0x6ebbcc;return _0x2e7c72[_0x12aa4d(0x236)](_0x12aa4d(0x1f1),{'minimumFractionDigits':_0x4b8d15,'maximumFractionDigits':_0x4b8d15});}function _0x7b6e(_0x161e7d,_0x3ac1a4){const _0x1d6999=_0x1d69();return _0x7b6e=function(_0x7b6e99,_0x55e462){_0x7b6e99=_0x7b6e99-0x1d3;let _0x5925b5=_0x1d6999[_0x7b6e99];return _0x5925b5;},_0x7b6e(_0x161e7d,_0x3ac1a4);}async function handleBuildingFile(_0x16e641){const _0x2b5546=_0x6ebbcc;try{const _0xf8bf95=_0x16e641[_0x2b5546(0x263)]['files'][0x0];buildingData=await readExcelFile(_0xf8bf95),updateBlUseCheckboxes(),showStatus(_0x2b5546(0x1e5),_0x2b5546(0x245));}catch(_0xc3cbe5){handleError(_0xc3cbe5,_0x2b5546(0x206));}}async function handlePlluFile(_0x129945){const _0xd6df36=_0x6ebbcc;try{const _0x475e65=_0x129945[_0xd6df36(0x263)][_0xd6df36(0x1ec)][0x0];plluData=await readExcelFile(_0x475e65),showStatus('อัพโหลดไฟล์\x20PLLU\x20สำเร็จ',_0xd6df36(0x245));}catch(_0x56dc5f){handleError(_0x56dc5f,_0xd6df36(0x23d));}}async function readExcelFile(_0x5e3cae){return new Promise((_0x25fbdc,_0xfed87e)=>{const _0x7a950a=_0x7b6e,_0x3decd2=new FileReader();_0x3decd2[_0x7a950a(0x23e)]=_0x36366c=>{const _0x3696cc=_0x7a950a;try{const _0x582cad=_0x36366c['target']['result'],_0x50c98c=XLSX[_0x3696cc(0x1f2)](_0x582cad,{'type':'binary'}),_0x3e7876=_0x50c98c[_0x3696cc(0x214)][0x0],_0x497869=_0x50c98c['Sheets'][_0x3e7876],_0x50385b=XLSX[_0x3696cc(0x1ed)][_0x3696cc(0x22a)](_0x497869);_0x25fbdc(_0x50385b);}catch(_0x2bb406){_0xfed87e(_0x2bb406);}},_0x3decd2[_0x7a950a(0x1f6)]=_0xfed87e,_0x3decd2[_0x7a950a(0x20c)](_0x5e3cae);});}function updateBlUseCheckboxes(){const _0x5b3914=_0x6ebbcc,_0x3b278d=document[_0x5b3914(0x23c)](_0x5b3914(0x261));_0x3b278d['innerHTML']='';const _0x112b74=new Set();buildingData[_0x5b3914(0x221)](_0x1f5e70=>{const _0x3f8186=_0x5b3914,_0x5c6e28=String(_0x1f5e70['BL_USE'])[_0x3f8186(0x260)]();residentialCodes['includes'](_0x5c6e28)&&_0x112b74[_0x3f8186(0x1e3)](_0x5c6e28);}),[..._0x112b74][_0x5b3914(0x255)]()[_0x5b3914(0x221)](_0x4b8a81=>{const _0x461b1f=_0x5b3914,_0x3d38e5=document[_0x461b1f(0x21e)](_0x461b1f(0x1dd));_0x3d38e5['className']='checkbox-item';const _0x4d008b=document[_0x461b1f(0x21e)]('input');_0x4d008b[_0x461b1f(0x231)]='checkbox',_0x4d008b['id']=_0x461b1f(0x220)+_0x4b8a81,_0x4d008b['value']=_0x4b8a81,_0x4d008b[_0x461b1f(0x1d6)]=selectedBlUse[_0x461b1f(0x247)](_0x4b8a81),_0x4d008b['addEventListener']('change',updateSelectedBlUse);const _0x4b7459=document[_0x461b1f(0x21e)](_0x461b1f(0x22f));_0x4b7459[_0x461b1f(0x226)]=_0x461b1f(0x220)+_0x4b8a81,_0x4b7459[_0x461b1f(0x1fc)]=_0x4b8a81,_0x3d38e5[_0x461b1f(0x1f5)](_0x4d008b),_0x3d38e5[_0x461b1f(0x1f5)](_0x4b7459),_0x3b278d[_0x461b1f(0x1f5)](_0x3d38e5);});}function updateSelectedBlUse(){const _0x1e02f6=_0x6ebbcc;selectedBlUse=[];const _0x4c28d9=document[_0x1e02f6(0x25f)]('#blUseCheckboxes\x20input[type=\x22checkbox\x22]:checked');_0x4c28d9['forEach'](_0x2b71ec=>{const _0x90fe8f=_0x1e02f6;selectedBlUse['push'](_0x2b71ec[_0x90fe8f(0x22e)]);}),filterData();}function selectAllBlUse(){const _0x570c77=_0x6ebbcc,_0x4b0e17=document[_0x570c77(0x25f)](_0x570c77(0x1db));_0x4b0e17['forEach'](_0x59d227=>{const _0x303e47=_0x570c77;_0x59d227[_0x303e47(0x1d6)]=!![];}),updateSelectedBlUse();}function clearAllBlUse(){const _0x1ec3ff=_0x6ebbcc,_0x136643=document[_0x1ec3ff(0x25f)]('#blUseCheckboxes\x20input[type=\x22checkbox\x22]');_0x136643['forEach'](_0x58fc3d=>{_0x58fc3d['checked']=![];}),updateSelectedBlUse();}function filterData(){const _0x2100bb=_0x6ebbcc;filteredBuildings=buildingData[_0x2100bb(0x232)](_0x210961=>{const _0x19e71f=_0x2100bb,_0x37a730=String(_0x210961[_0x19e71f(0x1e0)])['trim']();return selectedBlUse[_0x19e71f(0x247)](_0x37a730);}),filteredPllu=[...plluData],buildingData[_0x2100bb(0x215)]>0x0&&plluData[_0x2100bb(0x215)]>0x0&&selectedBlUse[_0x2100bb(0x215)]>0x0&&processData();}function showStatus(_0x3d6850,_0x52998e){const _0x34eabb=_0x6ebbcc,_0x39f9a9=document[_0x34eabb(0x23c)](_0x34eabb(0x1e7));_0x39f9a9[_0x34eabb(0x1fc)]=_0x3d6850,_0x39f9a9[_0x34eabb(0x208)]=_0x34eabb(0x251)+_0x52998e,_0x39f9a9[_0x34eabb(0x25d)][_0x34eabb(0x24f)]='block',setTimeout(()=>{const _0x3dca92=_0x34eabb;_0x39f9a9[_0x3dca92(0x25d)][_0x3dca92(0x24f)]=_0x3dca92(0x1d3);},0xbb8);}function handleError(_0x4ed92e,_0x1b2fc3){const _0x45bfa7=_0x6ebbcc;console[_0x45bfa7(0x210)](_0x4ed92e),showStatus(_0x1b2fc3,_0x45bfa7(0x210));}function processData(){const _0xeecb69=_0x6ebbcc;try{if(!buildingData['length']||!plluData[_0xeecb69(0x215)]){showStatus(_0xeecb69(0x201),'error');return;}if(selectedBlUse[_0xeecb69(0x215)]===0x0){showStatus('กรุณาเลือกรหัสอาคารอย่างน้อย\x201\x20รายการ','error');return;}const _0x1dd7f6=parseFloat(document[_0xeecb69(0x23c)](_0xeecb69(0x1df))[_0xeecb69(0x22e)]);if(!_0x1dd7f6||_0x1dd7f6<=0x0){showStatus('กรุณากรอกขนาดครัวเรือนเฉลี่ยให้ถูกต้อง','error');return;}filteredBuildings[_0xeecb69(0x215)]===0x0&&filterData(),calculatePopulation(),document['getElementById'](_0xeecb69(0x1fe))[_0xeecb69(0x25d)]['display']=_0xeecb69(0x213),document[_0xeecb69(0x240)](_0xeecb69(0x246))[_0xeecb69(0x25d)]['display']='inline-block',showStatus('ประมวลผลข้อมูลสำเร็จ',_0xeecb69(0x245));}catch(_0x668a15){handleError(_0x668a15,_0xeecb69(0x21f));}}function calculatePopulation(){const _0x21814f=_0x6ebbcc;try{const _0x3533cf=parseFloat(document[_0x21814f(0x23c)](_0x21814f(0x1df))['value']),_0x3fba69=document['getElementById'](_0x21814f(0x262))[_0x21814f(0x241)](_0x21814f(0x21a))[0x0];_0x3fba69[_0x21814f(0x22b)]='';const _0xf2325b=filteredPllu[_0x21814f(0x264)](_0x433bd7=>{const _0xcb051=_0x21814f,_0xb9278e=filteredBuildings[_0xcb051(0x232)](_0x521694=>{const _0x385a79=_0xcb051,_0x468529=normalizeBuildingType(_0x521694['BL_TYPE']);return String(_0x521694['PL_BLOCK'])[_0x385a79(0x260)]()===String(_0x433bd7['PL_BLOCK'])[_0x385a79(0x260)]()&&_0x468529>=0x1&&_0x468529<=0x8;}),_0x4ed9f3=_0x131abc=>{const _0x3e38ce=_0xcb051,_0x3fe667=_0xb9278e[_0x3e38ce(0x232)](_0x2829ef=>normalizeBuildingType(_0x2829ef['BL_TYPE'])===_0x131abc),_0x29b90d=_0x3fe667['length'];let _0x3ea62d=0x0;switch(_0x131abc){case 0x1:_0x3ea62d=_0x29b90d*(_0x3533cf+0.15);break;case 0x2:_0x3ea62d=_0x29b90d*_0x3533cf;break;case 0x3:case 0x4:case 0x5:_0x3ea62d=_0x29b90d*(_0x3533cf-0.1);break;case 0x6:const _0x5af6d0=_0x3fe667[_0x3e38ce(0x20d)]((_0xc338d8,_0x245065)=>_0xc338d8+(parseFloat(_0x245065[_0x3e38ce(0x238)])||0x0),0x0);_0x3ea62d=_0x5af6d0*0x2;return{'count':_0x29b90d,'rooms':_0x5af6d0,'population':_0x3ea62d};case 0x7:_0x3ea62d=_0x29b90d*(_0x3533cf+0.15);break;case 0x8:case 0x62:_0x3ea62d=_0x29b90d*_0x3533cf*0x2;break;}return{'count':_0x29b90d,'population':_0x3ea62d};},_0x4a62a7={'singleHouse':_0x4ed9f3(0x1),'duplexHouse':_0x4ed9f3(0x2),'townhouse':_0x4ed9f3(0x3),'shophouse':_0x4ed9f3(0x4),'commercial':_0x4ed9f3(0x5),'houseboat':_0x4ed9f3(0x7),'apartment':_0x4ed9f3(0x6),'others':{'count':_0xb9278e[_0xcb051(0x232)](_0x4518a6=>[0x8,0x62]['includes'](normalizeBuildingType(_0x4518a6['BL_TYPE'])))['length'],'population':_0xb9278e[_0xcb051(0x232)](_0x5f2e81=>[0x8,0x62]['includes'](normalizeBuildingType(_0x5f2e81['BL_TYPE'])))[_0xcb051(0x215)]*_0x3533cf*0x2}},_0x10d85d=Object[_0xcb051(0x1da)](_0x4a62a7)[_0xcb051(0x20d)]((_0x225999,_0x1172a2)=>_0x225999+_0x1172a2['count'],0x0),_0x26a482=Object[_0xcb051(0x1da)](_0x4a62a7)[_0xcb051(0x20d)]((_0x5933a1,_0x3b5673)=>_0x5933a1+_0x3b5673['population'],0x0),_0x16b530=parseFloat(_0x433bd7[_0xcb051(0x1d5)])||0x0,_0x26c01f=_0x16b530>0x0?_0x26a482/_0x16b530:0x0;return{'plBlock':_0x433bd7[_0xcb051(0x233)],'stats':_0x4a62a7,'totalBuildings':_0x10d85d,'totalPopulation':_0x26a482,'area':_0x16b530,'density':_0x26c01f};});_0xf2325b['forEach']((_0x373e47,_0x1b9b86)=>{const _0x34fcea=_0x21814f,_0x3bbe02=_0x3fba69[_0x34fcea(0x267)]();_0x3bbe02['className']=_0x1b9b86%0x2===0x0?_0x34fcea(0x218):_0x34fcea(0x1f4),_0x3bbe02[_0x34fcea(0x203)]()['textContent']=_0x373e47[_0x34fcea(0x1f8)],_0x3bbe02[_0x34fcea(0x203)]()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x227)][_0x34fcea(0x1e4)][_0x34fcea(0x1e9)]),_0x3bbe02['insertCell']()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x227)][_0x34fcea(0x1e4)][_0x34fcea(0x248)],0x2),_0x3bbe02[_0x34fcea(0x203)]()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x227)][_0x34fcea(0x254)][_0x34fcea(0x1e9)]),_0x3bbe02[_0x34fcea(0x203)]()['textContent']=formatNumber(_0x373e47[_0x34fcea(0x227)]['duplexHouse'][_0x34fcea(0x248)],0x2),_0x3bbe02[_0x34fcea(0x203)]()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x227)]['townhouse'][_0x34fcea(0x1e9)]),_0x3bbe02['insertCell']()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x227)][_0x34fcea(0x217)][_0x34fcea(0x248)],0x2),_0x3bbe02['insertCell']()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x227)][_0x34fcea(0x1f7)][_0x34fcea(0x1e9)]),_0x3bbe02[_0x34fcea(0x203)]()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x227)]['shophouse'][_0x34fcea(0x248)],0x2),_0x3bbe02[_0x34fcea(0x203)]()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47['stats'][_0x34fcea(0x1f0)][_0x34fcea(0x1e9)]),_0x3bbe02['insertCell']()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x227)][_0x34fcea(0x1f0)][_0x34fcea(0x248)],0x2),_0x3bbe02['insertCell']()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x227)]['houseboat'][_0x34fcea(0x1e9)]),_0x3bbe02[_0x34fcea(0x203)]()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47['stats'][_0x34fcea(0x249)][_0x34fcea(0x248)],0x2),_0x3bbe02[_0x34fcea(0x203)]()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x227)][_0x34fcea(0x237)][_0x34fcea(0x1e9)]),_0x3bbe02[_0x34fcea(0x203)]()['textContent']=formatNumber(_0x373e47[_0x34fcea(0x227)]['apartment'][_0x34fcea(0x200)]||0x0),_0x3bbe02[_0x34fcea(0x203)]()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47['stats']['apartment'][_0x34fcea(0x248)],0x2),_0x3bbe02['insertCell']()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x227)][_0x34fcea(0x1fd)]['count']),_0x3bbe02['insertCell']()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x227)][_0x34fcea(0x1fd)][_0x34fcea(0x248)],0x2),_0x3bbe02[_0x34fcea(0x203)]()['textContent']=formatNumber(_0x373e47[_0x34fcea(0x1e8)]),_0x3bbe02[_0x34fcea(0x203)]()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x21c)],0x2),_0x3bbe02[_0x34fcea(0x203)]()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x25a)],0x2),_0x3bbe02[_0x34fcea(0x203)]()[_0x34fcea(0x1fc)]=formatNumber(_0x373e47[_0x34fcea(0x265)],0x2);}),addTotalRow(_0xf2325b);}catch(_0x134560){console['error']('Error\x20in\x20calculatePopulation:',_0x134560),showStatus(_0x21814f(0x224),_0x21814f(0x210));}}function addTotalRow(_0x450959){const _0x36d168=_0x6ebbcc,_0x1d7aa3=document['getElementById'](_0x36d168(0x262))[_0x36d168(0x241)](_0x36d168(0x21a))[0x0],_0x23385a=_0x1d7aa3[_0x36d168(0x267)]();_0x23385a[_0x36d168(0x208)]=_0x36d168(0x1ef);const _0x24cc26=_0x450959[_0x36d168(0x20d)]((_0x5197ee,_0x28e1c4)=>({'singleHouse':{'count':_0x5197ee[_0x36d168(0x1e4)][_0x36d168(0x1e9)]+_0x28e1c4[_0x36d168(0x227)]['singleHouse'][_0x36d168(0x1e9)],'population':_0x5197ee[_0x36d168(0x1e4)]['population']+_0x28e1c4[_0x36d168(0x227)][_0x36d168(0x1e4)][_0x36d168(0x248)]},'duplexHouse':{'count':_0x5197ee['duplexHouse'][_0x36d168(0x1e9)]+_0x28e1c4['stats']['duplexHouse'][_0x36d168(0x1e9)],'population':_0x5197ee[_0x36d168(0x254)][_0x36d168(0x248)]+_0x28e1c4['stats'][_0x36d168(0x254)][_0x36d168(0x248)]},'townhouse':{'count':_0x5197ee[_0x36d168(0x217)][_0x36d168(0x1e9)]+_0x28e1c4['stats'][_0x36d168(0x217)][_0x36d168(0x1e9)],'population':_0x5197ee['townhouse'][_0x36d168(0x248)]+_0x28e1c4['stats'][_0x36d168(0x217)][_0x36d168(0x248)]},'shophouse':{'count':_0x5197ee['shophouse'][_0x36d168(0x1e9)]+_0x28e1c4[_0x36d168(0x227)][_0x36d168(0x1f7)]['count'],'population':_0x5197ee[_0x36d168(0x1f7)][_0x36d168(0x248)]+_0x28e1c4['stats'][_0x36d168(0x1f7)][_0x36d168(0x248)]},'commercial':{'count':_0x5197ee['commercial'][_0x36d168(0x1e9)]+_0x28e1c4['stats'][_0x36d168(0x1f0)][_0x36d168(0x1e9)],'population':_0x5197ee['commercial'][_0x36d168(0x248)]+_0x28e1c4[_0x36d168(0x227)][_0x36d168(0x1f0)][_0x36d168(0x248)]},'houseboat':{'count':_0x5197ee[_0x36d168(0x249)][_0x36d168(0x1e9)]+_0x28e1c4[_0x36d168(0x227)][_0x36d168(0x249)]['count'],'population':_0x5197ee['houseboat']['population']+_0x28e1c4[_0x36d168(0x227)][_0x36d168(0x249)][_0x36d168(0x248)]},'apartment':{'count':_0x5197ee['apartment'][_0x36d168(0x1e9)]+_0x28e1c4[_0x36d168(0x227)][_0x36d168(0x237)][_0x36d168(0x1e9)],'rooms':_0x5197ee[_0x36d168(0x237)][_0x36d168(0x200)]+(_0x28e1c4[_0x36d168(0x227)][_0x36d168(0x237)][_0x36d168(0x200)]||0x0),'population':_0x5197ee[_0x36d168(0x237)][_0x36d168(0x248)]+_0x28e1c4[_0x36d168(0x227)][_0x36d168(0x237)][_0x36d168(0x248)]},'others':{'count':_0x5197ee[_0x36d168(0x1fd)]['count']+_0x28e1c4[_0x36d168(0x227)][_0x36d168(0x1fd)][_0x36d168(0x1e9)],'population':_0x5197ee[_0x36d168(0x1fd)]['population']+_0x28e1c4[_0x36d168(0x227)][_0x36d168(0x1fd)][_0x36d168(0x248)]},'totalBuildings':_0x5197ee[_0x36d168(0x1e8)]+_0x28e1c4['totalBuildings'],'totalPopulation':_0x5197ee['totalPopulation']+_0x28e1c4[_0x36d168(0x21c)],'totalArea':_0x5197ee[_0x36d168(0x23a)]+_0x28e1c4[_0x36d168(0x25a)]}),{'singleHouse':{'count':0x0,'population':0x0},'duplexHouse':{'count':0x0,'population':0x0},'townhouse':{'count':0x0,'population':0x0},'shophouse':{'count':0x0,'population':0x0},'commercial':{'count':0x0,'population':0x0},'houseboat':{'count':0x0,'population':0x0},'apartment':{'count':0x0,'rooms':0x0,'population':0x0},'others':{'count':0x0,'population':0x0},'totalBuildings':0x0,'totalPopulation':0x0,'totalArea':0x0}),_0x14eaf0=[_0x36d168(0x228),formatNumber(_0x24cc26[_0x36d168(0x1e4)][_0x36d168(0x1e9)]),formatNumber(_0x24cc26[_0x36d168(0x1e4)][_0x36d168(0x248)],0x2),formatNumber(_0x24cc26[_0x36d168(0x254)][_0x36d168(0x1e9)]),formatNumber(_0x24cc26['duplexHouse'][_0x36d168(0x248)],0x2),formatNumber(_0x24cc26[_0x36d168(0x217)][_0x36d168(0x1e9)]),formatNumber(_0x24cc26['townhouse'][_0x36d168(0x248)],0x2),formatNumber(_0x24cc26[_0x36d168(0x1f7)]['count']),formatNumber(_0x24cc26[_0x36d168(0x1f7)][_0x36d168(0x248)],0x2),formatNumber(_0x24cc26[_0x36d168(0x1f0)][_0x36d168(0x1e9)]),formatNumber(_0x24cc26['commercial'][_0x36d168(0x248)],0x2),formatNumber(_0x24cc26[_0x36d168(0x249)]['count']),formatNumber(_0x24cc26[_0x36d168(0x249)][_0x36d168(0x248)],0x2),formatNumber(_0x24cc26[_0x36d168(0x237)][_0x36d168(0x1e9)]),formatNumber(_0x24cc26[_0x36d168(0x237)][_0x36d168(0x200)]),formatNumber(_0x24cc26['apartment'][_0x36d168(0x248)],0x2),formatNumber(_0x24cc26[_0x36d168(0x1fd)]['count']),formatNumber(_0x24cc26[_0x36d168(0x1fd)][_0x36d168(0x248)],0x2),formatNumber(_0x24cc26['totalBuildings']),formatNumber(_0x24cc26[_0x36d168(0x21c)],0x2),formatNumber(_0x24cc26[_0x36d168(0x23a)],0x2),formatNumber(_0x24cc26[_0x36d168(0x21c)]/_0x24cc26['totalArea'],0x2)];_0x14eaf0[_0x36d168(0x221)](_0x3b44d3=>{const _0x1861b2=_0x36d168;_0x23385a['insertCell']()[_0x1861b2(0x1fc)]=_0x3b44d3;});}function exportToExcel(){const _0xd68486=_0x6ebbcc;try{const _0x13c5dc=document[_0xd68486(0x23c)](_0xd68486(0x262)),_0x108a57=XLSX[_0xd68486(0x1ed)][_0xd68486(0x230)](),_0x3d33ee=[],_0x3c46bf=['การใช้ประโยชน์ที่ดินบริเวณหมายเลข','จำนวนอาคาร\x20(บ้านเดี่ยว)',_0xd68486(0x1ea),_0xd68486(0x202),_0xd68486(0x211),_0xd68486(0x21b),'ประชากร\x20(ทาวน์เฮาส์)','จำนวนอาคาร\x20(ห้องแถว)','ประชากร\x20(ห้องแถว)','จำนวนอาคาร\x20(ตึกแถว)',_0xd68486(0x1ff),_0xd68486(0x242),'ประชากร\x20(เรือนแพ)',_0xd68486(0x205),_0xd68486(0x20b),'ประชากร\x20(อาคารพักอาศัย)',_0xd68486(0x20e),_0xd68486(0x22d),_0xd68486(0x243),'ประชากรรวม',_0xd68486(0x268),'ความหนาแน่นประชากร(คน/ไร่)'];_0x3d33ee['push'](_0x3c46bf);for(let _0x5d91c9=0x0;_0x5d91c9<_0x13c5dc['rows'][_0xd68486(0x215)];_0x5d91c9++){if(_0x5d91c9<0x2)continue;const _0x583f0a=_0x13c5dc['rows'][_0x5d91c9],_0x3e5aaa=[];for(let _0x3fe7cb=0x0;_0x3fe7cb<_0x583f0a[_0xd68486(0x223)][_0xd68486(0x215)];_0x3fe7cb++){const _0x117085=_0x583f0a[_0xd68486(0x223)][_0x3fe7cb]['textContent'];if(_0x3fe7cb===0x0)_0x3e5aaa['push'](_0x117085);else{const _0x4b72fd=_0x117085[_0xd68486(0x1f3)](/,/g,'');_0x3e5aaa[_0xd68486(0x1dc)](isNaN(_0x4b72fd)?_0x117085:Number(_0x4b72fd));}}_0x3d33ee[_0xd68486(0x1dc)](_0x3e5aaa);}const _0x55aacd=XLSX[_0xd68486(0x1ed)][_0xd68486(0x225)](_0x3d33ee),_0x58d236=_0x3c46bf[_0xd68486(0x264)](()=>({'wch':0xf}));_0x58d236[0x0][_0xd68486(0x235)]=0x19,_0x55aacd[_0xd68486(0x244)]=_0x58d236,XLSX[_0xd68486(0x1ed)][_0xd68486(0x24e)](_0x108a57,_0x55aacd,_0xd68486(0x256));const _0x3d6ab5=_0xd68486(0x234)+new Date()[_0xd68486(0x253)]()[_0xd68486(0x1d7)]('T')[0x0]+_0xd68486(0x21d);XLSX['writeFile'](_0x108a57,_0x3d6ab5),showStatus('ส่งออกข้อมูลสำเร็จ',_0xd68486(0x245));}catch(_0x2e8c0c){console[_0xd68486(0x210)]('Error\x20exporting\x20to\x20Excel:',_0x2e8c0c),handleError(_0x2e8c0c,_0xd68486(0x239));}}
    </script>
</body>
</html>